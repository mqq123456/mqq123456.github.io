<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Men的博客">
<meta property="og:url" content="http://example.com/page/15/index.html">
<meta property="og:site_name" content="Men的博客">
<meta property="og:description" content="博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="门乾强">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Men的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Men的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">欢迎光临！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift238Cesium%E5%88%9B%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift238Cesium%E5%88%9B%E5%BB%BA/" class="post-title-link" itemprop="url">Cesium创建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-14 21:42:41" itemprop="dateModified" datetime="2022-03-14T21:42:41+08:00">2022-03-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>export const createMap = function(element, option) {<br>    this._option = option ? option : {}<br>    this._option.imageryProvider = this._option.imageryProvider ? new Cesium.UrlTemplateImageryProvider({<br>        url:this._option.imageryProvider,<br>        tilingScheme: new Cesium.WebMercatorTilingScheme(),<br>        fileExtension: ‘png’<br>    }) : layer.createImageryProvider({<br>        type: ‘www_tdt’,<br>        layer: ‘img’<br>    });<br>    this._option.terrainProvider = this._option.terrainProvider ? new Cesium.CesiumTerrainProvider({<br>        url:this._option.terrainProvider,<br>        requestVertexNormals: true,<br>        requestWaterMask: true<br>    }) : new Cesium.CesiumTerrainProvider({<br>        url: ‘<a target="_blank" rel="noopener" href="https://lab.earthsdk.com/terrain/42752d50ac1f11e99dbd8fd044883638&#39;">https://lab.earthsdk.com/terrain/42752d50ac1f11e99dbd8fd044883638&#39;</a>,<br>        requestVertexNormals: true,<br>        requestWaterMask: true</p>
<pre><code>&#125;);
this._option.orderIndependentTranslucency = this._option.orderIndependentTranslucency ? this._option.orderIndependentTranslucency : false;
this._option.contextOptions = this._option.contextOptions ? this._option.contextOptions : &#123;
    webgl: &#123;
        alpha: true,
        depth:true,
        stencil:true,
        antialias:true,
        premultipliedAlpha:true,
        //通过canvas.toDataURL()实现截图需要将该项设置为true
        preserveDrawingBuffer:true,
        failIfMajorPerformanceCaveat:true
    &#125;
&#125;;
//需要进行可视化的数据源的集合
this._option.animation = this._option.animation ? this._option.animation : false; //是否显示动画控件
this._option.shouldAnimate = this._option.shouldAnimate ? this._option.shouldAnimate : true;
this._option.homeButton = this._option.homeButton ? this._option.homeButton : false; //是否显示Home按钮
this._option.fullscreenButton = this._option.fullscreenButton ? this._option.fullscreenButton : false; //是否显示全屏按钮
this._option.baseLayerPicker = this._option.baseLayerPicker ? this._option.baseLayerPicker : false; //是否显示图层选择控件
this._option.geocoder = this._option.geocoder ? this._option.geocoder : false; //是否显示地名查找控件
this._option.timeline = this._option.timeline ? this._option.timeline : false; //是否显示时间线控件
this._option.sceneModePicker = this._option.sceneModePicker ? this._option.sceneModePicker : false; //是否显示投影方式控件
this._option.navigationHelpButton = this._option.navigationHelpButton ? this._option.navigationHelpButton : false; //是否显示帮助信息控件
this._option.infoBox = this._option.infoBox ? this._option.infoBox : false; //是否显示点击要素之后显示的信息
this._option.requestRenderMode = this._option.requestRenderMode ? this._option.requestRenderMode : false; //启用请求渲染模式
this._option.scene3DOnly = this._option.scene3DOnly ? this._option.requestRenderMode : true; //每个几何实例将只能以3D渲染以节省GPU内存
this._option.sceneMode = this._option.sceneMode ? this._option.sceneMode : 3; //初始场景模式 1 2D模式 2 2D循环模式 3 3D模式  Cesium.SceneMode
this._option.fullscreenElement = this._option.fullscreenElement ? this._option.fullscreenElement : document.body; //全屏时渲染的HTML元素 暂时没发现用处
this._option.skyAtmosphere =  false; //关闭地球光环

let viewer = new Cesium.Viewer(element, this._option);
viewer._cesiumWidget._creditContainer.style.display = &quot;none&quot;; // 隐藏版权
viewer.scene.screenSpaceCameraController.zoomEventTypes = [
    Cesium.CameraEventType.WHEEL,
    Cesium.CameraEventType.PINCH,
];
viewer.scene.screenSpaceCameraController.tiltEventTypes = [
    Cesium.CameraEventType.PINCH,
    Cesium.CameraEventType.RIGHT_DRAG,
];
viewer.scene.skyBox.show = true;
//viewer.scene.backgroundColor = new Cesium.Color(0.0, 0.0, 0.0, 0.0);
//去掉entity的点击事件 start
viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);
viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
//去掉entity的点击事件 end
viewer.scene.globe.depthTestAgainstTerrain = true;//深度检测

return viewer;
</code></pre>
<p>}</p>
<h2 id="添加3dtile"><a href="#添加3dtile" class="headerlink" title="添加3dtile"></a>添加3dtile</h2><pre><code> new Cesium.Cesium3DTileset(params).readyPromise
  .then((tileset) =&gt; &#123;
    // console.log( tileset )

    that.tileset = tileset;

    that._scene.primitives.add(tileset);

    var position = that.getCartographic(tileset);

    that.position = position;
    //console.log(that.position)
    //that._flyTo(position[0], position[1], position[2]);
    
    that._viewer.zoomTo(tileset);

    that._cb.call(that,position);

    //添加悬浮样式
    if (
      that._option.showArea &amp;&amp;
      that._option.showArea.show &amp;&amp;
      that._option.showArea.material
    ) &#123;
      that.addShowArea(that._option.showArea.material, position);
    &#125;
    //是否拖拽
    if (that._option.drag) &#123;
      that.creatArrowPolyLine(tileset, position);
    &#125;
    //是否旋转
    if (that._option.rorate) &#123;
      that.createAxisSphere(tileset, position);
    &#125;
    //是否缩放
    if (that._option.scale) &#123;
      that.createScaleAxisSphere(tileset, position);
    &#125;
    that._initEvent2();
  &#125;)
  .otherwise(function(error) &#123;
    console.log(error);
  &#125;);
</code></pre>
<h2 id="添加glb"><a href="#添加glb" class="headerlink" title="添加glb"></a>添加glb</h2><p>let model = this._scene.primitives.add(Cesium.Model.fromGltf(params));</p>
<pre><code>    model.readyPromise.then((model) =&gt; &#123;

        that.model = model;



        try &#123;

            // Play and loop all animations at half-spead
            // model.activeAnimations.addAll(&#123;
            //     speedup : 0.5,
            //     loop : Cesium.ModelAnimationLoop.REPEAT
            // &#125;);


            that._flyTo(lng, lat, alt);

            that._cb.call(that);



            if (that._option.showArea &amp;&amp; that._option.showArea.show &amp;&amp; that._option.showArea.material) &#123;

                that.addShowArea(that._option.showArea.material)
            &#125;

            //是否拖拽
            if (that._option.drag) &#123;

                that.creatArrowPolyLine(model, this._option.position)


            &#125;

            //是否缩放
            if (that._option.needscale) &#123;

                that.createScaleAxisSphere(model, this._option.position)

            &#125;

            that._initEvent()

        &#125; catch (error) &#123;
            console.log(error)
        &#125;

    &#125;)

&#125;
var materials = new farsee3D.materials(&#39;EllipsoidFade&#39;,&#123;color:Cesium.Color.AQUAMARINE,time:3000&#125;);
</code></pre>
<h2 id="flyTo"><a href="#flyTo" class="headerlink" title="flyTo"></a>flyTo</h2><pre><code>this.viewerFlyTo = function (entity, heading, pitch, range) &#123;
    this.viewer.flyTo(entity, &#123;
        offset: &#123;
            heading: Cesium.Math.toRadians(heading),
            pitch: Cesium.Math.toRadians(pitch),
            range: range
        &#125;
    &#125;);
&#125;
this.cameraFlyTo = function (pos, heading, pitch, roll) &#123;
    viewer.camera.flyTo(&#123;
        destination: Cesium.Cartesian3.fromDegrees(pos[0], pos[1], pos[2]),
        orientation: &#123;
            heading: Cesium.Math.toRadians(heading),
            pitch: Cesium.Math.toRadians(pitch),
            roll: roll
        &#125;
    &#125;);
&#125;
</code></pre>
<p>GeoJsonDataSource<br>    GeoJsonDataSource: function (geojsonUrl, callBack) {<br>        var promise = Cesium.GeoJsonDataSource.load(geojsonUrl)<br>        promise.then(function (dataSource) {<br>            callBack(dataSource);<br>        })<br>        return promise<br>    }</p>
<h2 id="camera"><a href="#camera" class="headerlink" title="camera"></a>camera</h2><pre><code>// 获取当前镜头位置的笛卡尔坐标
let cameraPos = viewer.camera.position;
// 获取当前坐标系标准
let ellipsoid = viewer.scene.globe.ellipsoid;
// 根据坐标系标准，将笛卡尔坐标转换为地理坐标
let cartographic = ellipsoid.cartesianToCartographic(cameraPos);
// 获取镜头的高度
let height = cartographic.height;
// 根据上面当前镜头的位置，获取该中心位置的经纬度坐标
this.centerLon = parseFloat(Cesium.Math.toDegrees(cartographic.longitude).toFixed(8));
this.centerLat = parseFloat(Cesium.Math.toDegrees(cartographic.latitude).toFixed(8));
this.zoomIn = function () &#123;
    viewer.camera.flyTo(&#123;
        destination: Cesium.Cartesian3.fromDegrees(this.centerLon, this.centerLat, height / 1.8),
        duration: 1.0
    &#125;);
&#125;
this.out = function () &#123;
    viewer.camera.flyTo(&#123;
        destination: Cesium.Cartesian3.fromDegrees(this.centerLon, this.centerLat, height * 1.8),
        duration: 1.0
    &#125;);
&#125;
</code></pre>
<h2 id="坐标转换"><a href="#坐标转换" class="headerlink" title="坐标转换"></a>坐标转换</h2><pre><code> WHCGCE2000ToWGS84(coord) &#123;
    var wgs84 = &#39;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs  &#39;;
    var WHCGCE2000 = &#39;+proj=tmerc +lat_0=0 +lon_0=114.3333333333333 +k=1 +x_0=800000 +y_0=-3000000.0 +ellps=GRS80 +units=m +no_defs&#39;;
    return proj4(WHCGCE2000, wgs84, coord)
&#125;,
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift241Cesium%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift241Cesium%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">Cesium分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-14 21:42:50" itemprop="dateModified" datetime="2022-03-14T21:42:50+08:00">2022-03-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>坡度分析<br>slope<br>等高线<br>contourLine<br>地形开挖<br>clipping<br>淹没分析<br>SubmergeAnalysis<br>光照分析<br>SunshineAnalysis<br>坐标<br>WHCGCE2000ToWGS84<br>三维飞行初始化<br>flycesium<br>ViewShedStage<br>addHeatMap<br>addBillboard<br>addSkyBoxFn<br>DrawTool</p>
<h2 id="山谷、山脊"><a href="#山谷、山脊" class="headerlink" title="山谷、山脊"></a>山谷、山脊</h2><p>export const elevation = function (viewer, show) {<br>    viewer.scene.globe.enableLighting = true;<br>    var elevationRamp = [0.0, 0.045, 0.1, 0.15, 0.37, 0.54, 1.0];<br>    function getColorRamp(selectedShading) {<br>      var ramp = document.createElement(“canvas”);<br>      ramp.width = 100;<br>      ramp.height = 1;<br>      var ctx = ramp.getContext(“2d”);<br>      var values;<br>      if (selectedShading === “elevation”) {<br>        values = elevationRamp;<br>      }<br>      var grd = ctx.createLinearGradient(0, 0, 100, 0);<br>      grd.addColorStop(values[0], “#000000”); //black<br>      grd.addColorStop(values[1], “#2747E0”); //blue<br>      grd.addColorStop(values[2], “#D33B7D”); //pink<br>      grd.addColorStop(values[3], “#D33038”); //red<br>      grd.addColorStop(values[4], “#FF9742”); //orange<br>      grd.addColorStop(values[5], “#ffd700”); //yellow<br>      grd.addColorStop(values[6], “#ffffff”); //white<br>      ctx.fillStyle = grd;<br>      ctx.fillRect(0, 0, 100, 1);<br>      return ramp;<br>    }</p>
<pre><code>var minHeight = -414.0; // approximate dead sea elevation
var maxHeight = 8777.0; // approximate everest elevation
var contourColor = Cesium.Color.RED.clone();
var contourUniforms = &#123;&#125;;
var shadingUniforms = &#123;&#125;;

// The viewModel tracks the state of our mini application.
var viewModel = &#123;
  selectedShading: &quot;elevation&quot;,
  changeColor: function () &#123;
    contourUniforms.color = Cesium.Color.fromRandom(
      &#123; alpha: 1.0 &#125;,
      contourColor
    );
  &#125;,
&#125;;
function updateMaterial(selectedShading) &#123;
  viewModel.selectedShading = selectedShading;
  var globe = viewer.scene.globe;
  var material;
  if (selectedShading === &quot;elevation&quot;) &#123;
    material = Cesium.Material.fromType(&quot;ElevationRamp&quot;);
    shadingUniforms = material.uniforms;
    shadingUniforms.minimumHeight = minHeight;
    shadingUniforms.maximumHeight = maxHeight;
  &#125; 
  if (selectedShading !== &quot;none&quot;) &#123;
    shadingUniforms.image = getColorRamp(selectedShading);
  &#125;
  globe.material = material;
&#125;
updateMaterial(show? &quot;elevation&quot; : &quot;none&quot;);
</code></pre>
<p>}</p>
<h2 id="坡度分析"><a href="#坡度分析" class="headerlink" title="坡度分析"></a>坡度分析</h2><p>export const slope = function(viewer){<br>    viewer.scene.globe.enableLighting = true;<br>    var material = Cesium.Material.fromType(‘SlopeRamp’);<br>    var shadingUniforms = material.uniforms;<br>    shadingUniforms.image = getColorRamp();<br>    viewer.scene.globe.material = material;<br>    function getColorRamp() {<br>        var ramp = document.createElement(‘canvas’);<br>        ramp.width = 100;<br>        ramp.height = 1;<br>        var ctx = ramp.getContext(‘2d’);</p>
<pre><code>    var grd = ctx.createLinearGradient(0, 0, 100, 0);
   
    // var values = [0.0, 0.25,0.5];

    var values = [0.0,0.2,0.6,1];
    grd.addColorStop(values[0], &#39;rgba(0,0,0,0.0)&#39;); //black
    grd.addColorStop(values[1], &#39;rgba(220,20,60,0.6)&#39;); //blue
    grd.addColorStop(values[2], &#39;rgba(255,255,0,1.0)&#39;); //
    grd.addColorStop(values[3], &#39;rgba(255,0,255,1.0)&#39;); //green

    // var values = [0.0, 0.25, 0.5];
    // grd.addColorStop(values[0], &#39;rgba(0,0,0,0.8)&#39;); //black
    // grd.addColorStop(values[1], &#39;rgba(39,71,224,0.8)&#39;); //blue
    // grd.addColorStop(values[2], &#39;rgba(211,48,56,0.8)&#39;); //red

    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, 100, 1);
    return ramp;
&#125;
</code></pre>
<p>}</p>
<h2 id="等高线"><a href="#等高线" class="headerlink" title="等高线"></a>等高线</h2><p>export const contourLine = function (viewer) {</p>
<pre><code>viewer.scene.globe.enableLighting = true;

// 创建一个拥有高程阴影和等高线的组合样式
function getElevationContourMaterial() &#123;
    return new Cesium.Material(&#123;
        fabric: &#123;
            type: &#39;ElevationColorContour&#39;,
            materials: &#123;
                contourMaterial: &#123;
                    type: &#39;ElevationContour&#39;
                &#125;,
                elevationRampMaterial: &#123;
                    type: &#39;ElevationRamp&#39;
                &#125;
            &#125;,
            components: &#123;
                diffuse: &#39;contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse&#39;,
                alpha: &#39;max(contourMaterial.alpha, elevationRampMaterial.alpha)&#39;
            &#125;
        &#125;,
        translucent: false
    &#125;);
&#125;

var minHeight = 50.0; // 最低接近死海高度
var maxHeight = 1000.0; // 最高接近珠峰高度
var contourColor = Cesium.Color.AQUA.withAlpha(0.8); // 等高线的颜色
var contourSpacing = 100.0; // 等高线的等间距
var contourWidth = 2.0; // 等高线的宽度

// 1、高程阴影
// var material = Cesium.Material.fromType(&#39;ElevationRamp&#39;);
// var shadingUniforms = material.uniforms;
// shadingUniforms.minimumHeight = minHeight;
// shadingUniforms.maximumHeight = maxHeight;
// shadingUniforms.image = getColorRamp();

// 2、等高线
// var material = Cesium.Material.fromType(&#39;ElevationContour&#39;);
// var contourUniforms = material.uniforms;
// contourUniforms.width = contourWidth;
// contourUniforms.spacing = contourSpacing;
// contourUniforms.color = contourColor;

// 3、高程阴影+等高线
var material = getElevationContourMaterial();
var shadingUniforms = material.materials.elevationRampMaterial.uniforms;
shadingUniforms.minimumHeight = minHeight;
shadingUniforms.maximumHeight = maxHeight;
shadingUniforms.image = getColorRamp();

var contourUniforms = material.materials.contourMaterial.uniforms;
contourUniforms.width = contourWidth;
contourUniforms.spacing = contourSpacing;
contourUniforms.color = contourColor;
viewer.scene.globe.material = material;

function getColorRamp() &#123;
    var ramp = document.createElement(&#39;canvas&#39;);
    ramp.width = 100;
    ramp.height = 1;
    var ctx = ramp.getContext(&#39;2d&#39;);
    var values = [0.0, 0.045, 0.1, 0.15, 0.37, 0.54, 1.0];
    var grd = ctx.createLinearGradient(0, 0, 100, 0);

    // grd.addColorStop(values[0], &#39;rgba(0,0,0,0.0)&#39;); //black
    // grd.addColorStop(values[1], &#39;rgba(39,71,224,0.8)&#39;); //blue
    // grd.addColorStop(values[2], &#39;rgba(211,59,125,0.8)&#39;); //pink
    // grd.addColorStop(values[3], &#39;rgba(211,48,56,0.8)&#39;); //red
    // grd.addColorStop(values[4], &#39;rgba(255,151,66,0.8)&#39;); //orange
    // grd.addColorStop(values[5], &#39;rgba(255,215,0,0.8)&#39;); //yellow
    // grd.addColorStop(values[6], &#39;rgba(255,255,255,0.8)&#39;); //white


    grd.addColorStop(values[0], &#39;rgba(255,255,255,0)&#39;); //black
    grd.addColorStop(values[1], &#39;rgba(39,71,224,0.8)&#39;); //blue
    grd.addColorStop(values[2], &#39;rgba(211,59,125,0.8)&#39;); //pink
    grd.addColorStop(values[3], &#39;rgba(211,48,56,0.8)&#39;); //red
    grd.addColorStop(values[4], &#39;rgba(255,151,66,0.8)&#39;); //orange
    grd.addColorStop(values[5], &#39;rgba(255,215,0,0.8)&#39;); //yellow
    grd.addColorStop(values[6], &#39;rgba(255,255,255,0.8)&#39;); //white

   


    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, 100, 1);
    return ramp;
&#125;
</code></pre>
<p>}</p>
<h2 id="地形开挖"><a href="#地形开挖" class="headerlink" title="地形开挖"></a>地形开挖</h2><p>class ClippingPlane {<br>  constructor(tileset,viewer,image) {<br>    this._viewer = viewer;<br>    this.activeShapePoints = [];<br>    this.activeShape = null;<br>    this.floatingPoint = null;<br>    this.points = [];<br>    this.drawingMode = “polygon”; //多边形<br>    this.handler = null;<br>    this.image = image;<br>    this.init();<br>  }<br>  /**</p>
<ul>
<li><p>绑定点击事件</p>
</li>
<li><p>/<br>init() {</p>
<p>let that = this;</p>
<p>that.handler = new Cesium.ScreenSpaceEventHandler(that._viewer.canvas);</p>
<p>//双击鼠标左键清除默认事件<br>that._viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(<br>  Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK<br>);</p>
<p>that.handler.setInputAction(function(event) {</p>
<p>  // We use <code>viewer.scene.pickPosition</code> here instead of <code>viewer.camera.pickEllipsoid</code> so that<br>  // we get the correct point when mousing over terrain.<br>  // scene.pickPosition只有在开启地形深度检测，且不使用默认地形时是准确的。<br>  var earthPosition = that._viewer.scene.pickPosition(event.position);</p>
<p>  // <code>earthPosition</code> will be undefined if our mouse is not over the globe.<br>  if (Cesium.defined(earthPosition)) {</p>
<pre><code>if (that.activeShapePoints.length === 0) &#123;
  that.floatingPoint = that.createPoint(earthPosition);
  that.activeShapePoints.push(earthPosition);
  var dynamicPositions = new Cesium.CallbackProperty(function() &#123;
    if (that.drawingMode === &quot;polygon&quot;) &#123;
      return new Cesium.PolygonHierarchy(that.activeShapePoints);
    &#125;
    return that.activeShapePoints;
  &#125;, false);
  that.activeShape = that.drawShape(dynamicPositions); //绘制动态图
&#125;
that.activeShapePoints.push(earthPosition);
that.points.push(earthPosition)
that.createPoint(earthPosition);
</code></pre>
<p>  }<br>}, Cesium.ScreenSpaceEventType.LEFT_CLICK);</p>
<p>//鼠标移动<br>that.handler.setInputAction(function(event) {<br>  if (Cesium.defined(that.floatingPoint)) {</p>
<pre><code>var newPosition = that._viewer.scene.pickPosition(event.endPosition);
if (Cesium.defined(newPosition)) &#123;
  that.floatingPoint.position.setValue(newPosition);
  that.activeShapePoints.pop();
  that.activeShapePoints.push(newPosition);
&#125;
</code></pre>
<p>  }<br>}, Cesium.ScreenSpaceEventType.MOUSE_MOVE);</p>
<p>that.handler.setInputAction(function(event) {<br>  that._viewer.entities.remove(that.activeShape);<br>  that._viewer.entities.remove(that.floatingPoint);<br>  var earthPosition = that._viewer.scene.pickPosition(event.position);<br>  that.points.push(earthPosition);<br>  // console.log(‘points’, that.points);<br>  var planes = that.createClippingPlane(that.points);<br>  // console.log(‘planes’,planes)<br>  //赋值给globe的 clippingPlanes<br>  that._viewer.scene.globe.clippingPlanes = new Cesium.ClippingPlaneCollection({</p>
<pre><code>  planes: planes,
  edgeWidth: 1.0,
  edgeColor: Cesium.Color.WHITE
</code></pre>
<p>  })<br>  //依次计算顶点与下个顶点之间组成的线段，中间按照精度大小插值n个点，然后计算每个点的地形高度<br>  let promises = []<br>  for (let i = 0; i &lt; that.points.length - 1; i++) {</p>
<pre><code>  promises.push(that.calHeight(that._viewer, that.points[i], that.points[i + 1], 100)); // 返回promise对象
</code></pre>
<p>  }<br>  // 待所有的计算完毕后，处理坐标点，构造多边形<br>  Promise.all([…promises]).then(data =&gt; {</p>
<pre><code>  var positons = Array.prototype.concat.apply([], data); // 数组降维
  var hierarchy = [];
  positons.forEach(element =&gt; &#123;
      hierarchy.push(Cesium.Math.toDegrees(element.longitude));
      hierarchy.push(Cesium.Math.toDegrees(element.latitude));
      hierarchy.push(element.height);
  &#125;);
  that._viewer.entities.add(&#123;
      polygon: &#123;
          hierarchy: Cesium.Cartesian3.fromDegreesArrayHeights(hierarchy),
          closeTop: false, // 这个要设置为false
      material: that.image ?
        new Cesium.ImageMaterialProperty(&#123;
          image:that.image,
          // repeat:new Cesium.Cartesian2(100.0, 100.0)
        &#125;) : new Cesium.ColorMaterialProperty(Cesium.Color.BROWN),                  
          extrudedHeight: 0,
          perPositionHeight: true // 这个要设置true
      &#125;
  &#125;);
</code></pre>
<p>  })<br>}, Cesium.ScreenSpaceEventType.RIGHT_CLICK);<br>}<br>/**</p>
</li>
<li><p>根据点集计算 ClippingPlane</p>
</li>
<li><p>@param {*} points </p>
</li>
<li><p>@returns </p>
</li>
<li><p>/<br>createClippingPlane(points) {<br>var pointsLength = points.length;<br>var clippingPlanes = []; // 存储ClippingPlane集合<br>for (var i = 0; i &lt; pointsLength; ++i) {<br>  var nextIndex = (i + 1) % pointsLength;<br>  var midpoint = Cesium.Cartesian3.add(</p>
<pre><code>points[i],
points[nextIndex],
new Cesium.Cartesian3()
</code></pre>
<p>  );<br>  midpoint = Cesium.Cartesian3.multiplyByScalar(midpoint, 0.5, midpoint);<br>  var up = Cesium.Cartesian3.normalize(midpoint, new Cesium.Cartesian3());<br>  var right = Cesium.Cartesian3.subtract(</p>
<pre><code>points[nextIndex],
midpoint,
new Cesium.Cartesian3()
</code></pre>
<p>  );<br>  right = Cesium.Cartesian3.normalize(right, right);<br>  var normal = Cesium.Cartesian3.cross(right, up, new Cesium.Cartesian3());<br>  normal = Cesium.Cartesian3.normalize(normal, normal);<br>  var originCenteredPlane = new Cesium.Plane(normal, 0.0);<br>  var distance = Cesium.Plane.getPointDistance(</p>
<pre><code>originCenteredPlane,
midpoint
</code></pre>
<p>  );<br>  clippingPlanes.push(new Cesium.ClippingPlane(normal, distance));<br>}<br>return clippingPlanes;<br>}<br>/**</p>
</li>
<li><p>插值、计算坐标点高度（如果不加载地形的话，这步可以省略）</p>
</li>
<li><p>@param {*} viewer </p>
</li>
<li><p>@param {*} fromPoint </p>
</li>
<li><p>@param {*} endPoint </p>
</li>
<li><p>@param {*} count </p>
</li>
<li><p>@returns </p>
</li>
<li><p>/<br>calHeight(viewer, fromPoint, endPoint, count) {<br>var positions = [];<br>for (var i = 0; i &lt;= count; i++) {<br>  var cart = Cesium.Cartesian3.lerp(</p>
<pre><code>fromPoint,
endPoint,
i / count,
new Cesium.Cartesian3()
</code></pre>
<p>  );<br>  positions.push(Cesium.Cartographic.fromCartesian(cart));<br>}<br>return new Promise((resolve, reject) =&gt; {<br>  var promise = Cesium.sampleTerrainMostDetailed(</p>
<pre><code>viewer.terrainProvider,
positions
</code></pre>
<p>  );<br>  Cesium.when(promise, function(updatedPositions) {</p>
<pre><code>resolve(updatedPositions);
</code></pre>
<p>  });<br>});<br>}<br>//绘制点<br>createPoint(worldPosition) {<br>var point = this._viewer.entities.add({<br>  position: worldPosition,<br>  point: {</p>
<pre><code>color: Cesium.Color.GREENYELLOW,
pixelSize: 9,
heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
</code></pre>
<p>  },<br>});<br>return point;<br>}<br>//绘制图形<br>drawShape(positionData) {<br>var that = this;<br>var shape;<br>shape = that._viewer.entities.add({<br>  polygon: {</p>
<pre><code>hierarchy: positionData,
perPositionHeight: true,
extrudedHeight: 4,
//new Cesium.Color.fromBytes(0,191,255,100),
//new Cesium.ColorMaterialProperty(Cesium.Color.AQUA.withAlpha(0.3))
material: new Cesium.Color.fromBytes(0, 191, 255, 100),
</code></pre>
<p>  },<br>});<br>return shape;<br>}</p>
</li>
</ul>
<p>  clear(){<br>    this._viewer.scene.globe.clippingPlanes &amp;&amp;  this._viewer.scene.globe.clippingPlanes.removeAll();<br>    this._viewer.entities.removeAll();<br>    this.activeShapePoints = [];<br>    this.activeShape = null;<br>    this.floatingPoint = null;<br>    this.points = [];<br>  }<br>}</p>
<h2 id="日照分析"><a href="#日照分析" class="headerlink" title="日照分析"></a>日照分析</h2><p>class SunshineAnalysis{</p>
<pre><code>    constructor(option)&#123;
          this._viewer = option.viewer
          this.init();
          this.eventBus = &#123;&#125;;
    &#125;

    init()&#123;
        
    &#125;

    $on(event, cb) &#123;
        if (!this.eventBus[event]) &#123;
            this.eventBus[event] = new Set()
        &#125;
        this.eventBus[event].add(cb)
    &#125;
    $emit(event, ...args) &#123;

        if (this.eventBus[event]) &#123;
            Array.from(this.eventBus[event]).forEach((handle) =&gt; &#123;

                handle.call(this, args)
            &#125;)
        &#125;
    &#125;
    $off(event, cb) &#123;
        if (this.eventBus[event]) &#123;
            this.eventBus[event].delete(cb)
        &#125;
    &#125;
</code></pre>
<p>}</p>
<h2 id="可视域分析"><a href="#可视域分析" class="headerlink" title="可视域分析"></a>可视域分析</h2><p>/**</p>
<ul>
<li>可视域分析。</li>
<li>@author</li>
<li>@date</li>
<li>@alias ViewShedStage</li>
<li>@class</li>
<li>@param {Cesium.Viewer} viewer Cesium三维视窗。</li>
<li>@param {Object} options 选项。</li>
<li>@param {Cesium.Cartesian3} options.viewPosition 观测点位置。</li>
<li>@param {Cesium.Cartesian3} options.viewPositionEnd 最远观测点位置（如果设置了观测距离，这个属性可以不设置）。</li>
<li>@param {Number} options.viewDistance 观测距离（单位<code>米</code>，默认值100）。</li>
<li>@param {Number} options.viewHeading 航向角（单位<code>度</code>，默认值0）。</li>
<li>@param {Number} options.viewPitch 俯仰角（单位<code>度</code>，默认值0）。</li>
<li>@param {Number} options.horizontalViewAngle 可视域水平夹角（单位<code>度</code>，默认值90）。</li>
<li>@param {Number} options.verticalViewAngle 可视域垂直夹角（单位<code>度</code>，默认值60）。</li>
<li>@param {Cesium.Color} options.visibleAreaColor 可视区域颜色（默认值<code>绿色</code>）。</li>
<li>@param {Cesium.Color} options.invisibleAreaColor 不可视区域颜色（默认值<code>红色</code>）。</li>
<li>@param {Boolean} options.enabled 阴影贴图是否可用。</li>
<li>@param {Boolean} options.softShadows 是否启用柔和阴影。</li>
<li>@param {Boolean} options.size 每个阴影贴图的大小。</li>
<li>/</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift239Cesium%E6%B5%8B%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift239Cesium%E6%B5%8B%E9%87%8F/" class="post-title-link" itemprop="url">Cesium测量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-28 15:00:43" itemprop="dateModified" datetime="2021-09-28T15:00:43+08:00">2021-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>import proj4 from “proj4”;</p>
<p>if (typeof Cesium !== ‘undefined’)<br>    /**</p>
<pre><code> * @author zhangti
 * @param viewer  &#123;object&#125; 三维对象
 * @param options &#123;object&#125; 初始化参数
 * @constructor
 */
Cesium.Measure = (function (Cesium) &#123;

    /**
     * 绘制对象
     * @param viewer
     * @param options
     * @constructor
     */
    function _(viewer, options = &#123;&#125;) &#123;

        if (viewer &amp;&amp; viewer instanceof Cesium.Viewer) &#123;

            this._drawLayer = new Cesium.CustomDataSource(&#39;measureLayer&#39;);

            viewer &amp;&amp; viewer.dataSources.add(this._drawLayer);

            this._basePath = options.basePath || &#39;&#39;;

            this._viewer = viewer;
            
            this.handler = null
        &#125;
    &#125;

    _.prototype = &#123;
        /***
         * 坐标转换 84转笛卡尔
         *
         * @param &#123;Object&#125; &#123;lng,lat,alt&#125; 地理坐标
         *
         * @return &#123;Object&#125; Cartesian3 三维位置坐标
         */
        transformWGS84ToCartesian: function (position, alt) &#123;
            if (this._viewer) &#123;
                return position
                    ? Cesium.Cartesian3.fromDegrees(
                        position.lng || position.lon,
                        position.lat,
                        position.alt = alt || position.alt,
                        Cesium.Ellipsoid.WGS84
                    )
                    : Cesium.Cartesian3.ZERO
            &#125;
        &#125;,
        /***
         * 坐标数组转换 笛卡尔转84
         *
         * @param &#123;Array&#125; WSG84Arr &#123;lng,lat,alt&#125; 地理坐标数组
         * @param &#123;Number&#125; alt 拔高
         * @return &#123;Array&#125; Cartesian3 三维位置坐标数组
         */
        transformWGS84ArrayToCartesianArray: function (WSG84Arr, alt) &#123;
            if (this._viewer &amp;&amp; WSG84Arr) &#123;
                var $this = this
                return WSG84Arr
                    ? WSG84Arr.map(function (item) &#123;
                        return $this.transformWGS84ToCartesian(item, alt)
                    &#125;)
                    : []
            &#125;
        &#125;,
        /***
         * 坐标转换 笛卡尔转84
         *
         * @param &#123;Object&#125; Cartesian3 三维位置坐标
         *
         * @return &#123;Object&#125; &#123;lng,lat,alt&#125; 地理坐标
         */
        transformCartesianToWGS84: function (cartesian) &#123;
            if (this._viewer &amp;&amp; cartesian) &#123;
                var ellipsoid = Cesium.Ellipsoid.WGS84
                var cartographic = ellipsoid.cartesianToCartographic(cartesian)
                return &#123;
                    lng: Cesium.Math.toDegrees(cartographic.longitude),
                    lat: Cesium.Math.toDegrees(cartographic.latitude),
                    alt: cartographic.height
                &#125;
            &#125;
        &#125;,
        /***
         * 坐标数组转换 笛卡尔转86
         *
         * @param &#123;Array&#125; cartesianArr 三维位置坐标数组
         *
         * @return &#123;Array&#125; &#123;lng,lat,alt&#125; 地理坐标数组
         */
        transformCartesianArrayToWGS84Array: function (cartesianArr) &#123;
            if (this._viewer) &#123;
                var $this = this
                return cartesianArr
                    ? cartesianArr.map(function (item) &#123;
                        return $this.transformCartesianToWGS84(item)
                    &#125;)
                    : []
            &#125;
        &#125;,
        /**
         * 84坐标转弧度坐标
         * @param &#123;Object&#125; position wgs84
         * @return &#123;Object&#125; Cartographic 弧度坐标
         *
         */
        transformWGS84ToCartographic: function (position) &#123;
            return position
                ? Cesium.Cartographic.fromDegrees(
                    position.lng || position.lon,
                    position.lat,
                    position.alt
                )
                : Cesium.Cartographic.ZERO
        &#125;,
        /**
         * 拾取位置点
         *
         * @param &#123;Object&#125; px 屏幕坐标
         *
         * @return &#123;Object&#125; Cartesian3 三维坐标
         */
        getCatesian3FromPX: function (px) &#123;

            if (this._viewer &amp;&amp; px) &#123;
                var picks = this._viewer.scene.drillPick(px)
                var cartesian = null;
                var isOn3dtiles = false, isOnTerrain = false;
                // drillPick
                for (let i in picks) &#123;
                    let pick = picks[i]

                    if (pick &amp;&amp;
                        pick.primitive instanceof Cesium.Cesium3DTileFeature
                        || pick &amp;&amp; pick.primitive instanceof Cesium.Cesium3DTileset
                        || pick &amp;&amp; pick.primitive instanceof Cesium.Model) &#123; //模型上拾取
                        isOn3dtiles = true;
                    &#125;
                    // 3dtilset
                    if (isOn3dtiles) &#123;
                        this._viewer.scene.pick(px) // pick
                        cartesian = this._viewer.scene.pickPosition(px);
                        if (cartesian) &#123;
                            let cartographic = Cesium.Cartographic.fromCartesian(cartesian);
                            if (cartographic.height &lt; 0) cartographic.height = 0;
                            let lon = Cesium.Math.toDegrees(cartographic.longitude)
                                , lat = Cesium.Math.toDegrees(cartographic.latitude)
                                , height = cartographic.height;
                            cartesian = this.transformWGS84ToCartesian(&#123;lng: lon, lat: lat, alt: height&#125;)

                        &#125;
                    &#125;
                &#125;
                // 地形
                let boolTerrain = this._viewer.terrainProvider instanceof Cesium.EllipsoidTerrainProvider;
                // Terrain
                if (!isOn3dtiles &amp;&amp; !boolTerrain) &#123;
                    var ray = this._viewer.scene.camera.getPickRay(px);
                    if (!ray) return null;
                    cartesian = this._viewer.scene.globe.pick(ray, this._viewer.scene);
                    isOnTerrain = true
                &#125;
                // 地球
                if (!isOn3dtiles &amp;&amp; !isOnTerrain &amp;&amp; boolTerrain) &#123;

                    cartesian = this._viewer.scene.camera.pickEllipsoid(px, this._viewer.scene.globe.ellipsoid);
                &#125;
                if (cartesian) &#123;
                    let position = this.transformCartesianToWGS84(cartesian)
                    if (position.alt &lt; 0) &#123;
                        cartesian = this.transformWGS84ToCartesian(position, 0.1)
                    &#125;
                    return cartesian;
                &#125;
                return false;
            &#125;

        &#125;,
        /**
         * 获取84坐标的距离
         * @param &#123;*&#125; positions
         */
        getPositionDistance: function (positions) &#123;
            let distance = 0
            for (let i = 0; i &lt; positions.length - 1; i++) &#123;
                let point1cartographic = this.transformWGS84ToCartographic(positions[i])
                let point2cartographic = this.transformWGS84ToCartographic(positions[i + 1])
                let geodesic = new Cesium.EllipsoidGeodesic()
                geodesic.setEndPoints(point1cartographic, point2cartographic)
                let s = geodesic.surfaceDistance
                s = Math.sqrt(
                    Math.pow(s, 2) +
                    Math.pow(point2cartographic.height - point1cartographic.height, 2)
                )
                distance = distance + s
            &#125;
            return distance.toFixed(3)
        &#125;,
        /**
         * 计算一组坐标组成多边形的面积
         * @param &#123;*&#125; positions
         */
        getPositionsArea: function (positions) &#123;
            let result = 0
            if (positions) &#123;
                let h = 0
                let ellipsoid = Cesium.Ellipsoid.WGS84
                positions.push(positions[0])
                for (let i = 1; i &lt; positions.length; i++) &#123;
                    let oel = ellipsoid.cartographicToCartesian(
                        this.transformWGS84ToCartographic(positions[i - 1])
                    )
                    let el = ellipsoid.cartographicToCartesian(
                        this.transformWGS84ToCartographic(positions[i])
                    )
                    h += oel.x * el.y - el.x * oel.y
                &#125;
                result = Math.abs(h).toFixed(2)
            &#125;
            return result
        &#125;,
        /**
         * 坐标查看
         */
        coordinateCheck: function (options = &#123;&#125;) &#123;
            if (this._viewer &amp;&amp; options) &#123;

                var positions = [], $this = this;
                $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    if (cartesian &amp;&amp; cartesian.x) &#123;
                        //if (positions.length === 0) &#123;
                        //    positions = cartesian.clone();
                        // &#125;
                        // 添加量测信息点
                        // console.log(cartesian);
                        _addInfoPoint(cartesian)
                        //positions.push(cartesian);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);


                // right
                $this.handler.setInputAction(function (movement) &#123;
                    $this.handler.destroy();
                &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);




                //添加坐标点
                function _addInfoPoint(position) &#123;
                    let wgs84Position = $this.transformCartesianToWGS84(position)
                    var wgs84 = &#39;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs  &#39;;
                    var WHCGCE2000 = &#39;+proj=tmerc +lat_0=0 +lon_0=114.3333333333333 +k=1 +x_0=800000 +y_0=-3000000.0 +ellps=GRS80 +units=m +no_defs&#39;;
                    let newposition = proj4(wgs84, WHCGCE2000, [wgs84Position.lng, wgs84Position.lat,wgs84Position.alt]);
                    options.cb&amp;&amp;options.cb(newposition)
                    var _labelEntity = new Cesium.Entity()
                    _labelEntity.position = position
                    _labelEntity.point = &#123;
                        pixelSize: 8,
                        outlineColor: Cesium.Color.LAWNGREEN,
                        outlineWidth: 2
                    &#125;
                    _labelEntity.label = &#123;
                        text: `$&#123;newposition[0]&#125;,$&#123;newposition[1]&#125;`,//($this.getPositionDistance($this.transformCartesianArrayToWGS84Array(positions)) / 1000).toFixed(4) + &#39;公里&#39;,
                        show: true,
                        showBackground: true,
                        font: &#39;12px Helvetica&#39;,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(-20, -30) //left top
                    &#125;
                    $this._drawLayer.entities.add(_labelEntity)
                &#125;
            &#125;
        &#125;,
        /**
         * 
         * @param &#123;*&#125; callback 
         */
        returnCoordinate:function(callback)&#123;
            if (this._viewer &amp;&amp; callback) &#123;
                var $this = this;
                var heading,pitch;
                $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;
              
                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    let wgs84Position = $this.transformCartesianToWGS84(cartesian);
                    var camera =  $this._viewer.scene.camera;
                    var cartesian2 = $this._viewer.scene.pickPosition(movement.position);
                    if (cartesian2) &#123;
                        heading = Cesium.Math.toDegrees(camera.heading);
                        pitch = Cesium.Math.toDegrees(camera.pitch);
                    &#125;
                    callback(&#123;...wgs84Position,heading,pitch&#125;);
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);
            &#125;
        &#125;,
        /**
         * 测距
         * @param &#123;*&#125; options
         */
        drawLineMeasureGraphics: function (options = &#123;&#125;) &#123;
           

            if (this._viewer &amp;&amp; options) &#123;

                console.log(&#39;测距2&#39;,this)

                var positions = [], _lineEntity = new Cesium.Entity(), $this = this, lineObj;

                $this.handler = new Cesium.ScreenSpaceEventHandler($this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    if (cartesian &amp;&amp; cartesian.x) &#123;
                        if (positions.length == 0) &#123;
                            positions.push(cartesian.clone());
                        &#125;
                        // 添加量测信息点
                        _addInfoPoint(cartesian)
                        positions.push(cartesian);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);

                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.endPosition);
                    if (positions.length &gt;= 2) &#123;
                        if (cartesian &amp;&amp; cartesian.x) &#123;
                            positions.pop();
                            positions.push(cartesian);
                        &#125;
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
                // right
                $this.handler.setInputAction(function (movement) &#123;

                    $this.handler.destroy()
                    $this.handler = null

                    let cartesian = $this.getCatesian3FromPX(movement.position);
                    _addInfoPoint(cartesian)

                    if (typeof options.callback === &#39;function&#39;) &#123;
                        options.callback($this.transformCartesianArrayToWGS84Array(positions), lineObj);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

                _lineEntity.polyline = &#123;
                    width: options.width || 5
                    , material: options.material || Cesium.Color.BLUE.withAlpha(0.8)
                    , clampToGround: options.clampToGround || false
                &#125;
                _lineEntity.polyline.positions = new Cesium.CallbackProperty(function () &#123;
                    return positions
                &#125;, false)
                lineObj = this._drawLayer.entities.add(_lineEntity)

                //添加坐标点
                function _addInfoPoint(position) &#123;
                    var _labelEntity = new Cesium.Entity()
                    _labelEntity.position = position
                    _labelEntity.point = &#123;
                        pixelSize: 10,
                        outlineColor: Cesium.Color.BLUE,
                        outlineWidth: 5
                    &#125;
                    _labelEntity.label = &#123;
                        text: ($this.getPositionDistance($this.transformCartesianArrayToWGS84Array(positions)) / 1000).toFixed(4) + &#39;公里&#39;,
                        show: true,
                        showBackground: true,
                        font: &#39;14px monospace&#39;,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(-20, -80) //left top
                    &#125;
                    $this._drawLayer.entities.add(_labelEntity)
                &#125;
            &#125;

        &#125;,
        /**
         * 测面积
         * @param &#123;*&#125; options
         */
        drawAreaMeasureGraphics: function (options = &#123;&#125;) &#123;

            if (this._viewer &amp;&amp; options) &#123;

                var positions = [], polygon = new Cesium.PolygonHierarchy(), _polygonEntity = new Cesium.Entity(),
                    $this = this, polyObj = null, _label = &#39;&#39;;
                $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    if (cartesian &amp;&amp; cartesian.x) &#123;
                        if (positions.length == 0) &#123;
                            polygon.positions.push(cartesian.clone())
                            positions.push(cartesian.clone());
                        &#125;
                        positions.push(cartesian.clone());
                        polygon.positions.push(cartesian.clone())

                        if (!polyObj) create()
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);
                // mouse
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.endPosition);
                    // var cartesian = $this._viewer.scene.camera.pickEllipsoid(movement.endPosition, $this._viewer.scene.globe.ellipsoid);
                    if (positions.length &gt;= 2) &#123;
                        if (cartesian &amp;&amp; cartesian.x) &#123;
                            positions.pop()
                            positions.push(cartesian);
                            polygon.positions.pop()
                            polygon.positions.push(cartesian);
                        &#125;
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

                // right
                $this.handler.setInputAction(function (movement) &#123;
                    let cartesian = $this.getCatesian3FromPX(movement.endPosition);

                    $this.handler.destroy();

                    positions.push(positions[0]);

                    // 添加信息点
                    _addInfoPoint(positions[0])
                    if (typeof options.callback === &#39;function&#39;) &#123;

                        options.callback($this.transformCartesianArrayToWGS84Array(positions), polyObj);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

                function create() &#123;
                    _polygonEntity.polyline = &#123;
                        width: 3
                        , material: Cesium.Color.BLUE.withAlpha(0.8)
                        , clampToGround: options.clampToGround || false
                    &#125;

                    _polygonEntity.polyline.positions = new Cesium.CallbackProperty(function () &#123;
                        return positions
                    &#125;, false)

                    _polygonEntity.polygon = &#123;

                        hierarchy: new Cesium.CallbackProperty(function () &#123;
                            return polygon
                        &#125;, false),

                        material: Cesium.Color.WHITE.withAlpha(0.1)
                        , clampToGround: options.clampToGround || false
                    &#125;
                    polyObj = $this._drawLayer.entities.add(_polygonEntity)
                &#125;

                function _addInfoPoint(position) &#123;
                    var _labelEntity = new Cesium.Entity()
                    _labelEntity.position = position
                    _labelEntity.point = &#123;
                        pixelSize: 10,
                        outlineColor: Cesium.Color.BLUE,
                        outlineWidth: 5
                    &#125;
                    _labelEntity.label = &#123;
                        text: ($this.getPositionsArea($this.transformCartesianArrayToWGS84Array(positions)) / 1000000.0).toFixed(4) + &#39;平方公里&#39;,
                        show: true,
                        showBackground: true,
                        font: &#39;14px monospace&#39;,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(-20, -50) //left top
                    &#125;
                    $this._drawLayer.entities.add(_labelEntity)
                &#125;
            &#125;

        &#125;,
        /**
         * 画三角量测
         * @param &#123;*&#125; options
         */
        drawTrianglesMeasureGraphics: function (options = &#123;&#125;) &#123;
            options.style = options.style ||
                &#123;
                    width: 3
                    , material: Cesium.Color.BLUE.withAlpha(0.5)
                &#125;
            if (this._viewer &amp;&amp; options) &#123;

                var _trianglesEntity = new Cesium.Entity(), _tempLineEntity = new Cesium.Entity(),
                    _tempLineEntity2 = new Cesium.Entity(),
                    _positions = [], _tempPoints = [], _tempPoints2 = [], $this = this,
                    _handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);

                // 高度
                function _getHeading(startPosition, endPosition) &#123;
                    if (!startPosition &amp;&amp; !endPosition) return 0
                    if (Cesium.Cartesian3.equals(startPosition, endPosition)) return 0
                    let cartographic = Cesium.Cartographic.fromCartesian(startPosition);
                    let cartographic2 = Cesium.Cartographic.fromCartesian(endPosition);
                    return (cartographic2.height - cartographic.height).toFixed(2)
                &#125;

                // 偏移点
                function _computesHorizontalLine(positions) &#123;
                    let cartographic = Cesium.Cartographic.fromCartesian(positions[0]);
                    let cartographic2 = Cesium.Cartographic.fromCartesian(positions[1]);
                    return Cesium.Cartesian3.fromDegrees(
                        Cesium.Math.toDegrees(cartographic.longitude),
                        Cesium.Math.toDegrees(cartographic.latitude),
                        cartographic2.height
                    )
                &#125;

                // left
                _handler.setInputAction(function (movement) &#123;

                    var position = $this.getCatesian3FromPX(movement.position);
                    if (!position &amp;&amp; !position.z) return false
                    if (_positions.length == 0) &#123;
                        _positions.push(position.clone())
                        _positions.push(position.clone())
                        _tempPoints.push(position.clone())
                        _tempPoints.push(position.clone())
                    &#125; else &#123;
                        _handler.destroy();
                        if (typeof options.callback === &#39;function&#39;) &#123;

                            options.callback(&#123;e: _trianglesEntity, e2: _tempLineEntity, e3: _tempLineEntity2&#125;);
                        &#125;
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);
                // mouse
                _handler.setInputAction(function (movement) &#123;

                    var position = $this.getCatesian3FromPX(movement.endPosition);
                    if (position &amp;&amp; _positions.length &gt; 0) &#123;
                        //直线
                        _positions.pop()
                        _positions.push(position.clone());
                        let horizontalPosition = _computesHorizontalLine(_positions)
                        //高度
                        _tempPoints.pop()
                        _tempPoints.push(horizontalPosition.clone())
                        //水平线
                        _tempPoints2.pop(), _tempPoints2.pop()
                        _tempPoints2.push(position.clone())
                        _tempPoints2.push(horizontalPosition.clone())
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE)

                // create entity

                //直线
                _trianglesEntity.polyline = &#123;
                    positions: new Cesium.CallbackProperty(function () &#123;
                        return _positions
                    &#125;, false),
                    ...options.style
                &#125;
                _trianglesEntity.position = new Cesium.CallbackProperty(function () &#123;
                    return _positions[0]
                &#125;, false)
                _trianglesEntity.point = &#123;
                    pixelSize: 5,
                    outlineColor: Cesium.Color.BLUE,
                    outlineWidth: 5
                &#125;
                _trianglesEntity.label = &#123;
                    text: new Cesium.CallbackProperty(function () &#123;
                        return &#39;直线:&#39; + $this.getPositionDistance($this.transformCartesianArrayToWGS84Array(_positions)) + &#39;米&#39;
                    &#125;, false),
                    show: true,
                    showBackground: true,
                    font: &#39;14px monospace&#39;,
                    horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(50, -100) //left top
                &#125;
                //高度
                _tempLineEntity.polyline = &#123;
                    positions: new Cesium.CallbackProperty(function () &#123;
                        return _tempPoints
                    &#125;, false),
                    ...options.style
                &#125;
                _tempLineEntity.position = new Cesium.CallbackProperty(function () &#123;
                    return _tempPoints2[1]
                &#125;, false)
                _tempLineEntity.point = &#123;
                    pixelSize: 5,
                    outlineColor: Cesium.Color.BLUE,
                    outlineWidth: 5
                &#125;
                _tempLineEntity.label = &#123;
                    text: new Cesium.CallbackProperty(function () &#123;
                        return &#39;高度:&#39; + _getHeading(_tempPoints[0], _tempPoints[1]) + &#39;米&#39;
                    &#125;, false),
                    show: true,
                    showBackground: true,
                    font: &#39;14px monospace&#39;,
                    horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(-20, 100) //left top
                &#125;
                //水平
                _tempLineEntity2.polyline = &#123;
                    positions: new Cesium.CallbackProperty(function () &#123;
                        return _tempPoints2
                    &#125;, false),
                    ...options.style
                &#125;
                _tempLineEntity2.position = new Cesium.CallbackProperty(function () &#123;
                    return _positions[1]
                &#125;, false)
                _tempLineEntity2.point = &#123;
                    pixelSize: 5,
                    outlineColor: Cesium.Color.BLUE,
                    outlineWidth: 5
                &#125;
                _tempLineEntity2.label = &#123;
                    text: new Cesium.CallbackProperty(function () &#123;
                        return &#39;水平距离:&#39; + $this.getPositionDistance($this.transformCartesianArrayToWGS84Array(_tempPoints2)) + &#39;米&#39;
                    &#125;, false),
                    show: true,
                    showBackground: true,
                    font: &#39;14px monospace&#39;,
                    horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(-150, -20) //left top
                &#125;
                this._drawLayer.entities.add(_tempLineEntity2)
                this._drawLayer.entities.add(_tempLineEntity)
                this._drawLayer.entities.add(_trianglesEntity)
            &#125;
        &#125;,

        /**
         * 测高度
         * */
        //****************************高度测量 第一个点的经纬度，第二个点的高度，两点水平距离为半径************************************************//
        drawHeightMeasureGraphics: function () &#123;
            let viewer = this._viewer;
            let $this = this;
            var _lineEntity = new Cesium.Entity();
            // var handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
            $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
            var positions = [];
            var poly = null;
            var tooltip = document.getElementById(&quot;toolTip&quot;);
            var height = 0;
            var cartesian = null;
            tooltip.style.display = &quot;block&quot;;

            $this.handler.setInputAction(function (movement) &#123;
                tooltip.style.left = movement.endPosition.x + 3 + &quot;px&quot;;
                tooltip.style.top = movement.endPosition.y - 25 + &quot;px&quot;;
                tooltip.style.color = &#39;#ffffff&#39;
                tooltip.innerHTML = &#39;&lt;p&gt;单击左键开始，单击右键结束&lt;/p&gt;&#39;;
                cartesian = viewer.scene.pickPosition(movement.endPosition);
                if (positions.length &gt;= 2) &#123;
                    if (!Cesium.defined(poly)) &#123;
                        poly = new PolyLinePrimitive(positions);
                    &#125; else &#123;
                        positions.pop();
                        positions.push(cartesian);
                    &#125;
                    height = getHeight(positions);
                &#125;
            &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

            $this.handler.setInputAction(function (movement) &#123;
                tooltip.style.display = &quot;none&quot;;
                cartesian = viewer.scene.pickPosition(movement.position);
                if (positions.length === 0) &#123;
                    positions.push(cartesian.clone());
                    positions.push(cartesian);
                    _lineEntity.position = positions[0]
                    _lineEntity.point = &#123;
                        pixelSize: 5,
                        color: Cesium.Color.RED,
                        outlineColor: Cesium.Color.WHITE,
                        outlineWidth: 2,
                        heightReference: Cesium.HeightReference.none
                    &#125;
                    _lineEntity.label = &#123;
                        text: &#39;0米&#39;,
                        font: &#39;18px sans-serif&#39;,
                        fillColor: Cesium.Color.GOLD,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        outlineWidth: 2,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(20, -20)
                    &#125;
                    $this._drawLayer.entities.add(_lineEntity)
                &#125;

            &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);

            $this.handler.setInputAction(function (movement) &#123;
                $this.handler.destroy();
                //positions.pop();//清除移动点
                tooltip.style.display = &quot;none&quot;;
                //viewer_g.entities.remove(floatingPoint);
                // console.log(positions);
                //在三维场景中添加Label

                var textDisance = height + &quot;米&quot;;

                var point1cartographic = Cesium.Cartographic.fromCartesian(positions[0]);
                var point2cartographic = Cesium.Cartographic.fromCartesian(positions[1]);
                var point_temp = Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(point1cartographic.longitude), Cesium.Math.toDegrees(point1cartographic.latitude), point2cartographic.height);
                _lineEntity.position = point_temp//positions[1]
                _lineEntity.point = &#123;
                    pixelSize: 5,
                    color: Cesium.Color.RED,
                    outlineColor: Cesium.Color.WHITE,
                    outlineWidth: 2,
                    heightReference: Cesium.HeightReference.none
                &#125;
                _lineEntity.label = &#123;
                    text: textDisance,
                    font: &#39;18px sans-serif&#39;,
                    fillColor: Cesium.Color.GOLD,
                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                    outlineWidth: 2,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(20, -20)
                &#125;
                $this._drawLayer.entities.add(_lineEntity)
            &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

            function getHeight(_positions) &#123;
                var cartographic = Cesium.Cartographic.fromCartesian(_positions[0]);
                var cartographic1 = Cesium.Cartographic.fromCartesian(_positions[1]);
                var height_temp = cartographic1.height - cartographic.height;
                return height_temp.toFixed(2);
            &#125;

            var PolyLinePrimitive = (function () &#123;
                function _(positions) &#123;
                    this.options = &#123;
                        name: &#39;直线&#39;,
                        polyline: &#123;
                            show: true,
                            positions: [],
                            material: Cesium.Color.AQUA,
                            width: 2
                        &#125;,
                        ellipse: &#123;
                            show: true,
                            // semiMinorAxis : 30.0,
                            // semiMajorAxis : 30.0,
                            // height: 20.0,
                            material: Cesium.Color.GREEN.withAlpha(0.5),
                            outline: true // height must be set for outline to display
                        &#125;
                    &#125;;
                    this.positions = positions;
                    this._init();
                &#125;

                _.prototype._init = function () &#123;
                    var _self = this;
                    var _update = function () &#123;
                        var temp_position = [];
                        temp_position.push(_self.positions[0]);
                        var point1cartographic = Cesium.Cartographic.fromCartesian(_self.positions[0]);
                        var point2cartographic = Cesium.Cartographic.fromCartesian(_self.positions[1]);
                        var point_temp = Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(point1cartographic.longitude), Cesium.Math.toDegrees(point1cartographic.latitude), point2cartographic.height);
                        temp_position.push(point_temp);
                        console.log(temp_position);
                        return temp_position;
                    &#125;;
                    var _update_ellipse = function () &#123;
                        return _self.positions[0];
                    &#125;;
                    var _semiMinorAxis = function () &#123;
                        var point1cartographic = Cesium.Cartographic.fromCartesian(_self.positions[0]);
                        var point2cartographic = Cesium.Cartographic.fromCartesian(_self.positions[1]);
                        /**根据经纬度计算出距离**/
                        var geodesic = new Cesium.EllipsoidGeodesic();
                        geodesic.setEndPoints(point1cartographic, point2cartographic);
                        var s = geodesic.surfaceDistance;
                        return s;
                    &#125;;
                    var _height = function () &#123;
                        var height_temp = getHeight(_self.positions);
                        return height_temp;
                    &#125;;
                    //实时更新polyline.positions
                    this.options.polyline.positions = new Cesium.CallbackProperty(_update, false);
                    this.options.position = new Cesium.CallbackProperty(_update_ellipse, false);
                    this.options.ellipse.semiMinorAxis = new Cesium.CallbackProperty(_semiMinorAxis, false);
                    this.options.ellipse.semiMajorAxis = new Cesium.CallbackProperty(_semiMinorAxis, false);
                    this.options.ellipse.height = new Cesium.CallbackProperty(_height, false);
                    $this._drawLayer.entities.add(this.options);
                &#125;;

                return _;
            &#125;)();
        &#125;,
        /**
         * 清除测量
         * @param &#123;*&#125;
         */
        clear: function () &#123;
            this._drawLayer.entities.removeAll()
        &#125;,
        moveHandle:function()&#123;
            if(this._handlers)&#123;
                this._handlers.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
                this._handlers = null
            &#125;  
        &#125;
    &#125;
    return _
&#125;)(Cesium);
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift240Cesium%E9%A3%9E%E8%A1%8C%E6%BC%AB%E6%B8%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift240Cesium%E9%A3%9E%E8%A1%8C%E6%BC%AB%E6%B8%B8/" class="post-title-link" itemprop="url">Cesium飞行漫游</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-14 21:42:47" itemprop="dateModified" datetime="2022-03-14T21:42:47+08:00">2022-03-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>window.bxmap = window.bxmap || {};<br>window.bxmap.FlyCesium = {<br>  cesiumViewer: null,<br>  draw3DObj: null,<br>  drawHelper: null,<br>  isDrawFly: false, //设定路线模式<br>  drawPolyline: null, //飞行绘制路线<br>  data: [<br>    {<br>      id: “1”,<br>      name: “阳江闸坡”,<br>      geojson:<br>        ‘{“orientation”:{“heading”:0.07372076173362352,”pitch”:-1.5574628887292024,”roll”:0},”position”:{“x”:-2205629.231433604,”y”:5509184.64306962,”z”:2331219.615547844},”geometry”:{“type”:”LineString”,”coordinates”:[[111.8181532375421,21.57868178213224],[111.81835028960268,21.578460581633188],[111.81832383076255,21.57812489081727],[111.81847943987464,21.577930686377922],[111.81878489838651,21.57765953027421],[111.81916083936886,21.577412646930927],[111.81958489944898,21.57729241143278],[111.82004766614196,21.57718315464893],[111.8206409631356,21.577000552080584],[111.82134398589339,21.576873639989994],[111.8219423400026,21.576726154070943],[111.822467537162,21.576376210912294],[111.82307030263561,21.576058642812292],[111.8237103973151,21.5756704298083],[111.8240924390803,21.575296152837485],[111.82504071801145,21.575766169089448],[111.82603850185104,21.576124273877287],[111.82694738799758,21.576428149353344],[111.82754018969692,21.576728981595224],[111.828099605676,21.57697046673728],[111.82845968318266,21.577307788777407],[111.8287111214647,21.577998110617774],[111.82881328135024,21.578557636789135],[111.82905095574245,21.57877846306897],[111.82918966895863,21.579074053131905],[111.82928422024466,21.579329257594996],[111.82930019172734,21.579630618390876],[111.82966603969574,21.580020790142015],[111.82960868244719,21.580744679418963],[111.82989219533579,21.581251462292837],[111.83013608532544,21.582236343172],[111.83037855800974,21.58254231013029],[111.83032824715998,21.58299431932842],[111.83001717858694,21.583468817164515],[111.8299185766154,21.584290601587544],[111.82948276544901,21.58496623602712],[111.8289749235787,21.58556878427974],[111.82886305199469,21.585776309810406],[111.8287779821505,21.585946333271792],[111.82865496967007,21.586265136888645],[111.82847674720864,21.586438092096014],[111.82845974740698,21.586567373767977],[111.828355170664,21.586736247366822],[111.82830843296874,21.586863152790087],[111.82825365102633,21.58710380271154],[111.82821734971404,21.587138762444976],[111.82817916952548,21.587294814193356],[111.82787759367034,21.587314539280754],[111.82719468513524,21.587237821164194],[111.82672929414602,21.58716013804561],[111.82658494057793,21.587131014021804],[111.82652478882481,21.587094797111455],[111.82647814913857,21.58694770659332],[111.82649812273736,21.58651375697629],[111.82650209141173,21.586517166652694],[111.82650209141173,21.586517166652694]]}}’,<br>    },<br>  ], //漫游路径信息模拟数据<br>  Init: function(cesiumViewer, drawHelper) {<br>    this.cesiumViewer = cesiumViewer; //cesium对象<br>    this.drawHelper = drawHelper; //drawHelper对象<br>    this.InitEvent();<br>    //this.loadData();<br>  },<br>  InitEvent: function() {<br>    //飞行路径顶端部分的切换事件<br>    // $(“.fly3DPaths_tab li”).bind(“click”, function () {<br>    //     $(‘.fly3DPaths_tab_ul&gt;li’).each(function(index){<br>    //         $(‘.fly3DPaths_tab_ul&gt;li’).eq(index).removeClass(‘select’);<br>    //     })<br>    //     //三角形标识切换<br>    //     switch ($(this).index()) {<br>    //         case 0://预设路线<br>    //             $(‘#overFlyClick’).addClass(‘select’);<br>    //             $(“#overFlyPage”).css({ display: “block” });<br>    //             $(“#drawFlyPage”).css({ display: “none” });<br>    //             bxmap.FlyCesium.loadData();<br>    //             break;<br>    //         case 1://手动绘制<br>    //             $(‘#drawFlyCilck’).addClass(‘select’);<br>    //             $(“#overFlyPage”).css({ display: “none” });<br>    //             $(“#drawFlyPage”).css({ display: “block” });<br>    //             break;<br>    //     }<br>    // });<br>    // //开始飞行<br>    // $(“#start_Fly3DPaths”).click(function(){<br>    //     //debugger;<br>    //     if(bxmap.FlyCesium.draw3DObj){<br>    //         bxmap.FlyCesium.showFly3DPaths(bxmap.FlyCesium.draw3DObj);<br>    //     }else{<br>    //         jDialog.dialog({<br>    //             title: “提示信息”,<br>    //             modal: true,// 非模态，即不显示遮罩层<br>    //             autoClose: 1500,<br>    //             content: “漫游路线不存在”<br>    //         });<br>    //     }<br>    // });<br>    // //暂停飞行<br>    // $(“#pause_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.pauseFly3DPaths();<br>    // });<br>    // //向前飞行<br>    // $(“#playForward_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.playForwardFly3DPaths();<br>    // });<br>    // //向后飞行<br>    // $(“#playReverse_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.playReverseFly3DPaths();<br>    // });<br>    // //退出飞行<br>    // $(“#stop_Fly3DPaths”).click(function(){<br>    //     $(“#cesiumFly3DPaths”).click();<br>    //     bxmap.FlyCesium.stopFly3DPaths();<br>    // });<br>    // //清空路线<br>    // $(“#clear_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.clearFly3DPaths();<br>    // });<br>    //<br>    // //设定路线<br>    // $(“#draw_Fly3DPaths”).click(function(){<br>    //     if(!bxmap.FlyCesium.drawHelper){<br>    //         bxmap.FlyCesium.drawHelper = new this.DrawHelper(bxmap.FlyCesium.cesiumViewer);<br>    //     }<br>    //     bxmap.FlyCesium.draw3DObj = bxmap.FlyCesium.DrawFly3DPaths(bxmap.FlyCesium.drawHelper);<br>    // });<br>    // //保存路线<br>    // $(“#save_Fly3DPaths”).click(function(){<br>    //     if(bxmap.FlyCesium.draw3DObj &amp;&amp; bxmap.FlyCesium.isDrawFly){<br>    //         jDialog.dialog({<br>    //             title: ‘保存路线’,<br>    //             content: ‘<div><span>名称:</span><input type="text" id="FlyAdd_name" value="'+name+'"></div>‘,<br>    //             width: 300,<br>    //             height: 120,<br>    //             modal: true,// 非模态，即不显示遮罩层<br>    //             buttons: [<br>    //                 {<br>    //                     text: ‘确定’,<br>    //                     handler: function (button, dialog) {<br>    //                         var draw3DObj=JSON.stringify(bxmap.FlyCesium.draw3DObj); //将JSON对象转化为JSON字符<br>    //                         var TbFly={id:Math.random().toString(36).substr(2),name:$(“#FlyAdd_name”).val(),geojson:draw3DObj};<br>    //                         bxmap.FlyCesium.data.push(TbFly);<br>    //                         $(“#overFlyClick”).click();<br>    //                         dialog.close();<br>    //                         bxmap.FlyCesium.clearFly3DPaths();<br>    //<br>    //                     }<br>    //                 }, {<br>    //                     text: ‘取消’,<br>    //                     handler: function (button, dialog) {<br>    //                         dialog.close();<br>    //                     }<br>    //                 }<br>    //             ]<br>    //         });<br>    //<br>    //     }else{<br>    //         jDialog.dialog({<br>    //             title: “提示信息”,<br>    //             modal: true,// 非模态，即不显示遮罩层<br>    //             autoClose: 1500,<br>    //             content: “设定的漫游路线不存在，请绘制再保存”<br>    //         });<br>    //     }<br>    //<br>    // });<br>  },<br>  //飞行路径列表表格监听事件<br>  flyTableOnclick: function() {<br>    $(“#overFly_table td”).click(function() {<br>      var trSeq = $(this)<br>        .parent()<br>        .parent()<br>        .find(“tr”)<br>        .index($(this).parent()); //选中的哪行<br>      var geojson = $(<br>        “#overFly_table tr:gt(0):eq(“ + trSeq + “) td:eq(5)”<br>      ).text(); //获取选中行的geojson列值<br>      var name = $(“#overFly_table tr:gt(0):eq(“ + trSeq + “) td:eq(0)”).text(); //获取选中行的name列值<br>      var id = $(“#overFly_table tr:gt(0):eq(“ + trSeq + “) td:eq(4)”).text(); //获取选中行的id列值<br>      geojson = eval(“(“ + geojson + “)”);<br>      var tdSeq = $(this)<br>        .parent()<br>        .find(“td”)<br>        .index($(this)); //选中哪一列<br>      switch (tdSeq) {<br>        case 0: //名称<br>          break;<br>        case 1: //飞行<br>          bxmap.FlyCesium.draw3DObj = geojson;<br>          //bxmap.FlyCesium.cesium.showFly3DPaths(geojson);<br>          bxmap.FlyCesium.showFly3DPaths(geojson);<br>          $(“#drawFlyCilck”).click();<br>          break;<br>        case 2: //修改<br>          jDialog.dialog({<br>            title: “修改路线”,<br>            content:<br>              ‘<div><span>名称:</span><input type="text" id="Fly_name" value="' +
              name +
              '"></div>‘,<br>            width: 300,<br>            height: 120,<br>            modal: true, // 非模态，即不显示遮罩层<br>            buttons: [<br>              {<br>                text: “确定”,<br>                handler: function(button, dialog) {<br>                  bxmap.FlyCesium.data = bxmap.FlyCesium.modifyElement(<br>                    bxmap.FlyCesium.data,<br>                    id,<br>                    $(“#Fly_name”).val()<br>                  );<br>                  $(“#overFlyClick”).click();<br>                  dialog.close();<br>                },<br>              },<br>              {<br>                text: “取消”,<br>                handler: function(button, dialog) {<br>                  dialog.close();<br>                },<br>              },<br>            ],<br>          });<br>          break;<br>        case 3: //删除<br>          //删除<br>          jDialog.dialog({<br>            title: “删除路线”,<br>            modal: true, // 非模态，即不显示遮罩层<br>            content: “确定要删除该漫游路线?”,<br>            buttons: [<br>              {<br>                text: “确定”,<br>                handler: function(button, dialog) {<br>                  bxmap.FlyCesium.data = bxmap.FlyCesium.delElement(<br>                    bxmap.FlyCesium.data,<br>                    id<br>                  );<br>                  $(“#overFlyClick”).click();<br>                  dialog.close();<br>                },<br>              },<br>              {<br>                text: “取消”,<br>                handler: function(button, dialog) {<br>                  dialog.close();<br>                },<br>              },<br>            ],<br>          });<br>          break;<br>      }<br>    });<br>  },<br>  /**<br>     * 从数组中移除指定的元素,要是存在的话<br>     @ serviceArray筛选数组<br>     @ id移除元素id<br>     <em>/<br>  delElement: function(serviceArray, id) {<br>    var array = [];<br>    for (var i = 0; i &lt; serviceArray.length; i++) {<br>      if (serviceArray[i].id != id) {<br>        array.push(serviceArray[i]);<br>      }<br>    }<br>    return array;<br>  },<br>  /**<br>     * 从数组中修改指定的元素,要是存在的话<br>     @ serviceArray筛选数组<br>     @ id修改元素id<br>     @ name修改元素名称<br>     */<br>  modifyElement: function(serviceArray, id, name) {<br>    var array = [];<br>    for (var i = 0; i &lt; serviceArray.length; i++) {<br>      if (serviceArray[i].id == id) {<br>        serviceArray[i].name = name;<br>      }<br>      array.push(serviceArray[i]);<br>    }<br>    return array;<br>  },<br>  loadData: function() {<br>    var data = bxmap.FlyCesium.data;<br>    var html = “”;<br>    if (data.length &gt; 0) {<br>      for (var i = 0; i &lt; data.length; i++) {<br>        var flydata = data[i];<br>        html +=<br>          “<tr>“ +<br>          // ‘<td><input type="checkbox" name="FLYNAME" id="'+flydata.id+'" style="cursor: pointer;" onchange=""></td>‘+<br>          ‘<td><a style="color:#fff;text-decoration:none;font-size:12px;">‘ +<br>          flydata.name +<br>          “</a></td>“ +<br>          ‘<td><button class="btn btn-default btn-xs" style="color:#fff;">飞行</button></td>‘ +<br>          ‘<td><button class="btn btn-default btn-xs" style="color:#fff;">修改</button></td>‘ +<br>          ‘<td><button class="btn btn-default btn-xs" style="color:#fff;">删除</button></td>‘ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.id +<br>          “</a></td>“ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.geojson +<br>          “</a></td>“ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.position +<br>          “</a></td>“ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.orientation +<br>          “</a></td>“ +<br>          “</tr>“;<br>      }<br>      $(“#overFly_table tbody”).html(html);<br>      $(“#overFly_table”)<br>        .find(“td:eq(4)”)<br>        .hide(); //隐藏id字段列<br>      $(“#overFly_table”)<br>        .find(“td:eq(5)”)<br>        .hide(); //隐藏geojson字段列<br>      $(“#overFly_table”)<br>        .find(“td:eq(6)”)<br>        .hide(); //隐藏position字段列<br>      $(“#overFly_table”)<br>        .find(“td:eq(7)”)<br>        .hide(); //隐藏orientation字段列<br>      //表格—行点击事件<br>      bxmap.FlyCesium.flyTableOnclick();<br>    }<br>  },<br>  /</em>*</p>
<ul>
<li><p>清空漫游路径</p>
</li>
<li><p>@method stopFly3DPaths</p>
</li>
<li><p>@param</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>clearFly3DPaths: function() {<br>this.cesiumViewer.trackedEntity = undefined;<br>bxmap.FlyCesium.isDrawFly = false;<br>bxmap.FlyCesium.draw3DObj = null;<br>this.cesiumViewer.entities.removeAll(); //清空所有模型<br>//清空绘制飞行路线<br>if (this.drawPolyline) {<br>  this.cesiumViewer.scene.primitives.remove(this.drawPolyline);<br>  this.drawPolyline = null;<br>}<br>},<br>setFlySpeed(multiplier) {<br>this.cesiumViewer.clock.multiplier = multiplier;<br>},<br>getFlySpeed() {<br>return this.cesiumViewer.clock.multiplier;<br>},<br>/**</p>
</li>
<li><p>飞行漫游路径</p>
</li>
<li><p>@method showFly3DPaths</p>
</li>
<li><p>@param  pathsData 飞行路径信息,格式如下:{“orientation”:{“heading”:2.411783930363565,”pitch”:-0.21097267398444197,”roll”:0.0015622392231300353},”position”: {“x”:-2206260.239730831,”y”:5510911.392077349,”z”:2331987.10863007}, “geometry”:{“type”: “LineString”, “coordinates”: [[101.80089882736969, 26.60700234866561], [101.80082205161088, 26.607156056057718]]} }</p>
</li>
<li><p>@param  position 飞行路径跳转位置</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>showFly3DPaths: function(pathsData) {<br>var T = this;<br>this.clearFly3DPaths();<br>T.cesiumViewer.camera.setView({<br>  destination: pathsData.position,<br>  orientation: pathsData.orientation,<br>});<br>setTimeout(function() {<br>  executeFly3D();<br>}, 200);<br>function executeFly3D() {<br>  if (pathsData &amp;&amp; pathsData.geometry) {</p>
<pre><code>var positionA = pathsData.geometry.coordinates;
var position = [];
if (positionA.length &gt; 0) &#123;
  for (var i = 0; i &lt; positionA.length; i++) &#123;
    var x = positionA[i][0];
    var y = positionA[i][1];
    position.push(&#123; x: x, y: y &#125;);
  &#125;
&#125; else &#123;
  return;
&#125;
function computeCirclularFlight() &#123;
  var property = new Cesium.SampledPositionProperty();
  for (var i = 0; i &lt; position.length; i++) &#123;
    if (i == 0) &#123;
      var time = Cesium.JulianDate.addSeconds(
        start,
        i,
        new Cesium.JulianDate()
      );
      //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170);
      var _position = Cesium.Cartesian3.fromDegrees(
        position[i].x,
        position[i].y,
        0
      );
      property.addSample(time, _position);
    &#125;
    if (i &lt; 10000 &amp;&amp; i &gt; 0) &#123;
      var position_a = new Cesium.Cartesian3(
        property._property._values[i * 3 - 3],
        property._property._values[i * 3 - 2],
        property._property._values[i * 3 - 1]
      );
      if (i &lt; 976) &#123;
        //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170);
        var _position = Cesium.Cartesian3.fromDegrees(
          position[i].x,
          position[i].y,
          0
        );
      &#125; else if (i &gt; 975 &amp;&amp; i &lt; 986) &#123;
        //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170 + 20 * (i - 980));
        var _position = Cesium.Cartesian3.fromDegrees(
          position[i].x,
          position[i].y,
          0
        );
      &#125; else if (i &gt; 985) &#123;
        //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170 + 200);
        var _position = Cesium.Cartesian3.fromDegrees(
          position[i].x,
          position[i].y,
          0
        );
      &#125;

      var positions = [
        Cesium.Ellipsoid.WGS84.cartesianToCartographic(position_a),
        Cesium.Ellipsoid.WGS84.cartesianToCartographic(_position),
      ];
      var a = new Cesium.EllipsoidGeodesic(positions[0], positions[1]);
      var long = a.surfaceDistance;
      var _time = long / 50;
      var time = Cesium.JulianDate.addSeconds(
        property._property._times[i - 1],
        _time,
        new Cesium.JulianDate()
      );

      property.addSample(time, _position);
    &#125;
  &#125;
  return property;
&#125;
var start = Cesium.JulianDate.fromDate(new Date(2018, 3, 15, 16));
var stop = Cesium.JulianDate.addSeconds(
  start,
  30000,
  new Cesium.JulianDate()
);

//Make sure viewer is at the desired time.
T.cesiumViewer.clock.startTime = start.clone();
T.cesiumViewer.clock.stopTime = stop.clone();
T.cesiumViewer.clock.currentTime = start.clone();
T.cesiumViewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; //Loop at the end
//T.cesiumViewer.clock.clockRange = Cesium.ClockRange.UNBOUNDED; //
//T.cesiumViewer.clock.clockStep = Cesium.ClockStep.SYSTEM_CLOCK; //
//T.cesiumViewer.clock.multiplier = 10;//值越大，飞行越快
T.cesiumViewer.clock.multiplier = 0.6;
T.cesiumViewer.clock.canAnimate = false;
T.cesiumViewer.clock.shouldAnimate = true; //设置时间轴动态效果

var _position = computeCirclularFlight();

T.entityFly = T.cesiumViewer.entities.add(&#123;
  //Set the entity availability to the same interval as the simulation time.
  availability: new Cesium.TimeIntervalCollection([
    new Cesium.TimeInterval(&#123;
      start: start,
      stop: stop,
    &#125;),
  ]),
  position: _position,
  orientation: new Cesium.VelocityOrientationProperty(_position),
  /*model: &#123;
            uri:GLOBAL.domainResource+&quot;/systems/common-bx-gis/models/cesium/SampleData/models/CesiumAir/Cesium_Air.gltf&quot;,
            scale: 6,
            minimumPixelSize: 64,
            //heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND
        &#125;,*/
  point: &#123;
    color: Cesium.Color.RED,
    outlineColor: Cesium.Color.WHITE,
    outlineWidth: 2,
    pixelSize: 15,
  &#125;,
  //Show the path as a pink line sampled in 1 second increments.
  path: &#123;
    resolution: 1,
    material: new Cesium.PolylineGlowMaterialProperty(&#123;
      glowPower: 0.1,
      color: Cesium.Color.YELLOW,
    &#125;),
    //width: 30
    width: 10,
  &#125;,
&#125;);
T.cesiumViewer.trackedEntity = T.entityFly;
setTimeout(function() &#123;
  T.cesiumViewer.camera.zoomOut(500.0); //缩小地图，避免底图没有数据
&#125;, 100);
</code></pre>
<p>  } else {</p>
<pre><code>return;
</code></pre>
<p>  }<br>}<br>},<br>/**</p>
</li>
<li><p>暂停飞行漫游路径</p>
</li>
<li><p>@method pauseFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>pauseFly3DPaths: function() {<br>var clockViewModel = this.cesiumViewer.clockViewModel;<br>if (clockViewModel.shouldAnimate) {<br>  clockViewModel.shouldAnimate = false;<br>} else if (this.cesiumViewer.clockViewModel.canAnimate) {<br>  clockViewModel.shouldAnimate = true;<br>}<br>},<br>/**</p>
</li>
<li><p>向前飞行漫游路径</p>
</li>
<li><p>@method playForwardFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>playForwardFly3DPaths: function() {<br>var clockViewModel = this.cesiumViewer.clockViewModel;<br>var multiplier = clockViewModel.multiplier;<br>if (multiplier &lt; 0) {<br>  clockViewModel.multiplier = -multiplier;<br>}<br>clockViewModel.shouldAnimate = true;<br>},<br>/**</p>
</li>
<li><p>向后飞行漫游路径</p>
</li>
<li><p>@method playForwardFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>playReverseFly3DPaths: function() {<br>var clockViewModel = this.cesiumViewer.clockViewModel;<br>var multiplier = clockViewModel.multiplier;<br>if (multiplier &gt; 0) {<br>  clockViewModel.multiplier = -multiplier;<br>}<br>clockViewModel.shouldAnimate = true;<br>},<br>/**</p>
</li>
<li><p>设定飞行漫游路径</p>
</li>
<li><p>@method DrawFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>DrawFly3DPaths: function(drawHelper) {<br>var T = this;<br>this.clearFly3DPaths();<br>drawHelper.startDrawingPolyline({<br>  callback: function(positions) {</p>
<pre><code>T.drawPolyline = new DrawHelper.PolylinePrimitive(&#123;
  positions: positions,
  width: 5,
  type: &quot;plot&quot;,
  geodesic: true,
&#125;);
T.cesiumViewer.scene.primitives.add(T.drawPolyline);
T.drawPolyline.setEditable();
//构造设定路线的返回信息
var coordinates = [];
var position = null;
var heading = null;
var pitch = null;
var roll = null;
for (var i = 0; i &lt; positions.length; i++) &#123;
  var cartographic = Cesium.Cartographic.fromCartesian(positions[i]); //世界坐标转地理坐标（弧度）
  var point = [
    (cartographic.longitude / Math.PI) * 180,
    (cartographic.latitude / Math.PI) * 180,
  ]; //地理坐标（弧度）转经纬度坐标
  //console.log(point);
  coordinates.push(point);
&#125;
//orientation&quot;:&#123;&quot;heading&quot;:2.411783930363565,&quot;pitch&quot;:-0.21097267398444197,&quot;roll&quot;:0.0015622392231300353&#125;,&quot;position&quot;: &#123;&quot;x&quot;:-2206260.239730831,&quot;y&quot;:5510911.392077349,&quot;z&quot;:2331987.10863007&#125;,
position = drawHelper._cameraPosition;
heading = drawHelper._cameraHeading;
pitch = drawHelper._cameraPitch;
roll = drawHelper._cameraRoll;
var pathsData = &#123;
  orientation: &#123; heading: heading, pitch: pitch, roll: roll &#125;,
  position: position,
  geometry: &#123; type: &quot;LineString&quot;, coordinates: coordinates &#125;,
&#125;;
if (bxmap.FlyCesium) &#123;
  bxmap.FlyCesium.draw3DObj = T.draw3DObj = pathsData;
  bxmap.FlyCesium.isDrawFly = true;
&#125;
//return T.draw3DObj;
</code></pre>
<p>  },<br>});<br>},<br>/**</p>
</li>
<li><p>退出飞行漫游路径</p>
</li>
<li><p>@method stopFly3DPaths</p>
</li>
<li><p>@param</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>stopFly3DPaths: function() {<br>var start = Cesium.JulianDate.fromDate(new Date());<br>this.cesiumViewer.clock.startTime = start.clone();<br>var stop = Cesium.JulianDate.addSeconds(<br>  start,<br>  300000000,<br>  new Cesium.JulianDate()<br>);<br>this.cesiumViewer.clock.stopTime = stop.clone();<br>//this.cesiumViewer.entities.remove(this.entityFly);<br>this.clearFly3DPaths();<br>},<br>};</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift287M1%E8%BD%AF%E4%BB%B6%E5%88%9D%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift287M1%E8%BD%AF%E4%BB%B6%E5%88%9D%E8%A3%85/" class="post-title-link" itemprop="url">M1 mac 装机</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-02 18:01:54" itemprop="dateModified" datetime="2022-08-02T18:01:54+08:00">2022-08-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1.安装最新的Xcode<br>2.Homebrew<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1265310832e6">https://www.jianshu.com/p/1265310832e6</a><br><a target="_blank" rel="noopener" href="https://brew.sh/">https://brew.sh</a><br>homebrew配置：brew config<br>安装软件，如：brew install node<br>卸载软件，如：brew uninstall node<br>搜索软件，如：brew search node<br>更新软件，如：brew upgrade node<br>查看安装列表，如：brew list<br>列出可更新的软件包，brew outdated<br>检测已经过时的软件：brew outdated<br>升级所有已过时的软件，即列出的以过时软件 ： brew upgrade<br>启动服务 brew services start mysql<br>查看包依赖 brew deps git</p>
<p>open -e .zshrc<br>open -e .bash_profile<br>cd ~<br>vim ./.bash_profile</p>
<p>http-server . -c-1  </p>
<p>brew install ruby<br>gem sources -l<br>gem sources –add <a target="_blank" rel="noopener" href="https://gems.ruby-china.com/">https://gems.ruby-china.com/</a> –remove <a target="_blank" rel="noopener" href="https://rubygems.org/">https://rubygems.org/</a><br>sudo gem install -n /usr/local/bin cocoapods</p>
<p>brew install git<br>brew install nginx<br>brew install mongodb</p>
<p>brew install google-chrome<br>brew install launchrocket<br>brew install docker<br>brew install visual-studio-code<br>brew install sorcerer<br>brew install sublime-text<br>brew install charles<br>brew install betterzip<br>brew install cleanmymac<br>brew install smartsvn<br>brew install we-chat<br>2.安装cocoapods<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/baicai_520/article/details/112697063">https://blog.csdn.net/baicai_520/article/details/112697063</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/44c894b69cf6">https://www.jianshu.com/p/44c894b69cf6</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19484963/article/details/83110004">https://blog.csdn.net/qq_19484963/article/details/83110004</a></p>
<p>M1电脑预装软件列表<br>Office 软件<br><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1MZjAv01_fT2ZOV5Pi7yDkA?errmsg=Auth+Login+Sucess&amp;errno=0&amp;ssnerror=0&amp;">https://pan.baidu.com/s/1MZjAv01_fT2ZOV5Pi7yDkA?errmsg=Auth+Login+Sucess&amp;errno=0&amp;ssnerror=0&amp;</a></p>
<p>wps<br><a target="_blank" rel="noopener" href="https://www.wps.cn/">https://www.wps.cn</a></p>
<p>idea  webstorm pycharm  ps</p>
<p>node<br><a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012843349/article/details/112856593">https://blog.csdn.net/u012843349/article/details/112856593</a></p>
<p>IDEA<br><a target="_blank" rel="noopener" href="https://download.jetbrains.8686c.com/idea/ideaIU-2020.3.2-aarch64.dmg">https://download.jetbrains.8686c.com/idea/ideaIU-2020.3.2-aarch64.dmg</a></p>
<p>VS code<br><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">https://code.visualstudio.com</a></p>
<p>chrome<br><a target="_blank" rel="noopener" href="https://www.google.com/chrome/">https://www.google.com/chrome/</a></p>
<p>mysql<br><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/">https://dev.mysql.com/downloads/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42006613/article/details/111773038">https://blog.csdn.net/qq_42006613/article/details/111773038</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/studio">https://developer.android.com/studio</a></p>
<p>github<br><a target="_blank" rel="noopener" href="https://desktop.github.com/">https://desktop.github.com</a></p>
<p>xCode<br><a target="_blank" rel="noopener" href="https://apps.apple.com/us/app/xcode/id497799835">https://apps.apple.com/us/app/xcode/id497799835</a></p>
<p><a target="_blank" rel="noopener" href="https://proxyman.io/">https://proxyman.io</a></p>
<p><a target="_blank" rel="noopener" href="https://www.charlesproxy.com/download/">https://www.charlesproxy.com/download/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.python.org/">https://www.python.org</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Macvcl/p/14019852.html">https://www.cnblogs.com/Macvcl/p/14019852.html</a></p>
<h1 id="设置homebrew-core镜像"><a href="#设置homebrew-core镜像" class="headerlink" title="设置homebrew-core镜像"></a>设置homebrew-core镜像</h1><p>HOMEBREW_CORE_GIT_REMOTE=<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/homebrew-core.git">https://mirrors.ustc.edu.cn/homebrew-core.git</a></p>
<p>/bin/bash -c “$(curl -fsSL <a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh)&quot;">https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh)&quot;</a></p>
<p>Arm版安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt # 切换到 /opt 目录</span><br><span class="line">mkdir homebrew # 创建 homebrew 目录</span><br><span class="line">sudo chown -R $(whoami) /opt/homebrew # 修改目录所属用户</span><br><span class="line">curl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C homebrew</span><br></pre></td></tr></table></figure>

<p>intel版的安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch -x86_64 /bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)&quot;</span><br></pre></td></tr></table></figure>

<p>vim ~/.zshrc 或者 vim ~/.bash_profile</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> x86</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="string">&quot;/usr/local/bin:<span class="variable">$PATH</span>&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">alias</span>  abrew=<span class="string">&#x27;arch -x86_64 /usr/local/bin/brew&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> arm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="string">&quot;/opt/homebrew/bin:<span class="variable">$PATH</span>&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">alias</span>  brew=<span class="string">&#x27;/opt/homebrew/bin/brew&#x27;</span></span></span><br></pre></td></tr></table></figure>

<p>source ~/.zshrc 或者 source ~/.bash_profile</p>
<p>hexo g -d</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/05/M_Swift170Mac%20Homebrew%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/05/M_Swift170Mac%20Homebrew%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">mac 开发homebrew使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-05 15:33:50" itemprop="dateCreated datePublished" datetime="2021-02-05T15:33:50+08:00">2021-02-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-12 15:55:50" itemprop="dateModified" datetime="2021-04-12T15:55:50+08:00">2021-04-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1.安装最新的Xcode<br>2.Homebrew<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1265310832e6">https://www.jianshu.com/p/1265310832e6</a><br><a target="_blank" rel="noopener" href="https://brew.sh/">https://brew.sh</a><br>homebrew配置：brew config<br>安装软件，如：brew install node<br>卸载软件，如：brew uninstall node<br>搜索软件，如：brew search node<br>更新软件，如：brew upgrade node<br>查看安装列表，如：brew list<br>列出可更新的软件包，brew outdated<br>检测已经过时的软件：brew outdated<br>升级所有已过时的软件，即列出的以过时软件 ： brew upgrade<br>启动服务 brew services start mysql<br>查看包依赖 brew deps git</p>
<p>brew install ruby<br>gem sources -l<br>gem sources –add <a target="_blank" rel="noopener" href="https://gems.ruby-china.com/">https://gems.ruby-china.com/</a> –remove <a target="_blank" rel="noopener" href="https://rubygems.org/">https://rubygems.org/</a><br>sudo gem install -n /usr/local/bin cocoapods</p>
<p>brew install node<br>brew install python3<br>brew install wget<br>brew install git<br>brew install mysql<br>brew install maven<br>brew install nginx<br>brew install mongodb<br>brew install hexo</p>
<p>brew install google-chrome<br>brew install launchrocket<br>brew install visual-studio-code<br>brew install docker<br>brew install visual-studio-code<br>brew install sourcetree<br>brew install sublime-text<br>brew install charles<br>brew install betterzip<br>brew install cleanmymac<br>brew install smartsvn<br>brew install wechat<br>brew install docker<br>2.安装cocoapods<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/baicai_520/article/details/112697063">https://blog.csdn.net/baicai_520/article/details/112697063</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/44c894b69cf6">https://www.jianshu.com/p/44c894b69cf6</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19484963/article/details/83110004">https://blog.csdn.net/qq_19484963/article/details/83110004</a></p>
<p>M1电脑预装软件列表<br>Office 软件<br><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1MZjAv01_fT2ZOV5Pi7yDkA?errmsg=Auth+Login+Sucess&amp;errno=0&amp;ssnerror=0&amp;">https://pan.baidu.com/s/1MZjAv01_fT2ZOV5Pi7yDkA?errmsg=Auth+Login+Sucess&amp;errno=0&amp;ssnerror=0&amp;</a></p>
<p>wps<br><a target="_blank" rel="noopener" href="https://www.wps.cn/">https://www.wps.cn</a></p>
<p>idea  webstorm pycharm  ps</p>
<p>node<br><a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012843349/article/details/112856593">https://blog.csdn.net/u012843349/article/details/112856593</a></p>
<p>IDEA<br><a target="_blank" rel="noopener" href="https://download.jetbrains.8686c.com/idea/ideaIU-2020.3.2-aarch64.dmg">https://download.jetbrains.8686c.com/idea/ideaIU-2020.3.2-aarch64.dmg</a></p>
<p>VS code<br><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">https://code.visualstudio.com</a></p>
<p>chrome<br><a target="_blank" rel="noopener" href="https://www.google.com/chrome/">https://www.google.com/chrome/</a></p>
<p>mysql<br><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/">https://dev.mysql.com/downloads/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42006613/article/details/111773038">https://blog.csdn.net/qq_42006613/article/details/111773038</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/studio">https://developer.android.com/studio</a></p>
<p>github<br><a target="_blank" rel="noopener" href="https://desktop.github.com/">https://desktop.github.com</a></p>
<p>xCode<br><a target="_blank" rel="noopener" href="https://apps.apple.com/us/app/xcode/id497799835">https://apps.apple.com/us/app/xcode/id497799835</a></p>
<p><a target="_blank" rel="noopener" href="https://proxyman.io/">https://proxyman.io</a></p>
<p><a target="_blank" rel="noopener" href="https://www.charlesproxy.com/download/">https://www.charlesproxy.com/download/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.python.org/">https://www.python.org</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Macvcl/p/14019852.html">https://www.cnblogs.com/Macvcl/p/14019852.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/04/M_Swift172%202020%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/04/M_Swift172%202020%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">2020年终总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-04 15:21:38" itemprop="dateCreated datePublished" datetime="2021-02-04T15:21:38+08:00">2021-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-12 15:57:18" itemprop="dateModified" datetime="2021-04-12T15:57:18+08:00">2021-04-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>2020年注定是不平凡的一年，它将在人类历史上留下深刻的烙印，平凡的我们依旧行尸走肉的在这里生活着<br>回想这一年我都干了些什么，经历了什么，从公交规划到c++的数据编译到地图导航SDK到现在的前端项目，感觉经历了之前几年没有经历的东西，收获还是蛮多的，比之前的几年是有很好的提升了吧<br>现在的公司越来越不稳定了，明年估计是一次变化的一年，总之今年还算是比较平稳的一年<br>明年我想如果房子好了的话，不知道是不是还要花很多的钱，明年的话我想还是要稳定的发展吧，自己本身起点很低，我想做东西慢慢吸收经验能好很多。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/02/M_Swift160%E7%82%B9%E7%BA%BF%E9%9D%A2%E7%BB%98%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/02/M_Swift160%E7%82%B9%E7%BA%BF%E9%9D%A2%E7%BB%98%E5%88%B6/" class="post-title-link" itemprop="url">OpenGL点线面绘制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-02 14:25:12" itemprop="dateCreated datePublished" datetime="2020-12-02T14:25:12+08:00">2020-12-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对于地图应用程序来讲一般来说绘制的都是三角形类型的数据，GL_TRIANGLES<br>点的绘制：<br>一般是绘制图标和文本，涉及的问题主要是计算图标及文本的位置<br>线的绘制：<br>一般是根据线的宽度，生成三角形数据的线，然后进行绘制<br>面的绘制：<br>一般是绘制三角形数据</p>
<p>地图层级绘制：<br>这涉及到地图数据编译的开发，地图数据编译一个重要方面是数据分层，要将数据展示在不同级别的比例尺的地图上，所以不同比例尺下，我们看到地图展示的数据是不一样的，我们要抽希数据放在高层比例尺上，比如北京市，我们可能在20km以上的比例尺才会显示，在较低的比例尺上我们就不会再显示，这就是数据的分层。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/02/M_Swift159OpenGL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/02/M_Swift159OpenGL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E8%AF%B4%E6%98%8E/" class="post-title-link" itemprop="url">OpenGL常用函数说明</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-02 11:57:27" itemprop="dateCreated datePublished" datetime="2020-12-02T11:57:27+08:00">2020-12-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>OpenGL中所有函数都以字符gl作为前缀，还有些以glfw、gl3w或glew为前缀的函数，来自于第三方库GLFW、GL3W、GLEW</p>
<p>由于OpenGL是C语言的库，没有重载，所以OpenGL中区分同名函数使用后缀的变化来标记，例如glUniform2f()和glUniform3fv()，2f中的2表示两个参数，f表示参数类型为GLfloat类型，即glUniform2f()需要传入两个GLfloat类型的参数，而glUniform3fv()中v表示vector(向量)类型，即这个函数我们需要使用一个3维向量作为参数传入，这个三维向量的每个分量都是GLfloat类型，注意，在OpenGL中，向量vector类型是使用一维数组来表示，所以glUniform3fv()的参数为一个含有3个GLfloat值的一维数组<br>后缀与参数类型对应关系<br>b 8位整数  char<br>s 16位整数 short<br>i 32位整数 int<br>f 32位浮点 float<br>d 64位浮点 double<br>ub 8位无符号整型<br>us 16位无符号整型<br>ui 323位无符号整型</p>
<p>Uniform：属性是一种对整个批次属性都取统一值的单一值。它是不变的。通过设置uniform变量就紧接着发送一个图元批次命令，Uniform变量实际上可以无数次限制地使用，设置一个应用于整个表面的单个颜色值，还可以设置一个时间值。在每次渲染某种类型的顶点动画时修改它。、</p>
<p>glEnable(GL_LINE_STIPPLE);//打开虚线模式glDisable（GL_LINE_STIPPLE）可关闭<br>glLineStipple(2, 0x0F0F);//void glLineStipple(GLint factor, GLushort pattern); pattern为虚线样式序列（16位二进制数）</p>
<p>glClear度<br>glBegin(GL_LINES);</p>
<p>点</p>
<p>线<br>glLineWidth(10.0f);//线宽<br>glEnable(GL_LINE_STIPPLE);<br>glDisable(GL_LINE_STIPPLE);</p>
<p>面<br>正面反面<br>GL_FRONT<br>GL_BACK<br>面的处理方式则有填充和轮廓<br>glPolygonMode<br>GL_LINE<br>GL_FILL<br>glEnable(GL_POLYGON_STIPPLE);//打开镂空模式</p>
<p>glDeleteTextures - 删除纹理<br>glPushMatrix<br>glTranslatef<br>glScalef<br>glRotatef<br>glDisable<br>glEnable<br>glBlendFunc<br>glEnableClientState<br>glBindTexture<br>glTexParameterf</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/flycatdeng/article/details/82588903">https://blog.csdn.net/flycatdeng/article/details/82588903</a></p>
<p>glActiveTexture - 激活纹理单元<br>glAttachShader- 将着色器对象附加到program对象<br>glBindAttribLocation - 将通用顶点属性索引与命名属性变量相关联<br>glBindAttribLocation - 将通用顶点属性索引与命名属性变量相关联</p>
<p>glEnable( GL_BLEND );   // 启用混合<br>glBlendFunc( GLenum sfactor , GLenum dfactor );         // 混合函数</p>
<p>sfactor 源混合因子</p>
<p>dfactor 目标混合因子<br>OpenGL——纹理过滤函数glTexParameteri()<br>    图象从纹理图象空间映射到帧缓冲图象空间(映射需要重新构造纹理图像,这样就会造成应用到多边形上的图像失真),这时就可用glTexParmeteri()函数来确定如何把纹理象素映射成像素.<br>GL_TEXTURE_2D: 操作2D纹理.<br>GL_TEXTURE_WRAP_S: S方向上的贴图模式.<br> GL_CLAMP: 将纹理坐标限制在0.0,1.0的范围之内.如果超出了会如何呢.不会错误,只是会边缘拉伸填充.<br>GL_LINEAR: 线性过滤, 使用距离当前渲染像素中心最近的4个纹素加权平均值.<br>GL_REPEAT</p>
<p>openggl 图片优化<br>如果纹理很大，并且您每次分配新内存来存储越来越多的副本，那么很快就会用完的记忆。解决方案是在应用程序初始化期间调用 glTexImage2D 一次，并且仅在要使用它时才调用 glBindTexture 。如果要在单击时更改纹理本身，请仅调用 glBindTexture 和 glTexImage2D 。如果新图像的大小与先前图像的大小相同，则可以调用 glTexSubImage2D 告诉OpenGL覆盖旧图像数据，而不是删除并上传新图像数据。 / p&gt; </p>
<h2 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h2><pre><code>/*
 * glGenRenderbuffers 的原型为：
 * void glGenRenderbuffers (GLsizei n, GLuint* renderbuffers)
 * 它是为 renderbuffer 申请一个 id（或曰名字）。
 * 参数 n 表示申请生成 renderbuffer 的个数，
 * 而 renderbuffers 返回分配给 renderbuffer 的 id，
 * 注意：返回的 id 不会为0，id 0 是OpenGL ES 保留的，我们也不能使用 id 为0的 renderbuffer。
 */
glGenRenderbuffers(1, &amp;self-&gt;_colorRenderBuffer);

/*
 * glBindRenderbuffer 的原型为：
 * void glBindRenderbuffer (GLenum target, GLuint renderbuffer)
 * 这个函数将指定 id 的 renderbuffer 设置为当前 renderbuffer。
 * 参数 target 必须为 GL_RENDERBUFFER，参数 renderbuffer 是就是使用 glGenRenderbuffers 生成的 id。
 * 当指定 id 的 renderbuffer 第一次被设置为当前 renderbuffer 时，会初始化该 renderbuffer 对象，其初始值为：
 * width 和 height：像素单位的宽和高，默认值为0；
 * internal format：内部格式，三大 buffer 格式之一 -- color，depth or stencil；
 * Color bit-depth：仅当内部格式为 color 时，设置颜色的 bit-depth，默认值为0；
 * Depth bit-depth：仅当内部格式为 depth时，默认值为0；
 * Stencil bit-depth: 仅当内部格式为 stencil，默认值为0；
 */
glBindRenderbuffer(GL_RENDERBUFFER, self.colorRenderBuffer);


/*
 * glFramebufferRenderbuffer的函数原型为：
 * void glFramebufferRenderbuffer (GLenum target, GLenum attachment, GLenum renderbuffertarget, GLuint renderbuffer)
 * 该函数是将相关 buffer（三大buffer之一）attach到framebuffer上（如果 renderbuffer不为 0，
 * 知道前面为什么说glGenRenderbuffers 返回的id 不会为 0 吧）或从 framebuffer上detach
 * （如果 renderbuffer为 0）。参数 attachment 是指定 renderbuffer 被装配到那个装配点上，zm
 * 其值是GL_COLOR_ATTACHMENT0, GL_DEPTH_ATTACHMENT, GL_STENCIL_ATTACHMENT中的一个，
 * 分别对应 color，depth和 stencil三大buffer。
 */
glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_RENDERBUFFER, self.colorRenderBuffer);

/*
 * glDrawElements 函数的原型为：
 * void glDrawElements(GLenum mode, GLsizei count, GLenum type, const GLvoid *indices);
 * 第一个参数 mode 为描绘图元的模式，其有效值为：GL_POINTS, GL_LINES, GL_LINE_STRIP,  GL_LINE_LOOP,  GL_TRIANGLES,  GL_TRIANGLE_STRIP, GL_TRIANGLE_FAN。这些模式具体含义下面有介绍。
 * 第二个参数 count 为顶点索引的个数也就是，type 是指顶点索引的数据类型，因为索引始终是正值，索引这里必须是无符号型的非浮点类型，
 * 因此只能是 GL_UNSIGNED_BYTE, GL_UNSIGNED_SHORT, GL_UNSIGNED_INT 之一，为了减少内存的消耗，尽量使用最小规格的类型如 GL_UNSIGNED_BYTE。
 * 第三个参数 indices 是存放顶点索引的数组。（indices 是 index 的复数形式，3D 里面很多单词的复数都挺特别的。）
 */
glDrawElements(GL_LINES, sizeof(indices)/sizeof(GLubyte), GL_UNSIGNED_BYTE, indices);


/*
 * glClearColor用来设置清屏颜色，默认为黑色
 */
glClearColor(0, 1.0, 0, 1.0);

/*
 * glClear(GLbitfieldmask)用来指定要用清屏颜色来清除由mask指定的buffer
 * mask 可以是 GL_COLOR_BUFFER_BIT，GL_DEPTH_BUFFER_BIT和GL_STENCIL_BUFFER_BIT的自由组合。
 */
glClear(GL_COLOR_BUFFER_BIT);

/*
 * 设置 viewport
 * glViewport  表示渲染 surface 将在屏幕上的哪个区域呈现出来，
 */
glViewport(0, 0, self.frame.size.width, self.frame.size.height);
</code></pre>
<h2 id="glPushMatrix、glPopMatrix"><a href="#glPushMatrix、glPopMatrix" class="headerlink" title="glPushMatrix、glPopMatrix"></a>glPushMatrix、glPopMatrix</h2><pre><code>操作事实上就相当于栈里的入栈和出栈。
https://blog.csdn.net/u010579736/article/details/51884989
比如你当前的坐标系原点在你电脑屏幕的左上方。如今你调用glPushMatrix，然后再调用一堆平移、旋转代码等等，然后再绘图。那些平移和旋转都是基于左上角为原点进行变化的。并且都会改变坐标的位置，经过了这些变化后，你的坐标肯定不再左上角了。
　　那假设想恢复怎么办呢？这时就调用glPopMatrix从栈里取出一个“状态”了，这个状态就是你调用glPushMatrix之前的那个状态。就如非常多opengl的书上所讲：调用glPushMatrix事实上就是把当前状态做一个副本放入堆栈之中。

当你做了一些移动或旋转等变换后，使用glPushMatrix();
OpenGL 会把这个变换后的位置和角度保存起来。
然后你再随便做第二次移动或旋转变换，再用glPopMatrix();
OpenGL 就把刚刚保存的那个位置和角度恢复。

比方：
glLoadIdentity();
glTranslatef(1,0,0);//向右移动(1,0,0)
glPushMatrix();//保存当前位置
glTranslatef(0,1,0);//如今是(1,1,0)了
glPopMatrix();//这样，如今又回到(1,0,0)了
1.原理解说

最终明确为什么使用glPushMatrix()和glPopMatrix()的原因了。将本次须要运行的缩放、平移等操作放在glPushMatrix和glPopMatrix之间。glPushMatrix()和glPopMatrix()的配对使用能够消除上一次的变换对本次变换的影响。使本次变换是以世界坐标系的原点为參考点进行。以下对上述结论做进一步的解释：

1）OpenGL中的modelview矩阵变换是一个马尔科夫过程：上一次的变换结果对本次变换有影响，上次modelview变换后物体在世界坐标系下的位置是本次modelview变换的起点。默认时本次变换和上次变换不独立。

2）OpenGL物体建模实际上是分两步走的。第一步，在世界坐标系的原点位置绘制出该物体；第二步，通过modelview变换矩阵对世界坐标系原点处的物体进行仿射变换，将该物体移动到世界坐标系的目标位置处。

3）将modelview变换放在glPushMatrix和glPopMatrix之间能够使本次变换和上次变换独立。

4）凡是使用glPushMatrix()和glPopMatrix()的程序一般能够判定是采用世界坐标系建模。既世界坐标系固定，modelview矩阵移动物体。
</code></pre>
<h2 id="glTranslatef-函数和glRotatef-函数和glLoadIdentity-函数"><a href="#glTranslatef-函数和glRotatef-函数和glLoadIdentity-函数" class="headerlink" title="glTranslatef()函数和glRotatef()函数和glLoadIdentity()函数"></a>glTranslatef()函数和glRotatef()函数和glLoadIdentity()函数</h2><pre><code>https://blog.csdn.net/code_ac/article/details/60970103

glLoadIdentity()

将当前的用户坐标系的原点移到了屏幕中心：类似于一个复位操作 
glTranslatef(x, y, z)

沿着 X, Y 和 Z 轴移动。

注意在glTranslatef(x, y, z)中,当您移动的时候，您并不是相对屏幕中心移动，而是相对与当前所在的屏幕位置。

glRotatef(angle, x, y, z) 

与glTranslatef(x, y, z)类似，glRotatef(angle, x, y, z)也是对坐标系进行操作。 旋转轴经过原点，方向为(x,y,z),旋转角度为angle，方向满足右手定则。 

glScalef是openGL中的模型缩放函数，就是把当前矩阵与一个表示延各个轴对物体进行拉伸、压缩、反射的矩阵相乘。这个物体的每个点的x,y,z坐标与对应的xyz参数相乘。
例如：
如glScalef(2.0f，3.0f，4.0f);将模型按x,y,z方向分别拉伸了2,3,4倍。


【GL_LINES】
　　独立的线段，下式中，p2与p3间没有连线。
【GL_LINE_STRIP】
　　连续的线段，下式中， p2与p3会连成线段。
【GL_LINE_LOOP】
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/02/M_Swift151OpenGLES%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/02/M_Swift151OpenGLES%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">Opengl es</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-02 11:57:06" itemprop="dateCreated datePublished" datetime="2020-12-02T11:57:06+08:00">2020-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-12 16:08:28" itemprop="dateModified" datetime="2021-04-12T16:08:28+08:00">2021-04-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>opengl 是一个跨平台、跨编程语言的图形处理接口，opengl es是它的一个子集，专门用来针对手机，平板电脑等嵌入式设备的图像处理库。对于手机来说，它的所有对图像的计算和渲染都是在gpu上完成，所以具有较好的性能<br>opengl es的接口设计中不涉及上下文环境和窗口的管理，这由各个平台自行实现。比如ios就是EAGL；安卓就是EGL；<br>tips:<br>libSDL，它是一个跨平台的图形处理库，其中有包含对对OpenGL es的标准接口的封装及各个平台上下文，窗口管理的封装。<br>备注：Opengl es 2.0 官方接口文档 <a target="_blank" rel="noopener" href="https://www.khronos.org/registry/OpenGL-Refpages/es2.0/">https://www.khronos.org/registry/OpenGL-Refpages/es2.0/</a></p>
<p>gltypes.h 是包含了 OpenGL ES 2.0 的基本数据类型的定义；<br>glext.h 是包含各种宏定义，以及矩阵运算等常用的函数；<br>gl.h 是 OpenGL ES 2.0 所有的核心函数（命令）；</p>
<p>#Opengl es渲染管线<br>这里是opengl es2.0以后的版本的渲染管线<br>1、确定几何形状，比如是要点，线，还是三角形(长方形，正方形和其它二维几何图形都是由三角形来渲染的)。<br>它最终由glDrawArrays()函数的调用来确定，其第一个参数确定了形状可取值如下：<br>GL_POINTS:绘制点<br>GL_LINES:线<br>GL_TRIANGLE_STRIP:三角形<br>2、处理顶点坐标<br>此阶段需要顶点着色器的参与，首先由应用端传递给顶点着色器几何图形的坐标，纹理的坐标(如果有的话)；然后根据opengl es内部的坐标系和投影矩阵进行转化<br>成最终的坐标;在这一步中，应用端需要知道的是基于(左下角为原点(-1,-1),右上角(1,1)，这个范围就是前面glViewPort()开辟大小)的坐标系来确定几何图形的坐标<br>；基于(左上角为原点(0,0),右下角(1,1))的坐标系来确定纹理的坐标,但是纹理坐标要上下翻转180度后在与几何坐标顺序一直传递<br>tips:<br>常用的就是渲染图片，所以图片都是矩形，所以传递的几何坐标如下：<br>static float verData1[8] = {<br>-1.0f, -1.0f, // 左下角<br>1.0f,-1.0f,  // 右下角<br>-1.0f,1.0f, // 左上角<br>1.0f,1.0f,  // 右上角<br>};<br>一般按照如上的顺序传递坐标，取值也可以是其它值，比如<br>static float verData1[8] = {<br>-0.5f, -0.5f, // 左下角<br>0.5f,-0.5f,  // 右下角<br>-0.5f,0.5f, // 左上角<br>0.5f,0.5f,  // 右上角<br>};<br>表示取中间的1/2区域；实际上就是压缩效果<br>static float verData1[8] = {<br>-2.0f, -2.0f, // 左下角<br>2.0f,-2.0f,  // 右下角<br>-2.0f,2.0f, // 左上角<br>2.0f,2.0f,  // 右上角<br>};<br>表示将原来的坐标系放大了一倍后在基于原始的进行截取<br>传递的纹理坐标系(OpenGL es纹理坐标系左上角为原点(0,0),右下角为(1,1)与几何坐标系上下刚好翻转180度)如下：<br>static float uvData[8] = {<br>0.0f, 1.0f,// 左下角<br>1.0f, 1.0f, // 右下角<br>0.0f, 0.0f,// 左上角<br>1.0f, 0.0f, // 右上角<br>};<br>纹理坐标系一般不要去改变它的值，传这个就好，(当然也可该，前提是知道内部的转换原理),如果要实现压缩和裁剪效果，改变几何坐标系方便一些。<br>3、图元组装<br>经过阶段二的顶点处理操作之后，不论模型的顶点还是纹理坐标都已经确定，这个阶段，顶点将会应用程序的指令规则比如glDrawArrays()函数确定的(如<br>GL_POINTS,GL_LINES,GL_TRIANGES等)，将根据这些顶点坐标描绘出具体的图元(比如最终要渲染成一个矩形图元)<br>4、栅格化操作<br>由阶段3传递过来的图元，将在此阶段被分解成更小的单元并对应于帧缓冲区的各个像素，这些单元成为片元，一个片元包含颜色，坐标等属性。片元的坐标属性<br>根据顶点坐标利用插值运算确定，这个过程称为栅格化操作。该阶段只是确定了每个片元的坐标属性，颜色由下阶段通过片元着色器确定。<br>5、片元处理<br>上阶段确定了各个片元的坐标，此阶段将通过片段着色器GLSL语言确定各个片元的颜色。比如可以通过纹理坐标获取纹理中对应片元坐标的颜色，如果应用端传进来的纹理大小和要绘制的几何图形大小不一样，那么opengles会根据应用自己设置的缩放规则(比如用glTexParameteri()函数指定的规则)进行插值运算来获取到对应<br>的颜色)如果没有纹理，可以根据自己的代码规则确定片元颜色;这个过程就是给GLSL的内建变量gl_FragColor赋值<br>6、帧缓存操作<br>该阶段主要指向帧缓冲的写入操作，负责将最终的像素值写入帧缓冲区中。</p>
<p>#光栅化<br>前面就是opengl es标准的渲染管线，但是要想将图像最终呈现到屏幕上，还需要进行光栅化操作(也就是将帧缓冲区中的像素数据渲染到屏幕上)，而<br>这这一步的实现是由各个设备供应商提供的，称为Opengl EGL API，拿苹果ios的例子来说，需要调用EAGLContext 的presentRenderbuffer函数，图<br>像才会最终渲染到屏幕上;</p>
<p>#opengl es api和EGL api<br>opengl es api是用来进行图像渲染操作的，<br>egl api是由各个操作系统实现的系统api，它主要的作用就是创建窗口，创建opengl 上下文环境等。可以由各自厂商自行定义，使用通用的EGL接口。<br>如苹果就是EAGL，安卓就可以用EGL来自行管理，也可以用GLSurface系统创建opengl 环境</p>
<h1 id="opengl-es坐标系"><a href="#opengl-es坐标系" class="headerlink" title="opengl es坐标系"></a>opengl es坐标系</h1><p>1、它以左下角作为原点的坐标系<br>此函数的意思就是，基于当前视图左下角作为原点的坐标系，选取一个左下角坐标为x,y,长宽为w,h的区域作为渲染的区域<br>glViewPort(x,y,w,h) 函数窗口创建的渲染区域</p>
<p>#纹理坐标系<br>在opengl 中，通常将纹理中的像素根据纹理坐标系来进行编址，纹理坐标系的横轴成为S轴，纵轴成为T轴，垂直于ST轴的成为R轴，在2D纹理中，没有<br>R轴，横轴和纵轴又称为UV轴，所以2D纹理坐标系又称为UV坐标系，UV轴的取值范围都是(0,1)。与OpenGL 坐标系不同的是，纹理坐标系的原点位于左<br>上角<br>#纹素<br>纹理中的最小单元就成为纹素，纹理是由一个个纹素组成</p>
<p>#纹理映射<br>纹理的映射就是让物体的每个片元（每个颜色像素）都找到对应的纹理纹素点，在这个映射过程中，因为纹理和物体的不匹配，势必会出现两种情况。<br>第一种是拥有大量纹素的纹理被映射到只还有少量片元的物体中<br>第二种是拥有少量纹素的纹理被映射到含有大量片元的物体中<br>如下：<br>glTexParameter(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR)<br>glTexParameter(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR)<br>GL_TEXTURE_MIN_FILTER:<br>是多个纹素对应一个片元的解决方案。可以设置两个值,GL_NEAREST 和 GL_LINEAR ，这两个值分别对应了两种不同的解决方案。GL_LINEAR 会混合匹配的颜色来得到片元的颜色，产生的颜色可能是纹理中不存在的颜色。例如一个纹理是由交替的黑色和白色的纹素组成，那个线性取样会使最终的片元颜色为灰色。GL_NEAREST 会拾取与片元 U，V 坐标最相近的颜色。<br>GL_TEXTURE_MAG_FILTER:<br>是没有足够的纹素来映射片元的解决方案。可以设置的值同 GL_TEXTURE_MIN_FILTER 一样。GL_LINEAR 会告诉OpenGL ES 混合附近纹素的颜色来计算片元的颜色。GL_LINEAR会有一个放大纹理的效果，当没有足够的纹素来映射片元时，会让纹理模糊的出现在要渲染的图形上。<br>GL_NEAREST 仅仅会拾取片元的 U ，V 位置接近的纹素的颜色，并放大纹理，会使其像素化的出现在要渲染的图形上。<br>GL_LINEAR:<br>线性插值，取最近的点的线性平均值 (性能消耗较大)<br>mipmaps<br>它也是一种纹理过滤算法，按我的理解它是以空间换时间的一种技巧，具体原理就是事先根据纹理生成长和宽逐渐除以2的小纹理，比如原始纹理大小128x128，<br>采用此方法后，会生成64x64 32x32 16x16 8x8 4x4 2x2 1x1的一系列纹理，如果需要20x18的纹理，则取最近的32x32 16x16进行平均<br>该方法很好的解决了如下问题：<br>1、当纹理很大，但是屏幕区域很小，渲染出现的闪烁问题，因为根据最邻近插值和线性插值都无法很快计算出合理的像素<br>它可以取的值如下：<br>GL_NEAREST_MIPMAP_NEAREST 选择最近的mipmap层，然后再用最邻近过滤插值<br>GL_LINEAR_MIPMAP_NEAREST    选择最近mipmap层，然后再用线性插值<br>GL_NEAREST_MIPMAP_LINEAR    选择最近的2层mipmap用最邻近过滤插值<br>GL_LINEAR_MIPMAP_LINEAR       选择最邻近的2层mipmap用线性插值<br>使用如下函数生成mipmaps<br>glGenerateMipmap(GLenum target);</p>
<p>#warp<br>另外一种在映射时可能出现的情况是纹理的四个顶点坐标不是1.0时，将采用如下方式：<br>glTexParameter(GL_TEXTURE_2D,GL_TEXTURE_WARP_S,GL_REPEAT) S轴方向<br>glTexParameter(GL_TEXTURE_2D,GL_TEXTURE_WARP_T,GL_REPEAT) T轴方向<br>GL_REPEAT:纹理没有覆盖的部分重复之前的纹理，当纹理大小大于物体大小时，纹理采样会出错。<br>GL_MIRRODED_REPEAT:将原来的纹理先颠倒再重复，当纹理大小大于物体大小时，纹理采样会出错。<br>GL_CLAMP_TO_EDGE:延续结束时的纹理</p>
<p>#顶点着色器中顶点坐标的顺序规则<br>open gl 中顶点坐标<br>static float verData1[8] = {<br>-1.0f,-1.0f,    // 左下角<br>1.0f,-1.0f,     // 右下角<br>-1.0f,1.0f,     // 左上角<br>1.0f,1.0f,      // 右上角<br>};<br>对应的纹理坐标<br>static float uvData[8] = {<br>0.0f, 1.0f,     // 左下角<br>1.0f, 1.0f,     // 右下角<br>0.0f, 0.0f,     // 左上角<br>1.0f, 0.0f,     // 右上角<br>};<br>对应的为glDrawArrays(GL_TRIANGLE_STRIP, 0, 4); 可以渲染出一张图片</p>
<p>一个纹理的位置值通常称为一个纹理单元(Texture Unit)<br>着色器对象Shader<br>    片段着色器<br>    顶点着色器<br>program对象</p>
<p>缓冲区对象GLuint buffer<br>帧缓冲区对象 GLuint framebuffer</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/39/">39</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">门乾强</p>
  <div class="site-description" itemprop="description">博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">390</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">门乾强</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>

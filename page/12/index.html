<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Men的博客">
<meta property="og:url" content="http://example.com/page/12/index.html">
<meta property="og:site_name" content="Men的博客">
<meta property="og:description" content="博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="门乾强">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/12/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Men的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Men的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">欢迎光临！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift188js%20gis%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift188js%20gis%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">js gis学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-12 16:06:53" itemprop="dateModified" datetime="2021-04-12T16:06:53+08:00">2021-04-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>目前从git上拉了一个代码，讲convas gis的，我感觉比较基础，也比较符合地图方向的，可以学习一下，我建议是跟着敲一下代码，总结一下学习经验。其实地图方向上的一些东西我们手里有很多资源，问题的关键是如何学好这些东西。如何将这些东西发挥比较大的用处，这个很关键。目前的话我们虽然有这些东西，但是我们基础不牢固，所以很难发挥我们长处，这个东西需要日积月累，时间长了我们总能获得收获。
</code></pre>
<p>cavans api<br>save()<br>保存画布(canvas)的所有状态<br>restore()<br>save 和 restore 方法是用来保存和恢复 canvas 状态的，都没有参数。Canvas 的状态就是当前画面应用的所有样式和变形的一个快照。<br>总之很多方法，需要自己去了解或者参考，其实跟opengl有点类似</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift196%20Vue3%20TypeScript%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift196%20Vue3%20TypeScript%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">Vue3 TypeScript实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-16 17:21:49" itemprop="dateModified" datetime="2021-04-16T17:21:49+08:00">2021-04-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Vue3现在已经出来了，感觉用的还是不多，但是我们却是需要拥抱这种变化，特别是TypeScript得到了非常大的使用的情况下，未来可以想象TypeScript在前端将会出现越来越多的使用，现在就让我们走进Vue3，走进TypeScript吧<br>之前也是研究了一段时间的Vue3的变化，感觉却是跟vue2变化非常明显，如果要是一个vue2的项目转换成vue3，我感觉我劝你还是重写吧，特别是组合式api的引入，这让之前的vue的js写法直接废弃了，当然特别是ref、reactive的出现，让我感觉反而比之前的代码还要麻烦了，还要return出去，还要考虑解包。这让我感觉很不方便。<br>今天我又创建了一个vue的项目，准备来仔细研磨一下vue和typeScript，好吧，一上来就让我懵了，原来的defineComponent不负存在，变成了一个继承Vue的一个类，还有就是出现了@Options这种东西，让我好不适应。<br>更让我感到奇怪的是，我尝试写setup函数，竟然没有任何作用，我想vue3的这些特性呢？？？？真是见鬼了。当我百度半天后我才明白，vue3的特性js部分变化其实在对象这方面经过封装后是没有多少变化的，原来是什么样子还是什么样子的，这让我有点喜欢了，我们可以直接用看待java对象的形式，看待一个vue3的TypeScript代码。<br>你定义变量，其实就有ref、reactive类型<br>如：<br>data: any = {<br>    title : “title”,<br>    left : “left”,<br>  }<br>  console.log(isReactive(this.data),this.data);<br>  // true Proxy {title: “title”, left: “left”}<br>  但是ref让我很纠结，打印出来的始终是false<br>  public test = ref(2);<br>  console.log(isRef(this.test),this.test);<br>  // false 2<br>  生命周期方法，这个比较简单，跟所有面向对象，android、ios都比较相似，生命周期如下<br>     created() {<br>       const helloword = shallowRef&lt;ComponentPublicInstance<typeof HelloWorld>&gt;()<br>       console.log(“created”,helloword);<br>     }<br>     mounted() {<br>       console.log(“mounted”);<br>     }<br>     beforeCreate() {<br>       console.log(“mounted”);<br>     }<br>     beforeMount?(): void {<br>       console.log(“beforeMount”);<br>     }<br>     beforeUnmount?(): void {<br>       console.log(“beforeUnmount”);<br>     }<br>     unmounted?(): void {<br>       console.log(“unmounted”);<br>     }<br>     beforeUpdate?(): void {<br>       console.log(“beforeUpdate”);<br>     }<br>     updated?(): void {<br>       console.log(“updated”);<br>     }<br>     activated?(): void {<br>       console.log(“activated”);<br>     }<br>     deactivated?(): void {<br>       console.log(“deactivated”);<br>     }<br>     render?(){<br>       console.log(“render”);<br>     }</p>
<p>@Options<br>这个东西让我也是比较的难受，其实里面的代码跟vue2的代码一摸一样，我不知道为什么要这样分开设计，感觉还是比较难受的，主要是包含三个部分，组建定义、属性定义、事件监听<br>@Options({<br>  components: { // 组建<br>    HelloWorld,<br>  },<br>  props: { // 属性<br>     msg: String!<br>  },<br>  watch: {// 事件监听<br>    age: {<br>      handler: function(newval,oldval) {<br>        console.log(“watch”,newval);<br>        //this.gotoAbourt();<br>      },<br>    }<br>  }<br>})<br>get方法，同vue中的 computed<br>public get age(): number {<br>  console.log(“get age”, this.mAge);<br>  return this.mAge;<br>}</p>
<p>总体感觉是TypeScript的vue没有vue3那些弯弯绕绕，还是比较直接的，我想以后的发展应该也会越来越好，我感觉新项目的话值得尝试。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift192webpack%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift192webpack%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">webpack学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-12 16:07:36" itemprop="dateModified" datetime="2021-04-12T16:07:36+08:00">2021-04-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>webpack.config.js<br>const path = require(‘path’);<br>module.exports = {<br>    mode: ‘production’,<br>    // 入口文件配置<br>    entry: ‘./js/test.js’,<br>    // 输出配置<br>    output: {<br>        // 出口文件<br>        filename: ‘bundle.js’,<br>        // 设置全路径<br>        path: path.resolve(__dirname, ‘dist’)<br>    },<br>    module: {<br>        // 规则数组, 里面的每一个对象都是在描述一个loader<br>        rules: [<br>            {<br>                //css文件加载，正则表达式css文件的路径<br>                test: /.css$/,<br>                use: [<br>                    ‘style-loader’,<br>                    ‘css-loader’<br>                ]<br>            },<br>            {<br>                ////图片文件加载<br>                test: /.(png|jpg|gif)$/,<br>                use: [<br>                    {<br>                        loader: ‘file-loader’,<br>                        query: {<br>                            name: ‘img/[name]-[hash:5].[ext]’<br>                        }<br>                    },<br>                ],<br>            },<br>        ]<br>    },<br>    devServer:{<br>        contentBase: ‘./dist’<br>    }<br>};</p>
<p>package.json</p>
<p>{<br>  “name”: “state-snow”, // 项目名称<br>  “version”: “0.1.0”, // 版本<br>  “private”: true,<br>  “scripts”: { // 运行脚本<br>    “serve”: “vue-cli-service serve”,<br>    “build”: “vue-cli-service build”,<br>    “docker”: “docker build -t fdrb-web . &amp;&amp; docker save -o fdrb-web.tar fdrb-web”<br>  },<br>  “dependencies”: { // 项目依赖<br>  }<br>  “devDependencies”: { // 开发依赖<br>  }<br>}</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift195Spring%20boot%20Bean/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift195Spring%20boot%20Bean/" class="post-title-link" itemprop="url">Spring Boot Bean</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-14 15:04:01" itemprop="dateModified" datetime="2021-04-14T15:04:01+08:00">2021-04-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用Spring框架之后，调用者无需主动获取被依赖对象，调用者只要被动接受Spring容器为调用者的成员变量赋值即可，由此可见，使用Spring后，调用者获取被依赖对象的方式由原来的主动获取，变成了被动接受——所以Rod Johnson称之为控制反转。<br>Spring容器中的Bean</p>
<p>对于开发者来说，开发者使用Spring框架主要是做两件事：①开发Bean；②配置Bean。对于Spring框架来说，它要做的就是根据配置文件来创建Bean实例，并调用Bean实例的方法完成“依赖注入”——这就是所谓IoC的本质。<br>如果不指定Bean的作用域，Spring默认使用singleton作用域。<br>对于一次HTTP会话，session作用域的Bean将只生成一个实例，这意味着，在同一次HTTP会话内，程序每次请求该Bean，得到的总是同一个实例。只有在Web应用中使用Spring时，该作用域才真正有效；<br>global session: 每个全局的HTTP Session对应一个Bean实例。在典型的情况下，仅在使用portlet context的时候有效，同样只在Web应用中有效。</p>
<p>什么是DTO：<br>DTO是Data Transfer Object 的简写，既数据传输对象。DTO用于在服务器与客户端之间或服务器与服务器之间进行数据传递</p>
<p>mybatis-plus<br>注解<br>@TableName ： 表名注解<br>@TableId ： 主键注解<br>@TableField ： 字段注解</p>
<p>代码生成器<br>通过 AutoGenerator 可以快速生成 Entity、Mapper、Mapper XML、Service、Controller 等各个模块的代码，极大的提升了开发效率。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift236%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift236%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/" class="post-title-link" itemprop="url">常见的汇编指令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-28 14:56:36" itemprop="dateModified" datetime="2021-09-28T14:56:36+08:00">2021-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>AT&amp;T<br>寄存器名称    %rax<br>操作数顺序    movq %rax %rdx<br>常数、立即数    movq $3 %rax<br>内存赋值    movq $0xa, 0x1ff7(%rip)<br>取内存地址    leaq -0x18(%rbp),%rax<br>jmp指令 jmp 0x4000102<br>call指令 call *%rdx<br>操作长度 movl %eax %edx<br>B = byte 8<br>S = short 16<br>W = word 16<br>L = long 32<br>Q = quad 64<br>T = ten bytes 80</p>
<p>常见的寄存器：<br>rax 、rbx、rcx、rdx、rsx、rdi、rbp、rsp<br>r8、r9、r10、r11、r12、r13、r14、r15<br>寄存器的具体用途：<br>rax、rdx常作为函数返回值使用<br>rdi、rsi、rdx、rcx、r8、r9等寄存器常用于存放函数参数<br>rsp、rdp用于栈操作<br>rip 作为指令指针</p>
<p>规律：<br>内存地址格式为： 0x4bdc(%rip), 一般是全局变量，全局区（数据段）<br>内存地址格式为：-0x78(%rbp), 一般是局部变量，栈空间<br>内存地址格式为：0x10(%rax), 一般是堆空间</p>
<p>guard语句最大的优势就是在解包(Optional)时候, 比用 if 语句解包更优雅, 避免在大量串行解包的时候出现金字塔.<br>// guard let 保证变量／常量一定有值，没有值则返回。<br>var a: String? = “ddd”<br>guard let b = a else { print(“a is nil”) }<br>print(b) //注意解包之后b的作用域仍然有效</p>
<p>//if<br>var a: String? = “ddd”<br> if let b = a {<br>     print(b) //解包之后b的只有在 { … } 内才有作用域<br> }</p>
<p>ArrayList、LinkedList</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift238Cesium%E5%88%9B%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift238Cesium%E5%88%9B%E5%BB%BA/" class="post-title-link" itemprop="url">Cesium创建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-14 21:42:41" itemprop="dateModified" datetime="2022-03-14T21:42:41+08:00">2022-03-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>export const createMap = function(element, option) {<br>    this._option = option ? option : {}<br>    this._option.imageryProvider = this._option.imageryProvider ? new Cesium.UrlTemplateImageryProvider({<br>        url:this._option.imageryProvider,<br>        tilingScheme: new Cesium.WebMercatorTilingScheme(),<br>        fileExtension: ‘png’<br>    }) : layer.createImageryProvider({<br>        type: ‘www_tdt’,<br>        layer: ‘img’<br>    });<br>    this._option.terrainProvider = this._option.terrainProvider ? new Cesium.CesiumTerrainProvider({<br>        url:this._option.terrainProvider,<br>        requestVertexNormals: true,<br>        requestWaterMask: true<br>    }) : new Cesium.CesiumTerrainProvider({<br>        url: ‘<a target="_blank" rel="noopener" href="https://lab.earthsdk.com/terrain/42752d50ac1f11e99dbd8fd044883638&#39;">https://lab.earthsdk.com/terrain/42752d50ac1f11e99dbd8fd044883638&#39;</a>,<br>        requestVertexNormals: true,<br>        requestWaterMask: true</p>
<pre><code>&#125;);
this._option.orderIndependentTranslucency = this._option.orderIndependentTranslucency ? this._option.orderIndependentTranslucency : false;
this._option.contextOptions = this._option.contextOptions ? this._option.contextOptions : &#123;
    webgl: &#123;
        alpha: true,
        depth:true,
        stencil:true,
        antialias:true,
        premultipliedAlpha:true,
        //通过canvas.toDataURL()实现截图需要将该项设置为true
        preserveDrawingBuffer:true,
        failIfMajorPerformanceCaveat:true
    &#125;
&#125;;
//需要进行可视化的数据源的集合
this._option.animation = this._option.animation ? this._option.animation : false; //是否显示动画控件
this._option.shouldAnimate = this._option.shouldAnimate ? this._option.shouldAnimate : true;
this._option.homeButton = this._option.homeButton ? this._option.homeButton : false; //是否显示Home按钮
this._option.fullscreenButton = this._option.fullscreenButton ? this._option.fullscreenButton : false; //是否显示全屏按钮
this._option.baseLayerPicker = this._option.baseLayerPicker ? this._option.baseLayerPicker : false; //是否显示图层选择控件
this._option.geocoder = this._option.geocoder ? this._option.geocoder : false; //是否显示地名查找控件
this._option.timeline = this._option.timeline ? this._option.timeline : false; //是否显示时间线控件
this._option.sceneModePicker = this._option.sceneModePicker ? this._option.sceneModePicker : false; //是否显示投影方式控件
this._option.navigationHelpButton = this._option.navigationHelpButton ? this._option.navigationHelpButton : false; //是否显示帮助信息控件
this._option.infoBox = this._option.infoBox ? this._option.infoBox : false; //是否显示点击要素之后显示的信息
this._option.requestRenderMode = this._option.requestRenderMode ? this._option.requestRenderMode : false; //启用请求渲染模式
this._option.scene3DOnly = this._option.scene3DOnly ? this._option.requestRenderMode : true; //每个几何实例将只能以3D渲染以节省GPU内存
this._option.sceneMode = this._option.sceneMode ? this._option.sceneMode : 3; //初始场景模式 1 2D模式 2 2D循环模式 3 3D模式  Cesium.SceneMode
this._option.fullscreenElement = this._option.fullscreenElement ? this._option.fullscreenElement : document.body; //全屏时渲染的HTML元素 暂时没发现用处
this._option.skyAtmosphere =  false; //关闭地球光环

let viewer = new Cesium.Viewer(element, this._option);
viewer._cesiumWidget._creditContainer.style.display = &quot;none&quot;; // 隐藏版权
viewer.scene.screenSpaceCameraController.zoomEventTypes = [
    Cesium.CameraEventType.WHEEL,
    Cesium.CameraEventType.PINCH,
];
viewer.scene.screenSpaceCameraController.tiltEventTypes = [
    Cesium.CameraEventType.PINCH,
    Cesium.CameraEventType.RIGHT_DRAG,
];
viewer.scene.skyBox.show = true;
//viewer.scene.backgroundColor = new Cesium.Color(0.0, 0.0, 0.0, 0.0);
//去掉entity的点击事件 start
viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);
viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
//去掉entity的点击事件 end
viewer.scene.globe.depthTestAgainstTerrain = true;//深度检测

return viewer;
</code></pre>
<p>}</p>
<h2 id="添加3dtile"><a href="#添加3dtile" class="headerlink" title="添加3dtile"></a>添加3dtile</h2><pre><code> new Cesium.Cesium3DTileset(params).readyPromise
  .then((tileset) =&gt; &#123;
    // console.log( tileset )

    that.tileset = tileset;

    that._scene.primitives.add(tileset);

    var position = that.getCartographic(tileset);

    that.position = position;
    //console.log(that.position)
    //that._flyTo(position[0], position[1], position[2]);
    
    that._viewer.zoomTo(tileset);

    that._cb.call(that,position);

    //添加悬浮样式
    if (
      that._option.showArea &amp;&amp;
      that._option.showArea.show &amp;&amp;
      that._option.showArea.material
    ) &#123;
      that.addShowArea(that._option.showArea.material, position);
    &#125;
    //是否拖拽
    if (that._option.drag) &#123;
      that.creatArrowPolyLine(tileset, position);
    &#125;
    //是否旋转
    if (that._option.rorate) &#123;
      that.createAxisSphere(tileset, position);
    &#125;
    //是否缩放
    if (that._option.scale) &#123;
      that.createScaleAxisSphere(tileset, position);
    &#125;
    that._initEvent2();
  &#125;)
  .otherwise(function(error) &#123;
    console.log(error);
  &#125;);
</code></pre>
<h2 id="添加glb"><a href="#添加glb" class="headerlink" title="添加glb"></a>添加glb</h2><p>let model = this._scene.primitives.add(Cesium.Model.fromGltf(params));</p>
<pre><code>    model.readyPromise.then((model) =&gt; &#123;

        that.model = model;



        try &#123;

            // Play and loop all animations at half-spead
            // model.activeAnimations.addAll(&#123;
            //     speedup : 0.5,
            //     loop : Cesium.ModelAnimationLoop.REPEAT
            // &#125;);


            that._flyTo(lng, lat, alt);

            that._cb.call(that);



            if (that._option.showArea &amp;&amp; that._option.showArea.show &amp;&amp; that._option.showArea.material) &#123;

                that.addShowArea(that._option.showArea.material)
            &#125;

            //是否拖拽
            if (that._option.drag) &#123;

                that.creatArrowPolyLine(model, this._option.position)


            &#125;

            //是否缩放
            if (that._option.needscale) &#123;

                that.createScaleAxisSphere(model, this._option.position)

            &#125;

            that._initEvent()

        &#125; catch (error) &#123;
            console.log(error)
        &#125;

    &#125;)

&#125;
var materials = new farsee3D.materials(&#39;EllipsoidFade&#39;,&#123;color:Cesium.Color.AQUAMARINE,time:3000&#125;);
</code></pre>
<h2 id="flyTo"><a href="#flyTo" class="headerlink" title="flyTo"></a>flyTo</h2><pre><code>this.viewerFlyTo = function (entity, heading, pitch, range) &#123;
    this.viewer.flyTo(entity, &#123;
        offset: &#123;
            heading: Cesium.Math.toRadians(heading),
            pitch: Cesium.Math.toRadians(pitch),
            range: range
        &#125;
    &#125;);
&#125;
this.cameraFlyTo = function (pos, heading, pitch, roll) &#123;
    viewer.camera.flyTo(&#123;
        destination: Cesium.Cartesian3.fromDegrees(pos[0], pos[1], pos[2]),
        orientation: &#123;
            heading: Cesium.Math.toRadians(heading),
            pitch: Cesium.Math.toRadians(pitch),
            roll: roll
        &#125;
    &#125;);
&#125;
</code></pre>
<p>GeoJsonDataSource<br>    GeoJsonDataSource: function (geojsonUrl, callBack) {<br>        var promise = Cesium.GeoJsonDataSource.load(geojsonUrl)<br>        promise.then(function (dataSource) {<br>            callBack(dataSource);<br>        })<br>        return promise<br>    }</p>
<h2 id="camera"><a href="#camera" class="headerlink" title="camera"></a>camera</h2><pre><code>// 获取当前镜头位置的笛卡尔坐标
let cameraPos = viewer.camera.position;
// 获取当前坐标系标准
let ellipsoid = viewer.scene.globe.ellipsoid;
// 根据坐标系标准，将笛卡尔坐标转换为地理坐标
let cartographic = ellipsoid.cartesianToCartographic(cameraPos);
// 获取镜头的高度
let height = cartographic.height;
// 根据上面当前镜头的位置，获取该中心位置的经纬度坐标
this.centerLon = parseFloat(Cesium.Math.toDegrees(cartographic.longitude).toFixed(8));
this.centerLat = parseFloat(Cesium.Math.toDegrees(cartographic.latitude).toFixed(8));
this.zoomIn = function () &#123;
    viewer.camera.flyTo(&#123;
        destination: Cesium.Cartesian3.fromDegrees(this.centerLon, this.centerLat, height / 1.8),
        duration: 1.0
    &#125;);
&#125;
this.out = function () &#123;
    viewer.camera.flyTo(&#123;
        destination: Cesium.Cartesian3.fromDegrees(this.centerLon, this.centerLat, height * 1.8),
        duration: 1.0
    &#125;);
&#125;
</code></pre>
<h2 id="坐标转换"><a href="#坐标转换" class="headerlink" title="坐标转换"></a>坐标转换</h2><pre><code> WHCGCE2000ToWGS84(coord) &#123;
    var wgs84 = &#39;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs  &#39;;
    var WHCGCE2000 = &#39;+proj=tmerc +lat_0=0 +lon_0=114.3333333333333 +k=1 +x_0=800000 +y_0=-3000000.0 +ellps=GRS80 +units=m +no_defs&#39;;
    return proj4(WHCGCE2000, wgs84, coord)
&#125;,
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift239Cesium%E6%B5%8B%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift239Cesium%E6%B5%8B%E9%87%8F/" class="post-title-link" itemprop="url">Cesium测量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-28 15:00:43" itemprop="dateModified" datetime="2021-09-28T15:00:43+08:00">2021-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>import proj4 from “proj4”;</p>
<p>if (typeof Cesium !== ‘undefined’)<br>    /**</p>
<pre><code> * @author zhangti
 * @param viewer  &#123;object&#125; 三维对象
 * @param options &#123;object&#125; 初始化参数
 * @constructor
 */
Cesium.Measure = (function (Cesium) &#123;

    /**
     * 绘制对象
     * @param viewer
     * @param options
     * @constructor
     */
    function _(viewer, options = &#123;&#125;) &#123;

        if (viewer &amp;&amp; viewer instanceof Cesium.Viewer) &#123;

            this._drawLayer = new Cesium.CustomDataSource(&#39;measureLayer&#39;);

            viewer &amp;&amp; viewer.dataSources.add(this._drawLayer);

            this._basePath = options.basePath || &#39;&#39;;

            this._viewer = viewer;
            
            this.handler = null
        &#125;
    &#125;

    _.prototype = &#123;
        /***
         * 坐标转换 84转笛卡尔
         *
         * @param &#123;Object&#125; &#123;lng,lat,alt&#125; 地理坐标
         *
         * @return &#123;Object&#125; Cartesian3 三维位置坐标
         */
        transformWGS84ToCartesian: function (position, alt) &#123;
            if (this._viewer) &#123;
                return position
                    ? Cesium.Cartesian3.fromDegrees(
                        position.lng || position.lon,
                        position.lat,
                        position.alt = alt || position.alt,
                        Cesium.Ellipsoid.WGS84
                    )
                    : Cesium.Cartesian3.ZERO
            &#125;
        &#125;,
        /***
         * 坐标数组转换 笛卡尔转84
         *
         * @param &#123;Array&#125; WSG84Arr &#123;lng,lat,alt&#125; 地理坐标数组
         * @param &#123;Number&#125; alt 拔高
         * @return &#123;Array&#125; Cartesian3 三维位置坐标数组
         */
        transformWGS84ArrayToCartesianArray: function (WSG84Arr, alt) &#123;
            if (this._viewer &amp;&amp; WSG84Arr) &#123;
                var $this = this
                return WSG84Arr
                    ? WSG84Arr.map(function (item) &#123;
                        return $this.transformWGS84ToCartesian(item, alt)
                    &#125;)
                    : []
            &#125;
        &#125;,
        /***
         * 坐标转换 笛卡尔转84
         *
         * @param &#123;Object&#125; Cartesian3 三维位置坐标
         *
         * @return &#123;Object&#125; &#123;lng,lat,alt&#125; 地理坐标
         */
        transformCartesianToWGS84: function (cartesian) &#123;
            if (this._viewer &amp;&amp; cartesian) &#123;
                var ellipsoid = Cesium.Ellipsoid.WGS84
                var cartographic = ellipsoid.cartesianToCartographic(cartesian)
                return &#123;
                    lng: Cesium.Math.toDegrees(cartographic.longitude),
                    lat: Cesium.Math.toDegrees(cartographic.latitude),
                    alt: cartographic.height
                &#125;
            &#125;
        &#125;,
        /***
         * 坐标数组转换 笛卡尔转86
         *
         * @param &#123;Array&#125; cartesianArr 三维位置坐标数组
         *
         * @return &#123;Array&#125; &#123;lng,lat,alt&#125; 地理坐标数组
         */
        transformCartesianArrayToWGS84Array: function (cartesianArr) &#123;
            if (this._viewer) &#123;
                var $this = this
                return cartesianArr
                    ? cartesianArr.map(function (item) &#123;
                        return $this.transformCartesianToWGS84(item)
                    &#125;)
                    : []
            &#125;
        &#125;,
        /**
         * 84坐标转弧度坐标
         * @param &#123;Object&#125; position wgs84
         * @return &#123;Object&#125; Cartographic 弧度坐标
         *
         */
        transformWGS84ToCartographic: function (position) &#123;
            return position
                ? Cesium.Cartographic.fromDegrees(
                    position.lng || position.lon,
                    position.lat,
                    position.alt
                )
                : Cesium.Cartographic.ZERO
        &#125;,
        /**
         * 拾取位置点
         *
         * @param &#123;Object&#125; px 屏幕坐标
         *
         * @return &#123;Object&#125; Cartesian3 三维坐标
         */
        getCatesian3FromPX: function (px) &#123;

            if (this._viewer &amp;&amp; px) &#123;
                var picks = this._viewer.scene.drillPick(px)
                var cartesian = null;
                var isOn3dtiles = false, isOnTerrain = false;
                // drillPick
                for (let i in picks) &#123;
                    let pick = picks[i]

                    if (pick &amp;&amp;
                        pick.primitive instanceof Cesium.Cesium3DTileFeature
                        || pick &amp;&amp; pick.primitive instanceof Cesium.Cesium3DTileset
                        || pick &amp;&amp; pick.primitive instanceof Cesium.Model) &#123; //模型上拾取
                        isOn3dtiles = true;
                    &#125;
                    // 3dtilset
                    if (isOn3dtiles) &#123;
                        this._viewer.scene.pick(px) // pick
                        cartesian = this._viewer.scene.pickPosition(px);
                        if (cartesian) &#123;
                            let cartographic = Cesium.Cartographic.fromCartesian(cartesian);
                            if (cartographic.height &lt; 0) cartographic.height = 0;
                            let lon = Cesium.Math.toDegrees(cartographic.longitude)
                                , lat = Cesium.Math.toDegrees(cartographic.latitude)
                                , height = cartographic.height;
                            cartesian = this.transformWGS84ToCartesian(&#123;lng: lon, lat: lat, alt: height&#125;)

                        &#125;
                    &#125;
                &#125;
                // 地形
                let boolTerrain = this._viewer.terrainProvider instanceof Cesium.EllipsoidTerrainProvider;
                // Terrain
                if (!isOn3dtiles &amp;&amp; !boolTerrain) &#123;
                    var ray = this._viewer.scene.camera.getPickRay(px);
                    if (!ray) return null;
                    cartesian = this._viewer.scene.globe.pick(ray, this._viewer.scene);
                    isOnTerrain = true
                &#125;
                // 地球
                if (!isOn3dtiles &amp;&amp; !isOnTerrain &amp;&amp; boolTerrain) &#123;

                    cartesian = this._viewer.scene.camera.pickEllipsoid(px, this._viewer.scene.globe.ellipsoid);
                &#125;
                if (cartesian) &#123;
                    let position = this.transformCartesianToWGS84(cartesian)
                    if (position.alt &lt; 0) &#123;
                        cartesian = this.transformWGS84ToCartesian(position, 0.1)
                    &#125;
                    return cartesian;
                &#125;
                return false;
            &#125;

        &#125;,
        /**
         * 获取84坐标的距离
         * @param &#123;*&#125; positions
         */
        getPositionDistance: function (positions) &#123;
            let distance = 0
            for (let i = 0; i &lt; positions.length - 1; i++) &#123;
                let point1cartographic = this.transformWGS84ToCartographic(positions[i])
                let point2cartographic = this.transformWGS84ToCartographic(positions[i + 1])
                let geodesic = new Cesium.EllipsoidGeodesic()
                geodesic.setEndPoints(point1cartographic, point2cartographic)
                let s = geodesic.surfaceDistance
                s = Math.sqrt(
                    Math.pow(s, 2) +
                    Math.pow(point2cartographic.height - point1cartographic.height, 2)
                )
                distance = distance + s
            &#125;
            return distance.toFixed(3)
        &#125;,
        /**
         * 计算一组坐标组成多边形的面积
         * @param &#123;*&#125; positions
         */
        getPositionsArea: function (positions) &#123;
            let result = 0
            if (positions) &#123;
                let h = 0
                let ellipsoid = Cesium.Ellipsoid.WGS84
                positions.push(positions[0])
                for (let i = 1; i &lt; positions.length; i++) &#123;
                    let oel = ellipsoid.cartographicToCartesian(
                        this.transformWGS84ToCartographic(positions[i - 1])
                    )
                    let el = ellipsoid.cartographicToCartesian(
                        this.transformWGS84ToCartographic(positions[i])
                    )
                    h += oel.x * el.y - el.x * oel.y
                &#125;
                result = Math.abs(h).toFixed(2)
            &#125;
            return result
        &#125;,
        /**
         * 坐标查看
         */
        coordinateCheck: function (options = &#123;&#125;) &#123;
            if (this._viewer &amp;&amp; options) &#123;

                var positions = [], $this = this;
                $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    if (cartesian &amp;&amp; cartesian.x) &#123;
                        //if (positions.length === 0) &#123;
                        //    positions = cartesian.clone();
                        // &#125;
                        // 添加量测信息点
                        // console.log(cartesian);
                        _addInfoPoint(cartesian)
                        //positions.push(cartesian);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);


                // right
                $this.handler.setInputAction(function (movement) &#123;
                    $this.handler.destroy();
                &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);




                //添加坐标点
                function _addInfoPoint(position) &#123;
                    let wgs84Position = $this.transformCartesianToWGS84(position)
                    var wgs84 = &#39;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs  &#39;;
                    var WHCGCE2000 = &#39;+proj=tmerc +lat_0=0 +lon_0=114.3333333333333 +k=1 +x_0=800000 +y_0=-3000000.0 +ellps=GRS80 +units=m +no_defs&#39;;
                    let newposition = proj4(wgs84, WHCGCE2000, [wgs84Position.lng, wgs84Position.lat,wgs84Position.alt]);
                    options.cb&amp;&amp;options.cb(newposition)
                    var _labelEntity = new Cesium.Entity()
                    _labelEntity.position = position
                    _labelEntity.point = &#123;
                        pixelSize: 8,
                        outlineColor: Cesium.Color.LAWNGREEN,
                        outlineWidth: 2
                    &#125;
                    _labelEntity.label = &#123;
                        text: `$&#123;newposition[0]&#125;,$&#123;newposition[1]&#125;`,//($this.getPositionDistance($this.transformCartesianArrayToWGS84Array(positions)) / 1000).toFixed(4) + &#39;公里&#39;,
                        show: true,
                        showBackground: true,
                        font: &#39;12px Helvetica&#39;,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(-20, -30) //left top
                    &#125;
                    $this._drawLayer.entities.add(_labelEntity)
                &#125;
            &#125;
        &#125;,
        /**
         * 
         * @param &#123;*&#125; callback 
         */
        returnCoordinate:function(callback)&#123;
            if (this._viewer &amp;&amp; callback) &#123;
                var $this = this;
                var heading,pitch;
                $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;
              
                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    let wgs84Position = $this.transformCartesianToWGS84(cartesian);
                    var camera =  $this._viewer.scene.camera;
                    var cartesian2 = $this._viewer.scene.pickPosition(movement.position);
                    if (cartesian2) &#123;
                        heading = Cesium.Math.toDegrees(camera.heading);
                        pitch = Cesium.Math.toDegrees(camera.pitch);
                    &#125;
                    callback(&#123;...wgs84Position,heading,pitch&#125;);
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);
            &#125;
        &#125;,
        /**
         * 测距
         * @param &#123;*&#125; options
         */
        drawLineMeasureGraphics: function (options = &#123;&#125;) &#123;
           

            if (this._viewer &amp;&amp; options) &#123;

                console.log(&#39;测距2&#39;,this)

                var positions = [], _lineEntity = new Cesium.Entity(), $this = this, lineObj;

                $this.handler = new Cesium.ScreenSpaceEventHandler($this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    if (cartesian &amp;&amp; cartesian.x) &#123;
                        if (positions.length == 0) &#123;
                            positions.push(cartesian.clone());
                        &#125;
                        // 添加量测信息点
                        _addInfoPoint(cartesian)
                        positions.push(cartesian);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);

                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.endPosition);
                    if (positions.length &gt;= 2) &#123;
                        if (cartesian &amp;&amp; cartesian.x) &#123;
                            positions.pop();
                            positions.push(cartesian);
                        &#125;
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
                // right
                $this.handler.setInputAction(function (movement) &#123;

                    $this.handler.destroy()
                    $this.handler = null

                    let cartesian = $this.getCatesian3FromPX(movement.position);
                    _addInfoPoint(cartesian)

                    if (typeof options.callback === &#39;function&#39;) &#123;
                        options.callback($this.transformCartesianArrayToWGS84Array(positions), lineObj);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

                _lineEntity.polyline = &#123;
                    width: options.width || 5
                    , material: options.material || Cesium.Color.BLUE.withAlpha(0.8)
                    , clampToGround: options.clampToGround || false
                &#125;
                _lineEntity.polyline.positions = new Cesium.CallbackProperty(function () &#123;
                    return positions
                &#125;, false)
                lineObj = this._drawLayer.entities.add(_lineEntity)

                //添加坐标点
                function _addInfoPoint(position) &#123;
                    var _labelEntity = new Cesium.Entity()
                    _labelEntity.position = position
                    _labelEntity.point = &#123;
                        pixelSize: 10,
                        outlineColor: Cesium.Color.BLUE,
                        outlineWidth: 5
                    &#125;
                    _labelEntity.label = &#123;
                        text: ($this.getPositionDistance($this.transformCartesianArrayToWGS84Array(positions)) / 1000).toFixed(4) + &#39;公里&#39;,
                        show: true,
                        showBackground: true,
                        font: &#39;14px monospace&#39;,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(-20, -80) //left top
                    &#125;
                    $this._drawLayer.entities.add(_labelEntity)
                &#125;
            &#125;

        &#125;,
        /**
         * 测面积
         * @param &#123;*&#125; options
         */
        drawAreaMeasureGraphics: function (options = &#123;&#125;) &#123;

            if (this._viewer &amp;&amp; options) &#123;

                var positions = [], polygon = new Cesium.PolygonHierarchy(), _polygonEntity = new Cesium.Entity(),
                    $this = this, polyObj = null, _label = &#39;&#39;;
                $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
                // left
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.position);
                    if (cartesian &amp;&amp; cartesian.x) &#123;
                        if (positions.length == 0) &#123;
                            polygon.positions.push(cartesian.clone())
                            positions.push(cartesian.clone());
                        &#125;
                        positions.push(cartesian.clone());
                        polygon.positions.push(cartesian.clone())

                        if (!polyObj) create()
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);
                // mouse
                $this.handler.setInputAction(function (movement) &#123;

                    var cartesian = $this.getCatesian3FromPX(movement.endPosition);
                    // var cartesian = $this._viewer.scene.camera.pickEllipsoid(movement.endPosition, $this._viewer.scene.globe.ellipsoid);
                    if (positions.length &gt;= 2) &#123;
                        if (cartesian &amp;&amp; cartesian.x) &#123;
                            positions.pop()
                            positions.push(cartesian);
                            polygon.positions.pop()
                            polygon.positions.push(cartesian);
                        &#125;
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

                // right
                $this.handler.setInputAction(function (movement) &#123;
                    let cartesian = $this.getCatesian3FromPX(movement.endPosition);

                    $this.handler.destroy();

                    positions.push(positions[0]);

                    // 添加信息点
                    _addInfoPoint(positions[0])
                    if (typeof options.callback === &#39;function&#39;) &#123;

                        options.callback($this.transformCartesianArrayToWGS84Array(positions), polyObj);
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

                function create() &#123;
                    _polygonEntity.polyline = &#123;
                        width: 3
                        , material: Cesium.Color.BLUE.withAlpha(0.8)
                        , clampToGround: options.clampToGround || false
                    &#125;

                    _polygonEntity.polyline.positions = new Cesium.CallbackProperty(function () &#123;
                        return positions
                    &#125;, false)

                    _polygonEntity.polygon = &#123;

                        hierarchy: new Cesium.CallbackProperty(function () &#123;
                            return polygon
                        &#125;, false),

                        material: Cesium.Color.WHITE.withAlpha(0.1)
                        , clampToGround: options.clampToGround || false
                    &#125;
                    polyObj = $this._drawLayer.entities.add(_polygonEntity)
                &#125;

                function _addInfoPoint(position) &#123;
                    var _labelEntity = new Cesium.Entity()
                    _labelEntity.position = position
                    _labelEntity.point = &#123;
                        pixelSize: 10,
                        outlineColor: Cesium.Color.BLUE,
                        outlineWidth: 5
                    &#125;
                    _labelEntity.label = &#123;
                        text: ($this.getPositionsArea($this.transformCartesianArrayToWGS84Array(positions)) / 1000000.0).toFixed(4) + &#39;平方公里&#39;,
                        show: true,
                        showBackground: true,
                        font: &#39;14px monospace&#39;,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(-20, -50) //left top
                    &#125;
                    $this._drawLayer.entities.add(_labelEntity)
                &#125;
            &#125;

        &#125;,
        /**
         * 画三角量测
         * @param &#123;*&#125; options
         */
        drawTrianglesMeasureGraphics: function (options = &#123;&#125;) &#123;
            options.style = options.style ||
                &#123;
                    width: 3
                    , material: Cesium.Color.BLUE.withAlpha(0.5)
                &#125;
            if (this._viewer &amp;&amp; options) &#123;

                var _trianglesEntity = new Cesium.Entity(), _tempLineEntity = new Cesium.Entity(),
                    _tempLineEntity2 = new Cesium.Entity(),
                    _positions = [], _tempPoints = [], _tempPoints2 = [], $this = this,
                    _handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);

                // 高度
                function _getHeading(startPosition, endPosition) &#123;
                    if (!startPosition &amp;&amp; !endPosition) return 0
                    if (Cesium.Cartesian3.equals(startPosition, endPosition)) return 0
                    let cartographic = Cesium.Cartographic.fromCartesian(startPosition);
                    let cartographic2 = Cesium.Cartographic.fromCartesian(endPosition);
                    return (cartographic2.height - cartographic.height).toFixed(2)
                &#125;

                // 偏移点
                function _computesHorizontalLine(positions) &#123;
                    let cartographic = Cesium.Cartographic.fromCartesian(positions[0]);
                    let cartographic2 = Cesium.Cartographic.fromCartesian(positions[1]);
                    return Cesium.Cartesian3.fromDegrees(
                        Cesium.Math.toDegrees(cartographic.longitude),
                        Cesium.Math.toDegrees(cartographic.latitude),
                        cartographic2.height
                    )
                &#125;

                // left
                _handler.setInputAction(function (movement) &#123;

                    var position = $this.getCatesian3FromPX(movement.position);
                    if (!position &amp;&amp; !position.z) return false
                    if (_positions.length == 0) &#123;
                        _positions.push(position.clone())
                        _positions.push(position.clone())
                        _tempPoints.push(position.clone())
                        _tempPoints.push(position.clone())
                    &#125; else &#123;
                        _handler.destroy();
                        if (typeof options.callback === &#39;function&#39;) &#123;

                            options.callback(&#123;e: _trianglesEntity, e2: _tempLineEntity, e3: _tempLineEntity2&#125;);
                        &#125;
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);
                // mouse
                _handler.setInputAction(function (movement) &#123;

                    var position = $this.getCatesian3FromPX(movement.endPosition);
                    if (position &amp;&amp; _positions.length &gt; 0) &#123;
                        //直线
                        _positions.pop()
                        _positions.push(position.clone());
                        let horizontalPosition = _computesHorizontalLine(_positions)
                        //高度
                        _tempPoints.pop()
                        _tempPoints.push(horizontalPosition.clone())
                        //水平线
                        _tempPoints2.pop(), _tempPoints2.pop()
                        _tempPoints2.push(position.clone())
                        _tempPoints2.push(horizontalPosition.clone())
                    &#125;
                &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE)

                // create entity

                //直线
                _trianglesEntity.polyline = &#123;
                    positions: new Cesium.CallbackProperty(function () &#123;
                        return _positions
                    &#125;, false),
                    ...options.style
                &#125;
                _trianglesEntity.position = new Cesium.CallbackProperty(function () &#123;
                    return _positions[0]
                &#125;, false)
                _trianglesEntity.point = &#123;
                    pixelSize: 5,
                    outlineColor: Cesium.Color.BLUE,
                    outlineWidth: 5
                &#125;
                _trianglesEntity.label = &#123;
                    text: new Cesium.CallbackProperty(function () &#123;
                        return &#39;直线:&#39; + $this.getPositionDistance($this.transformCartesianArrayToWGS84Array(_positions)) + &#39;米&#39;
                    &#125;, false),
                    show: true,
                    showBackground: true,
                    font: &#39;14px monospace&#39;,
                    horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(50, -100) //left top
                &#125;
                //高度
                _tempLineEntity.polyline = &#123;
                    positions: new Cesium.CallbackProperty(function () &#123;
                        return _tempPoints
                    &#125;, false),
                    ...options.style
                &#125;
                _tempLineEntity.position = new Cesium.CallbackProperty(function () &#123;
                    return _tempPoints2[1]
                &#125;, false)
                _tempLineEntity.point = &#123;
                    pixelSize: 5,
                    outlineColor: Cesium.Color.BLUE,
                    outlineWidth: 5
                &#125;
                _tempLineEntity.label = &#123;
                    text: new Cesium.CallbackProperty(function () &#123;
                        return &#39;高度:&#39; + _getHeading(_tempPoints[0], _tempPoints[1]) + &#39;米&#39;
                    &#125;, false),
                    show: true,
                    showBackground: true,
                    font: &#39;14px monospace&#39;,
                    horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(-20, 100) //left top
                &#125;
                //水平
                _tempLineEntity2.polyline = &#123;
                    positions: new Cesium.CallbackProperty(function () &#123;
                        return _tempPoints2
                    &#125;, false),
                    ...options.style
                &#125;
                _tempLineEntity2.position = new Cesium.CallbackProperty(function () &#123;
                    return _positions[1]
                &#125;, false)
                _tempLineEntity2.point = &#123;
                    pixelSize: 5,
                    outlineColor: Cesium.Color.BLUE,
                    outlineWidth: 5
                &#125;
                _tempLineEntity2.label = &#123;
                    text: new Cesium.CallbackProperty(function () &#123;
                        return &#39;水平距离:&#39; + $this.getPositionDistance($this.transformCartesianArrayToWGS84Array(_tempPoints2)) + &#39;米&#39;
                    &#125;, false),
                    show: true,
                    showBackground: true,
                    font: &#39;14px monospace&#39;,
                    horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(-150, -20) //left top
                &#125;
                this._drawLayer.entities.add(_tempLineEntity2)
                this._drawLayer.entities.add(_tempLineEntity)
                this._drawLayer.entities.add(_trianglesEntity)
            &#125;
        &#125;,

        /**
         * 测高度
         * */
        //****************************高度测量 第一个点的经纬度，第二个点的高度，两点水平距离为半径************************************************//
        drawHeightMeasureGraphics: function () &#123;
            let viewer = this._viewer;
            let $this = this;
            var _lineEntity = new Cesium.Entity();
            // var handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
            $this.handler = new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);
            var positions = [];
            var poly = null;
            var tooltip = document.getElementById(&quot;toolTip&quot;);
            var height = 0;
            var cartesian = null;
            tooltip.style.display = &quot;block&quot;;

            $this.handler.setInputAction(function (movement) &#123;
                tooltip.style.left = movement.endPosition.x + 3 + &quot;px&quot;;
                tooltip.style.top = movement.endPosition.y - 25 + &quot;px&quot;;
                tooltip.style.color = &#39;#ffffff&#39;
                tooltip.innerHTML = &#39;&lt;p&gt;单击左键开始，单击右键结束&lt;/p&gt;&#39;;
                cartesian = viewer.scene.pickPosition(movement.endPosition);
                if (positions.length &gt;= 2) &#123;
                    if (!Cesium.defined(poly)) &#123;
                        poly = new PolyLinePrimitive(positions);
                    &#125; else &#123;
                        positions.pop();
                        positions.push(cartesian);
                    &#125;
                    height = getHeight(positions);
                &#125;
            &#125;, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

            $this.handler.setInputAction(function (movement) &#123;
                tooltip.style.display = &quot;none&quot;;
                cartesian = viewer.scene.pickPosition(movement.position);
                if (positions.length === 0) &#123;
                    positions.push(cartesian.clone());
                    positions.push(cartesian);
                    _lineEntity.position = positions[0]
                    _lineEntity.point = &#123;
                        pixelSize: 5,
                        color: Cesium.Color.RED,
                        outlineColor: Cesium.Color.WHITE,
                        outlineWidth: 2,
                        heightReference: Cesium.HeightReference.none
                    &#125;
                    _lineEntity.label = &#123;
                        text: &#39;0米&#39;,
                        font: &#39;18px sans-serif&#39;,
                        fillColor: Cesium.Color.GOLD,
                        style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                        outlineWidth: 2,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(20, -20)
                    &#125;
                    $this._drawLayer.entities.add(_lineEntity)
                &#125;

            &#125;, Cesium.ScreenSpaceEventType.LEFT_CLICK);

            $this.handler.setInputAction(function (movement) &#123;
                $this.handler.destroy();
                //positions.pop();//清除移动点
                tooltip.style.display = &quot;none&quot;;
                //viewer_g.entities.remove(floatingPoint);
                // console.log(positions);
                //在三维场景中添加Label

                var textDisance = height + &quot;米&quot;;

                var point1cartographic = Cesium.Cartographic.fromCartesian(positions[0]);
                var point2cartographic = Cesium.Cartographic.fromCartesian(positions[1]);
                var point_temp = Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(point1cartographic.longitude), Cesium.Math.toDegrees(point1cartographic.latitude), point2cartographic.height);
                _lineEntity.position = point_temp//positions[1]
                _lineEntity.point = &#123;
                    pixelSize: 5,
                    color: Cesium.Color.RED,
                    outlineColor: Cesium.Color.WHITE,
                    outlineWidth: 2,
                    heightReference: Cesium.HeightReference.none
                &#125;
                _lineEntity.label = &#123;
                    text: textDisance,
                    font: &#39;18px sans-serif&#39;,
                    fillColor: Cesium.Color.GOLD,
                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                    outlineWidth: 2,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(20, -20)
                &#125;
                $this._drawLayer.entities.add(_lineEntity)
            &#125;, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

            function getHeight(_positions) &#123;
                var cartographic = Cesium.Cartographic.fromCartesian(_positions[0]);
                var cartographic1 = Cesium.Cartographic.fromCartesian(_positions[1]);
                var height_temp = cartographic1.height - cartographic.height;
                return height_temp.toFixed(2);
            &#125;

            var PolyLinePrimitive = (function () &#123;
                function _(positions) &#123;
                    this.options = &#123;
                        name: &#39;直线&#39;,
                        polyline: &#123;
                            show: true,
                            positions: [],
                            material: Cesium.Color.AQUA,
                            width: 2
                        &#125;,
                        ellipse: &#123;
                            show: true,
                            // semiMinorAxis : 30.0,
                            // semiMajorAxis : 30.0,
                            // height: 20.0,
                            material: Cesium.Color.GREEN.withAlpha(0.5),
                            outline: true // height must be set for outline to display
                        &#125;
                    &#125;;
                    this.positions = positions;
                    this._init();
                &#125;

                _.prototype._init = function () &#123;
                    var _self = this;
                    var _update = function () &#123;
                        var temp_position = [];
                        temp_position.push(_self.positions[0]);
                        var point1cartographic = Cesium.Cartographic.fromCartesian(_self.positions[0]);
                        var point2cartographic = Cesium.Cartographic.fromCartesian(_self.positions[1]);
                        var point_temp = Cesium.Cartesian3.fromDegrees(Cesium.Math.toDegrees(point1cartographic.longitude), Cesium.Math.toDegrees(point1cartographic.latitude), point2cartographic.height);
                        temp_position.push(point_temp);
                        console.log(temp_position);
                        return temp_position;
                    &#125;;
                    var _update_ellipse = function () &#123;
                        return _self.positions[0];
                    &#125;;
                    var _semiMinorAxis = function () &#123;
                        var point1cartographic = Cesium.Cartographic.fromCartesian(_self.positions[0]);
                        var point2cartographic = Cesium.Cartographic.fromCartesian(_self.positions[1]);
                        /**根据经纬度计算出距离**/
                        var geodesic = new Cesium.EllipsoidGeodesic();
                        geodesic.setEndPoints(point1cartographic, point2cartographic);
                        var s = geodesic.surfaceDistance;
                        return s;
                    &#125;;
                    var _height = function () &#123;
                        var height_temp = getHeight(_self.positions);
                        return height_temp;
                    &#125;;
                    //实时更新polyline.positions
                    this.options.polyline.positions = new Cesium.CallbackProperty(_update, false);
                    this.options.position = new Cesium.CallbackProperty(_update_ellipse, false);
                    this.options.ellipse.semiMinorAxis = new Cesium.CallbackProperty(_semiMinorAxis, false);
                    this.options.ellipse.semiMajorAxis = new Cesium.CallbackProperty(_semiMinorAxis, false);
                    this.options.ellipse.height = new Cesium.CallbackProperty(_height, false);
                    $this._drawLayer.entities.add(this.options);
                &#125;;

                return _;
            &#125;)();
        &#125;,
        /**
         * 清除测量
         * @param &#123;*&#125;
         */
        clear: function () &#123;
            this._drawLayer.entities.removeAll()
        &#125;,
        moveHandle:function()&#123;
            if(this._handlers)&#123;
                this._handlers.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
                this._handlers = null
            &#125;  
        &#125;
    &#125;
    return _
&#125;)(Cesium);
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift241Cesium%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift241Cesium%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">Cesium分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-14 21:42:50" itemprop="dateModified" datetime="2022-03-14T21:42:50+08:00">2022-03-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>坡度分析<br>slope<br>等高线<br>contourLine<br>地形开挖<br>clipping<br>淹没分析<br>SubmergeAnalysis<br>光照分析<br>SunshineAnalysis<br>坐标<br>WHCGCE2000ToWGS84<br>三维飞行初始化<br>flycesium<br>ViewShedStage<br>addHeatMap<br>addBillboard<br>addSkyBoxFn<br>DrawTool</p>
<h2 id="山谷、山脊"><a href="#山谷、山脊" class="headerlink" title="山谷、山脊"></a>山谷、山脊</h2><p>export const elevation = function (viewer, show) {<br>    viewer.scene.globe.enableLighting = true;<br>    var elevationRamp = [0.0, 0.045, 0.1, 0.15, 0.37, 0.54, 1.0];<br>    function getColorRamp(selectedShading) {<br>      var ramp = document.createElement(“canvas”);<br>      ramp.width = 100;<br>      ramp.height = 1;<br>      var ctx = ramp.getContext(“2d”);<br>      var values;<br>      if (selectedShading === “elevation”) {<br>        values = elevationRamp;<br>      }<br>      var grd = ctx.createLinearGradient(0, 0, 100, 0);<br>      grd.addColorStop(values[0], “#000000”); //black<br>      grd.addColorStop(values[1], “#2747E0”); //blue<br>      grd.addColorStop(values[2], “#D33B7D”); //pink<br>      grd.addColorStop(values[3], “#D33038”); //red<br>      grd.addColorStop(values[4], “#FF9742”); //orange<br>      grd.addColorStop(values[5], “#ffd700”); //yellow<br>      grd.addColorStop(values[6], “#ffffff”); //white<br>      ctx.fillStyle = grd;<br>      ctx.fillRect(0, 0, 100, 1);<br>      return ramp;<br>    }</p>
<pre><code>var minHeight = -414.0; // approximate dead sea elevation
var maxHeight = 8777.0; // approximate everest elevation
var contourColor = Cesium.Color.RED.clone();
var contourUniforms = &#123;&#125;;
var shadingUniforms = &#123;&#125;;

// The viewModel tracks the state of our mini application.
var viewModel = &#123;
  selectedShading: &quot;elevation&quot;,
  changeColor: function () &#123;
    contourUniforms.color = Cesium.Color.fromRandom(
      &#123; alpha: 1.0 &#125;,
      contourColor
    );
  &#125;,
&#125;;
function updateMaterial(selectedShading) &#123;
  viewModel.selectedShading = selectedShading;
  var globe = viewer.scene.globe;
  var material;
  if (selectedShading === &quot;elevation&quot;) &#123;
    material = Cesium.Material.fromType(&quot;ElevationRamp&quot;);
    shadingUniforms = material.uniforms;
    shadingUniforms.minimumHeight = minHeight;
    shadingUniforms.maximumHeight = maxHeight;
  &#125; 
  if (selectedShading !== &quot;none&quot;) &#123;
    shadingUniforms.image = getColorRamp(selectedShading);
  &#125;
  globe.material = material;
&#125;
updateMaterial(show? &quot;elevation&quot; : &quot;none&quot;);
</code></pre>
<p>}</p>
<h2 id="坡度分析"><a href="#坡度分析" class="headerlink" title="坡度分析"></a>坡度分析</h2><p>export const slope = function(viewer){<br>    viewer.scene.globe.enableLighting = true;<br>    var material = Cesium.Material.fromType(‘SlopeRamp’);<br>    var shadingUniforms = material.uniforms;<br>    shadingUniforms.image = getColorRamp();<br>    viewer.scene.globe.material = material;<br>    function getColorRamp() {<br>        var ramp = document.createElement(‘canvas’);<br>        ramp.width = 100;<br>        ramp.height = 1;<br>        var ctx = ramp.getContext(‘2d’);</p>
<pre><code>    var grd = ctx.createLinearGradient(0, 0, 100, 0);
   
    // var values = [0.0, 0.25,0.5];

    var values = [0.0,0.2,0.6,1];
    grd.addColorStop(values[0], &#39;rgba(0,0,0,0.0)&#39;); //black
    grd.addColorStop(values[1], &#39;rgba(220,20,60,0.6)&#39;); //blue
    grd.addColorStop(values[2], &#39;rgba(255,255,0,1.0)&#39;); //
    grd.addColorStop(values[3], &#39;rgba(255,0,255,1.0)&#39;); //green

    // var values = [0.0, 0.25, 0.5];
    // grd.addColorStop(values[0], &#39;rgba(0,0,0,0.8)&#39;); //black
    // grd.addColorStop(values[1], &#39;rgba(39,71,224,0.8)&#39;); //blue
    // grd.addColorStop(values[2], &#39;rgba(211,48,56,0.8)&#39;); //red

    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, 100, 1);
    return ramp;
&#125;
</code></pre>
<p>}</p>
<h2 id="等高线"><a href="#等高线" class="headerlink" title="等高线"></a>等高线</h2><p>export const contourLine = function (viewer) {</p>
<pre><code>viewer.scene.globe.enableLighting = true;

// 创建一个拥有高程阴影和等高线的组合样式
function getElevationContourMaterial() &#123;
    return new Cesium.Material(&#123;
        fabric: &#123;
            type: &#39;ElevationColorContour&#39;,
            materials: &#123;
                contourMaterial: &#123;
                    type: &#39;ElevationContour&#39;
                &#125;,
                elevationRampMaterial: &#123;
                    type: &#39;ElevationRamp&#39;
                &#125;
            &#125;,
            components: &#123;
                diffuse: &#39;contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse&#39;,
                alpha: &#39;max(contourMaterial.alpha, elevationRampMaterial.alpha)&#39;
            &#125;
        &#125;,
        translucent: false
    &#125;);
&#125;

var minHeight = 50.0; // 最低接近死海高度
var maxHeight = 1000.0; // 最高接近珠峰高度
var contourColor = Cesium.Color.AQUA.withAlpha(0.8); // 等高线的颜色
var contourSpacing = 100.0; // 等高线的等间距
var contourWidth = 2.0; // 等高线的宽度

// 1、高程阴影
// var material = Cesium.Material.fromType(&#39;ElevationRamp&#39;);
// var shadingUniforms = material.uniforms;
// shadingUniforms.minimumHeight = minHeight;
// shadingUniforms.maximumHeight = maxHeight;
// shadingUniforms.image = getColorRamp();

// 2、等高线
// var material = Cesium.Material.fromType(&#39;ElevationContour&#39;);
// var contourUniforms = material.uniforms;
// contourUniforms.width = contourWidth;
// contourUniforms.spacing = contourSpacing;
// contourUniforms.color = contourColor;

// 3、高程阴影+等高线
var material = getElevationContourMaterial();
var shadingUniforms = material.materials.elevationRampMaterial.uniforms;
shadingUniforms.minimumHeight = minHeight;
shadingUniforms.maximumHeight = maxHeight;
shadingUniforms.image = getColorRamp();

var contourUniforms = material.materials.contourMaterial.uniforms;
contourUniforms.width = contourWidth;
contourUniforms.spacing = contourSpacing;
contourUniforms.color = contourColor;
viewer.scene.globe.material = material;

function getColorRamp() &#123;
    var ramp = document.createElement(&#39;canvas&#39;);
    ramp.width = 100;
    ramp.height = 1;
    var ctx = ramp.getContext(&#39;2d&#39;);
    var values = [0.0, 0.045, 0.1, 0.15, 0.37, 0.54, 1.0];
    var grd = ctx.createLinearGradient(0, 0, 100, 0);

    // grd.addColorStop(values[0], &#39;rgba(0,0,0,0.0)&#39;); //black
    // grd.addColorStop(values[1], &#39;rgba(39,71,224,0.8)&#39;); //blue
    // grd.addColorStop(values[2], &#39;rgba(211,59,125,0.8)&#39;); //pink
    // grd.addColorStop(values[3], &#39;rgba(211,48,56,0.8)&#39;); //red
    // grd.addColorStop(values[4], &#39;rgba(255,151,66,0.8)&#39;); //orange
    // grd.addColorStop(values[5], &#39;rgba(255,215,0,0.8)&#39;); //yellow
    // grd.addColorStop(values[6], &#39;rgba(255,255,255,0.8)&#39;); //white


    grd.addColorStop(values[0], &#39;rgba(255,255,255,0)&#39;); //black
    grd.addColorStop(values[1], &#39;rgba(39,71,224,0.8)&#39;); //blue
    grd.addColorStop(values[2], &#39;rgba(211,59,125,0.8)&#39;); //pink
    grd.addColorStop(values[3], &#39;rgba(211,48,56,0.8)&#39;); //red
    grd.addColorStop(values[4], &#39;rgba(255,151,66,0.8)&#39;); //orange
    grd.addColorStop(values[5], &#39;rgba(255,215,0,0.8)&#39;); //yellow
    grd.addColorStop(values[6], &#39;rgba(255,255,255,0.8)&#39;); //white

   


    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, 100, 1);
    return ramp;
&#125;
</code></pre>
<p>}</p>
<h2 id="地形开挖"><a href="#地形开挖" class="headerlink" title="地形开挖"></a>地形开挖</h2><p>class ClippingPlane {<br>  constructor(tileset,viewer,image) {<br>    this._viewer = viewer;<br>    this.activeShapePoints = [];<br>    this.activeShape = null;<br>    this.floatingPoint = null;<br>    this.points = [];<br>    this.drawingMode = “polygon”; //多边形<br>    this.handler = null;<br>    this.image = image;<br>    this.init();<br>  }<br>  /**</p>
<ul>
<li><p>绑定点击事件</p>
</li>
<li><p>/<br>init() {</p>
<p>let that = this;</p>
<p>that.handler = new Cesium.ScreenSpaceEventHandler(that._viewer.canvas);</p>
<p>//双击鼠标左键清除默认事件<br>that._viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(<br>  Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK<br>);</p>
<p>that.handler.setInputAction(function(event) {</p>
<p>  // We use <code>viewer.scene.pickPosition</code> here instead of <code>viewer.camera.pickEllipsoid</code> so that<br>  // we get the correct point when mousing over terrain.<br>  // scene.pickPosition只有在开启地形深度检测，且不使用默认地形时是准确的。<br>  var earthPosition = that._viewer.scene.pickPosition(event.position);</p>
<p>  // <code>earthPosition</code> will be undefined if our mouse is not over the globe.<br>  if (Cesium.defined(earthPosition)) {</p>
<pre><code>if (that.activeShapePoints.length === 0) &#123;
  that.floatingPoint = that.createPoint(earthPosition);
  that.activeShapePoints.push(earthPosition);
  var dynamicPositions = new Cesium.CallbackProperty(function() &#123;
    if (that.drawingMode === &quot;polygon&quot;) &#123;
      return new Cesium.PolygonHierarchy(that.activeShapePoints);
    &#125;
    return that.activeShapePoints;
  &#125;, false);
  that.activeShape = that.drawShape(dynamicPositions); //绘制动态图
&#125;
that.activeShapePoints.push(earthPosition);
that.points.push(earthPosition)
that.createPoint(earthPosition);
</code></pre>
<p>  }<br>}, Cesium.ScreenSpaceEventType.LEFT_CLICK);</p>
<p>//鼠标移动<br>that.handler.setInputAction(function(event) {<br>  if (Cesium.defined(that.floatingPoint)) {</p>
<pre><code>var newPosition = that._viewer.scene.pickPosition(event.endPosition);
if (Cesium.defined(newPosition)) &#123;
  that.floatingPoint.position.setValue(newPosition);
  that.activeShapePoints.pop();
  that.activeShapePoints.push(newPosition);
&#125;
</code></pre>
<p>  }<br>}, Cesium.ScreenSpaceEventType.MOUSE_MOVE);</p>
<p>that.handler.setInputAction(function(event) {<br>  that._viewer.entities.remove(that.activeShape);<br>  that._viewer.entities.remove(that.floatingPoint);<br>  var earthPosition = that._viewer.scene.pickPosition(event.position);<br>  that.points.push(earthPosition);<br>  // console.log(‘points’, that.points);<br>  var planes = that.createClippingPlane(that.points);<br>  // console.log(‘planes’,planes)<br>  //赋值给globe的 clippingPlanes<br>  that._viewer.scene.globe.clippingPlanes = new Cesium.ClippingPlaneCollection({</p>
<pre><code>  planes: planes,
  edgeWidth: 1.0,
  edgeColor: Cesium.Color.WHITE
</code></pre>
<p>  })<br>  //依次计算顶点与下个顶点之间组成的线段，中间按照精度大小插值n个点，然后计算每个点的地形高度<br>  let promises = []<br>  for (let i = 0; i &lt; that.points.length - 1; i++) {</p>
<pre><code>  promises.push(that.calHeight(that._viewer, that.points[i], that.points[i + 1], 100)); // 返回promise对象
</code></pre>
<p>  }<br>  // 待所有的计算完毕后，处理坐标点，构造多边形<br>  Promise.all([…promises]).then(data =&gt; {</p>
<pre><code>  var positons = Array.prototype.concat.apply([], data); // 数组降维
  var hierarchy = [];
  positons.forEach(element =&gt; &#123;
      hierarchy.push(Cesium.Math.toDegrees(element.longitude));
      hierarchy.push(Cesium.Math.toDegrees(element.latitude));
      hierarchy.push(element.height);
  &#125;);
  that._viewer.entities.add(&#123;
      polygon: &#123;
          hierarchy: Cesium.Cartesian3.fromDegreesArrayHeights(hierarchy),
          closeTop: false, // 这个要设置为false
      material: that.image ?
        new Cesium.ImageMaterialProperty(&#123;
          image:that.image,
          // repeat:new Cesium.Cartesian2(100.0, 100.0)
        &#125;) : new Cesium.ColorMaterialProperty(Cesium.Color.BROWN),                  
          extrudedHeight: 0,
          perPositionHeight: true // 这个要设置true
      &#125;
  &#125;);
</code></pre>
<p>  })<br>}, Cesium.ScreenSpaceEventType.RIGHT_CLICK);<br>}<br>/**</p>
</li>
<li><p>根据点集计算 ClippingPlane</p>
</li>
<li><p>@param {*} points </p>
</li>
<li><p>@returns </p>
</li>
<li><p>/<br>createClippingPlane(points) {<br>var pointsLength = points.length;<br>var clippingPlanes = []; // 存储ClippingPlane集合<br>for (var i = 0; i &lt; pointsLength; ++i) {<br>  var nextIndex = (i + 1) % pointsLength;<br>  var midpoint = Cesium.Cartesian3.add(</p>
<pre><code>points[i],
points[nextIndex],
new Cesium.Cartesian3()
</code></pre>
<p>  );<br>  midpoint = Cesium.Cartesian3.multiplyByScalar(midpoint, 0.5, midpoint);<br>  var up = Cesium.Cartesian3.normalize(midpoint, new Cesium.Cartesian3());<br>  var right = Cesium.Cartesian3.subtract(</p>
<pre><code>points[nextIndex],
midpoint,
new Cesium.Cartesian3()
</code></pre>
<p>  );<br>  right = Cesium.Cartesian3.normalize(right, right);<br>  var normal = Cesium.Cartesian3.cross(right, up, new Cesium.Cartesian3());<br>  normal = Cesium.Cartesian3.normalize(normal, normal);<br>  var originCenteredPlane = new Cesium.Plane(normal, 0.0);<br>  var distance = Cesium.Plane.getPointDistance(</p>
<pre><code>originCenteredPlane,
midpoint
</code></pre>
<p>  );<br>  clippingPlanes.push(new Cesium.ClippingPlane(normal, distance));<br>}<br>return clippingPlanes;<br>}<br>/**</p>
</li>
<li><p>插值、计算坐标点高度（如果不加载地形的话，这步可以省略）</p>
</li>
<li><p>@param {*} viewer </p>
</li>
<li><p>@param {*} fromPoint </p>
</li>
<li><p>@param {*} endPoint </p>
</li>
<li><p>@param {*} count </p>
</li>
<li><p>@returns </p>
</li>
<li><p>/<br>calHeight(viewer, fromPoint, endPoint, count) {<br>var positions = [];<br>for (var i = 0; i &lt;= count; i++) {<br>  var cart = Cesium.Cartesian3.lerp(</p>
<pre><code>fromPoint,
endPoint,
i / count,
new Cesium.Cartesian3()
</code></pre>
<p>  );<br>  positions.push(Cesium.Cartographic.fromCartesian(cart));<br>}<br>return new Promise((resolve, reject) =&gt; {<br>  var promise = Cesium.sampleTerrainMostDetailed(</p>
<pre><code>viewer.terrainProvider,
positions
</code></pre>
<p>  );<br>  Cesium.when(promise, function(updatedPositions) {</p>
<pre><code>resolve(updatedPositions);
</code></pre>
<p>  });<br>});<br>}<br>//绘制点<br>createPoint(worldPosition) {<br>var point = this._viewer.entities.add({<br>  position: worldPosition,<br>  point: {</p>
<pre><code>color: Cesium.Color.GREENYELLOW,
pixelSize: 9,
heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
</code></pre>
<p>  },<br>});<br>return point;<br>}<br>//绘制图形<br>drawShape(positionData) {<br>var that = this;<br>var shape;<br>shape = that._viewer.entities.add({<br>  polygon: {</p>
<pre><code>hierarchy: positionData,
perPositionHeight: true,
extrudedHeight: 4,
//new Cesium.Color.fromBytes(0,191,255,100),
//new Cesium.ColorMaterialProperty(Cesium.Color.AQUA.withAlpha(0.3))
material: new Cesium.Color.fromBytes(0, 191, 255, 100),
</code></pre>
<p>  },<br>});<br>return shape;<br>}</p>
</li>
</ul>
<p>  clear(){<br>    this._viewer.scene.globe.clippingPlanes &amp;&amp;  this._viewer.scene.globe.clippingPlanes.removeAll();<br>    this._viewer.entities.removeAll();<br>    this.activeShapePoints = [];<br>    this.activeShape = null;<br>    this.floatingPoint = null;<br>    this.points = [];<br>  }<br>}</p>
<h2 id="日照分析"><a href="#日照分析" class="headerlink" title="日照分析"></a>日照分析</h2><p>class SunshineAnalysis{</p>
<pre><code>    constructor(option)&#123;
          this._viewer = option.viewer
          this.init();
          this.eventBus = &#123;&#125;;
    &#125;

    init()&#123;
        
    &#125;

    $on(event, cb) &#123;
        if (!this.eventBus[event]) &#123;
            this.eventBus[event] = new Set()
        &#125;
        this.eventBus[event].add(cb)
    &#125;
    $emit(event, ...args) &#123;

        if (this.eventBus[event]) &#123;
            Array.from(this.eventBus[event]).forEach((handle) =&gt; &#123;

                handle.call(this, args)
            &#125;)
        &#125;
    &#125;
    $off(event, cb) &#123;
        if (this.eventBus[event]) &#123;
            this.eventBus[event].delete(cb)
        &#125;
    &#125;
</code></pre>
<p>}</p>
<h2 id="可视域分析"><a href="#可视域分析" class="headerlink" title="可视域分析"></a>可视域分析</h2><p>/**</p>
<ul>
<li>可视域分析。</li>
<li>@author</li>
<li>@date</li>
<li>@alias ViewShedStage</li>
<li>@class</li>
<li>@param {Cesium.Viewer} viewer Cesium三维视窗。</li>
<li>@param {Object} options 选项。</li>
<li>@param {Cesium.Cartesian3} options.viewPosition 观测点位置。</li>
<li>@param {Cesium.Cartesian3} options.viewPositionEnd 最远观测点位置（如果设置了观测距离，这个属性可以不设置）。</li>
<li>@param {Number} options.viewDistance 观测距离（单位<code>米</code>，默认值100）。</li>
<li>@param {Number} options.viewHeading 航向角（单位<code>度</code>，默认值0）。</li>
<li>@param {Number} options.viewPitch 俯仰角（单位<code>度</code>，默认值0）。</li>
<li>@param {Number} options.horizontalViewAngle 可视域水平夹角（单位<code>度</code>，默认值90）。</li>
<li>@param {Number} options.verticalViewAngle 可视域垂直夹角（单位<code>度</code>，默认值60）。</li>
<li>@param {Cesium.Color} options.visibleAreaColor 可视区域颜色（默认值<code>绿色</code>）。</li>
<li>@param {Cesium.Color} options.invisibleAreaColor 不可视区域颜色（默认值<code>红色</code>）。</li>
<li>@param {Boolean} options.enabled 阴影贴图是否可用。</li>
<li>@param {Boolean} options.softShadows 是否启用柔和阴影。</li>
<li>@param {Boolean} options.size 每个阴影贴图的大小。</li>
<li>/</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift240Cesium%E9%A3%9E%E8%A1%8C%E6%BC%AB%E6%B8%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift240Cesium%E9%A3%9E%E8%A1%8C%E6%BC%AB%E6%B8%B8/" class="post-title-link" itemprop="url">Cesium飞行漫游</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-14 21:42:47" itemprop="dateModified" datetime="2022-03-14T21:42:47+08:00">2022-03-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>window.bxmap = window.bxmap || {};<br>window.bxmap.FlyCesium = {<br>  cesiumViewer: null,<br>  draw3DObj: null,<br>  drawHelper: null,<br>  isDrawFly: false, //设定路线模式<br>  drawPolyline: null, //飞行绘制路线<br>  data: [<br>    {<br>      id: “1”,<br>      name: “阳江闸坡”,<br>      geojson:<br>        ‘{“orientation”:{“heading”:0.07372076173362352,”pitch”:-1.5574628887292024,”roll”:0},”position”:{“x”:-2205629.231433604,”y”:5509184.64306962,”z”:2331219.615547844},”geometry”:{“type”:”LineString”,”coordinates”:[[111.8181532375421,21.57868178213224],[111.81835028960268,21.578460581633188],[111.81832383076255,21.57812489081727],[111.81847943987464,21.577930686377922],[111.81878489838651,21.57765953027421],[111.81916083936886,21.577412646930927],[111.81958489944898,21.57729241143278],[111.82004766614196,21.57718315464893],[111.8206409631356,21.577000552080584],[111.82134398589339,21.576873639989994],[111.8219423400026,21.576726154070943],[111.822467537162,21.576376210912294],[111.82307030263561,21.576058642812292],[111.8237103973151,21.5756704298083],[111.8240924390803,21.575296152837485],[111.82504071801145,21.575766169089448],[111.82603850185104,21.576124273877287],[111.82694738799758,21.576428149353344],[111.82754018969692,21.576728981595224],[111.828099605676,21.57697046673728],[111.82845968318266,21.577307788777407],[111.8287111214647,21.577998110617774],[111.82881328135024,21.578557636789135],[111.82905095574245,21.57877846306897],[111.82918966895863,21.579074053131905],[111.82928422024466,21.579329257594996],[111.82930019172734,21.579630618390876],[111.82966603969574,21.580020790142015],[111.82960868244719,21.580744679418963],[111.82989219533579,21.581251462292837],[111.83013608532544,21.582236343172],[111.83037855800974,21.58254231013029],[111.83032824715998,21.58299431932842],[111.83001717858694,21.583468817164515],[111.8299185766154,21.584290601587544],[111.82948276544901,21.58496623602712],[111.8289749235787,21.58556878427974],[111.82886305199469,21.585776309810406],[111.8287779821505,21.585946333271792],[111.82865496967007,21.586265136888645],[111.82847674720864,21.586438092096014],[111.82845974740698,21.586567373767977],[111.828355170664,21.586736247366822],[111.82830843296874,21.586863152790087],[111.82825365102633,21.58710380271154],[111.82821734971404,21.587138762444976],[111.82817916952548,21.587294814193356],[111.82787759367034,21.587314539280754],[111.82719468513524,21.587237821164194],[111.82672929414602,21.58716013804561],[111.82658494057793,21.587131014021804],[111.82652478882481,21.587094797111455],[111.82647814913857,21.58694770659332],[111.82649812273736,21.58651375697629],[111.82650209141173,21.586517166652694],[111.82650209141173,21.586517166652694]]}}’,<br>    },<br>  ], //漫游路径信息模拟数据<br>  Init: function(cesiumViewer, drawHelper) {<br>    this.cesiumViewer = cesiumViewer; //cesium对象<br>    this.drawHelper = drawHelper; //drawHelper对象<br>    this.InitEvent();<br>    //this.loadData();<br>  },<br>  InitEvent: function() {<br>    //飞行路径顶端部分的切换事件<br>    // $(“.fly3DPaths_tab li”).bind(“click”, function () {<br>    //     $(‘.fly3DPaths_tab_ul&gt;li’).each(function(index){<br>    //         $(‘.fly3DPaths_tab_ul&gt;li’).eq(index).removeClass(‘select’);<br>    //     })<br>    //     //三角形标识切换<br>    //     switch ($(this).index()) {<br>    //         case 0://预设路线<br>    //             $(‘#overFlyClick’).addClass(‘select’);<br>    //             $(“#overFlyPage”).css({ display: “block” });<br>    //             $(“#drawFlyPage”).css({ display: “none” });<br>    //             bxmap.FlyCesium.loadData();<br>    //             break;<br>    //         case 1://手动绘制<br>    //             $(‘#drawFlyCilck’).addClass(‘select’);<br>    //             $(“#overFlyPage”).css({ display: “none” });<br>    //             $(“#drawFlyPage”).css({ display: “block” });<br>    //             break;<br>    //     }<br>    // });<br>    // //开始飞行<br>    // $(“#start_Fly3DPaths”).click(function(){<br>    //     //debugger;<br>    //     if(bxmap.FlyCesium.draw3DObj){<br>    //         bxmap.FlyCesium.showFly3DPaths(bxmap.FlyCesium.draw3DObj);<br>    //     }else{<br>    //         jDialog.dialog({<br>    //             title: “提示信息”,<br>    //             modal: true,// 非模态，即不显示遮罩层<br>    //             autoClose: 1500,<br>    //             content: “漫游路线不存在”<br>    //         });<br>    //     }<br>    // });<br>    // //暂停飞行<br>    // $(“#pause_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.pauseFly3DPaths();<br>    // });<br>    // //向前飞行<br>    // $(“#playForward_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.playForwardFly3DPaths();<br>    // });<br>    // //向后飞行<br>    // $(“#playReverse_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.playReverseFly3DPaths();<br>    // });<br>    // //退出飞行<br>    // $(“#stop_Fly3DPaths”).click(function(){<br>    //     $(“#cesiumFly3DPaths”).click();<br>    //     bxmap.FlyCesium.stopFly3DPaths();<br>    // });<br>    // //清空路线<br>    // $(“#clear_Fly3DPaths”).click(function(){<br>    //     bxmap.FlyCesium.clearFly3DPaths();<br>    // });<br>    //<br>    // //设定路线<br>    // $(“#draw_Fly3DPaths”).click(function(){<br>    //     if(!bxmap.FlyCesium.drawHelper){<br>    //         bxmap.FlyCesium.drawHelper = new this.DrawHelper(bxmap.FlyCesium.cesiumViewer);<br>    //     }<br>    //     bxmap.FlyCesium.draw3DObj = bxmap.FlyCesium.DrawFly3DPaths(bxmap.FlyCesium.drawHelper);<br>    // });<br>    // //保存路线<br>    // $(“#save_Fly3DPaths”).click(function(){<br>    //     if(bxmap.FlyCesium.draw3DObj &amp;&amp; bxmap.FlyCesium.isDrawFly){<br>    //         jDialog.dialog({<br>    //             title: ‘保存路线’,<br>    //             content: ‘<div><span>名称:</span><input type="text" id="FlyAdd_name" value="'+name+'"></div>‘,<br>    //             width: 300,<br>    //             height: 120,<br>    //             modal: true,// 非模态，即不显示遮罩层<br>    //             buttons: [<br>    //                 {<br>    //                     text: ‘确定’,<br>    //                     handler: function (button, dialog) {<br>    //                         var draw3DObj=JSON.stringify(bxmap.FlyCesium.draw3DObj); //将JSON对象转化为JSON字符<br>    //                         var TbFly={id:Math.random().toString(36).substr(2),name:$(“#FlyAdd_name”).val(),geojson:draw3DObj};<br>    //                         bxmap.FlyCesium.data.push(TbFly);<br>    //                         $(“#overFlyClick”).click();<br>    //                         dialog.close();<br>    //                         bxmap.FlyCesium.clearFly3DPaths();<br>    //<br>    //                     }<br>    //                 }, {<br>    //                     text: ‘取消’,<br>    //                     handler: function (button, dialog) {<br>    //                         dialog.close();<br>    //                     }<br>    //                 }<br>    //             ]<br>    //         });<br>    //<br>    //     }else{<br>    //         jDialog.dialog({<br>    //             title: “提示信息”,<br>    //             modal: true,// 非模态，即不显示遮罩层<br>    //             autoClose: 1500,<br>    //             content: “设定的漫游路线不存在，请绘制再保存”<br>    //         });<br>    //     }<br>    //<br>    // });<br>  },<br>  //飞行路径列表表格监听事件<br>  flyTableOnclick: function() {<br>    $(“#overFly_table td”).click(function() {<br>      var trSeq = $(this)<br>        .parent()<br>        .parent()<br>        .find(“tr”)<br>        .index($(this).parent()); //选中的哪行<br>      var geojson = $(<br>        “#overFly_table tr:gt(0):eq(“ + trSeq + “) td:eq(5)”<br>      ).text(); //获取选中行的geojson列值<br>      var name = $(“#overFly_table tr:gt(0):eq(“ + trSeq + “) td:eq(0)”).text(); //获取选中行的name列值<br>      var id = $(“#overFly_table tr:gt(0):eq(“ + trSeq + “) td:eq(4)”).text(); //获取选中行的id列值<br>      geojson = eval(“(“ + geojson + “)”);<br>      var tdSeq = $(this)<br>        .parent()<br>        .find(“td”)<br>        .index($(this)); //选中哪一列<br>      switch (tdSeq) {<br>        case 0: //名称<br>          break;<br>        case 1: //飞行<br>          bxmap.FlyCesium.draw3DObj = geojson;<br>          //bxmap.FlyCesium.cesium.showFly3DPaths(geojson);<br>          bxmap.FlyCesium.showFly3DPaths(geojson);<br>          $(“#drawFlyCilck”).click();<br>          break;<br>        case 2: //修改<br>          jDialog.dialog({<br>            title: “修改路线”,<br>            content:<br>              ‘<div><span>名称:</span><input type="text" id="Fly_name" value="' +
              name +
              '"></div>‘,<br>            width: 300,<br>            height: 120,<br>            modal: true, // 非模态，即不显示遮罩层<br>            buttons: [<br>              {<br>                text: “确定”,<br>                handler: function(button, dialog) {<br>                  bxmap.FlyCesium.data = bxmap.FlyCesium.modifyElement(<br>                    bxmap.FlyCesium.data,<br>                    id,<br>                    $(“#Fly_name”).val()<br>                  );<br>                  $(“#overFlyClick”).click();<br>                  dialog.close();<br>                },<br>              },<br>              {<br>                text: “取消”,<br>                handler: function(button, dialog) {<br>                  dialog.close();<br>                },<br>              },<br>            ],<br>          });<br>          break;<br>        case 3: //删除<br>          //删除<br>          jDialog.dialog({<br>            title: “删除路线”,<br>            modal: true, // 非模态，即不显示遮罩层<br>            content: “确定要删除该漫游路线?”,<br>            buttons: [<br>              {<br>                text: “确定”,<br>                handler: function(button, dialog) {<br>                  bxmap.FlyCesium.data = bxmap.FlyCesium.delElement(<br>                    bxmap.FlyCesium.data,<br>                    id<br>                  );<br>                  $(“#overFlyClick”).click();<br>                  dialog.close();<br>                },<br>              },<br>              {<br>                text: “取消”,<br>                handler: function(button, dialog) {<br>                  dialog.close();<br>                },<br>              },<br>            ],<br>          });<br>          break;<br>      }<br>    });<br>  },<br>  /**<br>     * 从数组中移除指定的元素,要是存在的话<br>     @ serviceArray筛选数组<br>     @ id移除元素id<br>     <em>/<br>  delElement: function(serviceArray, id) {<br>    var array = [];<br>    for (var i = 0; i &lt; serviceArray.length; i++) {<br>      if (serviceArray[i].id != id) {<br>        array.push(serviceArray[i]);<br>      }<br>    }<br>    return array;<br>  },<br>  /**<br>     * 从数组中修改指定的元素,要是存在的话<br>     @ serviceArray筛选数组<br>     @ id修改元素id<br>     @ name修改元素名称<br>     */<br>  modifyElement: function(serviceArray, id, name) {<br>    var array = [];<br>    for (var i = 0; i &lt; serviceArray.length; i++) {<br>      if (serviceArray[i].id == id) {<br>        serviceArray[i].name = name;<br>      }<br>      array.push(serviceArray[i]);<br>    }<br>    return array;<br>  },<br>  loadData: function() {<br>    var data = bxmap.FlyCesium.data;<br>    var html = “”;<br>    if (data.length &gt; 0) {<br>      for (var i = 0; i &lt; data.length; i++) {<br>        var flydata = data[i];<br>        html +=<br>          “<tr>“ +<br>          // ‘<td><input type="checkbox" name="FLYNAME" id="'+flydata.id+'" style="cursor: pointer;" onchange=""></td>‘+<br>          ‘<td><a style="color:#fff;text-decoration:none;font-size:12px;">‘ +<br>          flydata.name +<br>          “</a></td>“ +<br>          ‘<td><button class="btn btn-default btn-xs" style="color:#fff;">飞行</button></td>‘ +<br>          ‘<td><button class="btn btn-default btn-xs" style="color:#fff;">修改</button></td>‘ +<br>          ‘<td><button class="btn btn-default btn-xs" style="color:#fff;">删除</button></td>‘ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.id +<br>          “</a></td>“ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.geojson +<br>          “</a></td>“ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.position +<br>          “</a></td>“ +<br>          “<td><a style='color:black;text-decoration:none;font-size:13px;'>“ +<br>          flydata.orientation +<br>          “</a></td>“ +<br>          “</tr>“;<br>      }<br>      $(“#overFly_table tbody”).html(html);<br>      $(“#overFly_table”)<br>        .find(“td:eq(4)”)<br>        .hide(); //隐藏id字段列<br>      $(“#overFly_table”)<br>        .find(“td:eq(5)”)<br>        .hide(); //隐藏geojson字段列<br>      $(“#overFly_table”)<br>        .find(“td:eq(6)”)<br>        .hide(); //隐藏position字段列<br>      $(“#overFly_table”)<br>        .find(“td:eq(7)”)<br>        .hide(); //隐藏orientation字段列<br>      //表格—行点击事件<br>      bxmap.FlyCesium.flyTableOnclick();<br>    }<br>  },<br>  /</em>*</p>
<ul>
<li><p>清空漫游路径</p>
</li>
<li><p>@method stopFly3DPaths</p>
</li>
<li><p>@param</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>clearFly3DPaths: function() {<br>this.cesiumViewer.trackedEntity = undefined;<br>bxmap.FlyCesium.isDrawFly = false;<br>bxmap.FlyCesium.draw3DObj = null;<br>this.cesiumViewer.entities.removeAll(); //清空所有模型<br>//清空绘制飞行路线<br>if (this.drawPolyline) {<br>  this.cesiumViewer.scene.primitives.remove(this.drawPolyline);<br>  this.drawPolyline = null;<br>}<br>},<br>setFlySpeed(multiplier) {<br>this.cesiumViewer.clock.multiplier = multiplier;<br>},<br>getFlySpeed() {<br>return this.cesiumViewer.clock.multiplier;<br>},<br>/**</p>
</li>
<li><p>飞行漫游路径</p>
</li>
<li><p>@method showFly3DPaths</p>
</li>
<li><p>@param  pathsData 飞行路径信息,格式如下:{“orientation”:{“heading”:2.411783930363565,”pitch”:-0.21097267398444197,”roll”:0.0015622392231300353},”position”: {“x”:-2206260.239730831,”y”:5510911.392077349,”z”:2331987.10863007}, “geometry”:{“type”: “LineString”, “coordinates”: [[101.80089882736969, 26.60700234866561], [101.80082205161088, 26.607156056057718]]} }</p>
</li>
<li><p>@param  position 飞行路径跳转位置</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>showFly3DPaths: function(pathsData) {<br>var T = this;<br>this.clearFly3DPaths();<br>T.cesiumViewer.camera.setView({<br>  destination: pathsData.position,<br>  orientation: pathsData.orientation,<br>});<br>setTimeout(function() {<br>  executeFly3D();<br>}, 200);<br>function executeFly3D() {<br>  if (pathsData &amp;&amp; pathsData.geometry) {</p>
<pre><code>var positionA = pathsData.geometry.coordinates;
var position = [];
if (positionA.length &gt; 0) &#123;
  for (var i = 0; i &lt; positionA.length; i++) &#123;
    var x = positionA[i][0];
    var y = positionA[i][1];
    position.push(&#123; x: x, y: y &#125;);
  &#125;
&#125; else &#123;
  return;
&#125;
function computeCirclularFlight() &#123;
  var property = new Cesium.SampledPositionProperty();
  for (var i = 0; i &lt; position.length; i++) &#123;
    if (i == 0) &#123;
      var time = Cesium.JulianDate.addSeconds(
        start,
        i,
        new Cesium.JulianDate()
      );
      //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170);
      var _position = Cesium.Cartesian3.fromDegrees(
        position[i].x,
        position[i].y,
        0
      );
      property.addSample(time, _position);
    &#125;
    if (i &lt; 10000 &amp;&amp; i &gt; 0) &#123;
      var position_a = new Cesium.Cartesian3(
        property._property._values[i * 3 - 3],
        property._property._values[i * 3 - 2],
        property._property._values[i * 3 - 1]
      );
      if (i &lt; 976) &#123;
        //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170);
        var _position = Cesium.Cartesian3.fromDegrees(
          position[i].x,
          position[i].y,
          0
        );
      &#125; else if (i &gt; 975 &amp;&amp; i &lt; 986) &#123;
        //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170 + 20 * (i - 980));
        var _position = Cesium.Cartesian3.fromDegrees(
          position[i].x,
          position[i].y,
          0
        );
      &#125; else if (i &gt; 985) &#123;
        //var _position = Cesium.Cartesian3.fromDegrees(position[i].x, position[i].y, 1170 + 200);
        var _position = Cesium.Cartesian3.fromDegrees(
          position[i].x,
          position[i].y,
          0
        );
      &#125;

      var positions = [
        Cesium.Ellipsoid.WGS84.cartesianToCartographic(position_a),
        Cesium.Ellipsoid.WGS84.cartesianToCartographic(_position),
      ];
      var a = new Cesium.EllipsoidGeodesic(positions[0], positions[1]);
      var long = a.surfaceDistance;
      var _time = long / 50;
      var time = Cesium.JulianDate.addSeconds(
        property._property._times[i - 1],
        _time,
        new Cesium.JulianDate()
      );

      property.addSample(time, _position);
    &#125;
  &#125;
  return property;
&#125;
var start = Cesium.JulianDate.fromDate(new Date(2018, 3, 15, 16));
var stop = Cesium.JulianDate.addSeconds(
  start,
  30000,
  new Cesium.JulianDate()
);

//Make sure viewer is at the desired time.
T.cesiumViewer.clock.startTime = start.clone();
T.cesiumViewer.clock.stopTime = stop.clone();
T.cesiumViewer.clock.currentTime = start.clone();
T.cesiumViewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP; //Loop at the end
//T.cesiumViewer.clock.clockRange = Cesium.ClockRange.UNBOUNDED; //
//T.cesiumViewer.clock.clockStep = Cesium.ClockStep.SYSTEM_CLOCK; //
//T.cesiumViewer.clock.multiplier = 10;//值越大，飞行越快
T.cesiumViewer.clock.multiplier = 0.6;
T.cesiumViewer.clock.canAnimate = false;
T.cesiumViewer.clock.shouldAnimate = true; //设置时间轴动态效果

var _position = computeCirclularFlight();

T.entityFly = T.cesiumViewer.entities.add(&#123;
  //Set the entity availability to the same interval as the simulation time.
  availability: new Cesium.TimeIntervalCollection([
    new Cesium.TimeInterval(&#123;
      start: start,
      stop: stop,
    &#125;),
  ]),
  position: _position,
  orientation: new Cesium.VelocityOrientationProperty(_position),
  /*model: &#123;
            uri:GLOBAL.domainResource+&quot;/systems/common-bx-gis/models/cesium/SampleData/models/CesiumAir/Cesium_Air.gltf&quot;,
            scale: 6,
            minimumPixelSize: 64,
            //heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND
        &#125;,*/
  point: &#123;
    color: Cesium.Color.RED,
    outlineColor: Cesium.Color.WHITE,
    outlineWidth: 2,
    pixelSize: 15,
  &#125;,
  //Show the path as a pink line sampled in 1 second increments.
  path: &#123;
    resolution: 1,
    material: new Cesium.PolylineGlowMaterialProperty(&#123;
      glowPower: 0.1,
      color: Cesium.Color.YELLOW,
    &#125;),
    //width: 30
    width: 10,
  &#125;,
&#125;);
T.cesiumViewer.trackedEntity = T.entityFly;
setTimeout(function() &#123;
  T.cesiumViewer.camera.zoomOut(500.0); //缩小地图，避免底图没有数据
&#125;, 100);
</code></pre>
<p>  } else {</p>
<pre><code>return;
</code></pre>
<p>  }<br>}<br>},<br>/**</p>
</li>
<li><p>暂停飞行漫游路径</p>
</li>
<li><p>@method pauseFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>pauseFly3DPaths: function() {<br>var clockViewModel = this.cesiumViewer.clockViewModel;<br>if (clockViewModel.shouldAnimate) {<br>  clockViewModel.shouldAnimate = false;<br>} else if (this.cesiumViewer.clockViewModel.canAnimate) {<br>  clockViewModel.shouldAnimate = true;<br>}<br>},<br>/**</p>
</li>
<li><p>向前飞行漫游路径</p>
</li>
<li><p>@method playForwardFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>playForwardFly3DPaths: function() {<br>var clockViewModel = this.cesiumViewer.clockViewModel;<br>var multiplier = clockViewModel.multiplier;<br>if (multiplier &lt; 0) {<br>  clockViewModel.multiplier = -multiplier;<br>}<br>clockViewModel.shouldAnimate = true;<br>},<br>/**</p>
</li>
<li><p>向后飞行漫游路径</p>
</li>
<li><p>@method playForwardFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>playReverseFly3DPaths: function() {<br>var clockViewModel = this.cesiumViewer.clockViewModel;<br>var multiplier = clockViewModel.multiplier;<br>if (multiplier &gt; 0) {<br>  clockViewModel.multiplier = -multiplier;<br>}<br>clockViewModel.shouldAnimate = true;<br>},<br>/**</p>
</li>
<li><p>设定飞行漫游路径</p>
</li>
<li><p>@method DrawFly3DPaths</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>DrawFly3DPaths: function(drawHelper) {<br>var T = this;<br>this.clearFly3DPaths();<br>drawHelper.startDrawingPolyline({<br>  callback: function(positions) {</p>
<pre><code>T.drawPolyline = new DrawHelper.PolylinePrimitive(&#123;
  positions: positions,
  width: 5,
  type: &quot;plot&quot;,
  geodesic: true,
&#125;);
T.cesiumViewer.scene.primitives.add(T.drawPolyline);
T.drawPolyline.setEditable();
//构造设定路线的返回信息
var coordinates = [];
var position = null;
var heading = null;
var pitch = null;
var roll = null;
for (var i = 0; i &lt; positions.length; i++) &#123;
  var cartographic = Cesium.Cartographic.fromCartesian(positions[i]); //世界坐标转地理坐标（弧度）
  var point = [
    (cartographic.longitude / Math.PI) * 180,
    (cartographic.latitude / Math.PI) * 180,
  ]; //地理坐标（弧度）转经纬度坐标
  //console.log(point);
  coordinates.push(point);
&#125;
//orientation&quot;:&#123;&quot;heading&quot;:2.411783930363565,&quot;pitch&quot;:-0.21097267398444197,&quot;roll&quot;:0.0015622392231300353&#125;,&quot;position&quot;: &#123;&quot;x&quot;:-2206260.239730831,&quot;y&quot;:5510911.392077349,&quot;z&quot;:2331987.10863007&#125;,
position = drawHelper._cameraPosition;
heading = drawHelper._cameraHeading;
pitch = drawHelper._cameraPitch;
roll = drawHelper._cameraRoll;
var pathsData = &#123;
  orientation: &#123; heading: heading, pitch: pitch, roll: roll &#125;,
  position: position,
  geometry: &#123; type: &quot;LineString&quot;, coordinates: coordinates &#125;,
&#125;;
if (bxmap.FlyCesium) &#123;
  bxmap.FlyCesium.draw3DObj = T.draw3DObj = pathsData;
  bxmap.FlyCesium.isDrawFly = true;
&#125;
//return T.draw3DObj;
</code></pre>
<p>  },<br>});<br>},<br>/**</p>
</li>
<li><p>退出飞行漫游路径</p>
</li>
<li><p>@method stopFly3DPaths</p>
</li>
<li><p>@param</p>
</li>
<li><p>@return</p>
</li>
<li><p>/<br>stopFly3DPaths: function() {<br>var start = Cesium.JulianDate.fromDate(new Date());<br>this.cesiumViewer.clock.startTime = start.clone();<br>var stop = Cesium.JulianDate.addSeconds(<br>  start,<br>  300000000,<br>  new Cesium.JulianDate()<br>);<br>this.cesiumViewer.clock.stopTime = stop.clone();<br>//this.cesiumViewer.entities.remove(this.entityFly);<br>this.clearFly3DPaths();<br>},<br>};</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/25/M_Swift287M1%E8%BD%AF%E4%BB%B6%E5%88%9D%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="门乾强">
      <meta itemprop="description" content="博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Men的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/25/M_Swift287M1%E8%BD%AF%E4%BB%B6%E5%88%9D%E8%A3%85/" class="post-title-link" itemprop="url">M1 mac 装机</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 16:39:39" itemprop="dateCreated datePublished" datetime="2021-02-25T16:39:39+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-02 18:01:54" itemprop="dateModified" datetime="2022-08-02T18:01:54+08:00">2022-08-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1.安装最新的Xcode<br>2.Homebrew<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1265310832e6">https://www.jianshu.com/p/1265310832e6</a><br><a target="_blank" rel="noopener" href="https://brew.sh/">https://brew.sh</a><br>homebrew配置：brew config<br>安装软件，如：brew install node<br>卸载软件，如：brew uninstall node<br>搜索软件，如：brew search node<br>更新软件，如：brew upgrade node<br>查看安装列表，如：brew list<br>列出可更新的软件包，brew outdated<br>检测已经过时的软件：brew outdated<br>升级所有已过时的软件，即列出的以过时软件 ： brew upgrade<br>启动服务 brew services start mysql<br>查看包依赖 brew deps git</p>
<p>open -e .zshrc<br>open -e .bash_profile<br>cd ~<br>vim ./.bash_profile</p>
<p>http-server . -c-1  </p>
<p>brew install ruby<br>gem sources -l<br>gem sources –add <a target="_blank" rel="noopener" href="https://gems.ruby-china.com/">https://gems.ruby-china.com/</a> –remove <a target="_blank" rel="noopener" href="https://rubygems.org/">https://rubygems.org/</a><br>sudo gem install -n /usr/local/bin cocoapods</p>
<p>brew install git<br>brew install nginx<br>brew install mongodb</p>
<p>brew install google-chrome<br>brew install launchrocket<br>brew install docker<br>brew install visual-studio-code<br>brew install sorcerer<br>brew install sublime-text<br>brew install charles<br>brew install betterzip<br>brew install cleanmymac<br>brew install smartsvn<br>brew install we-chat<br>2.安装cocoapods<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/baicai_520/article/details/112697063">https://blog.csdn.net/baicai_520/article/details/112697063</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/44c894b69cf6">https://www.jianshu.com/p/44c894b69cf6</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19484963/article/details/83110004">https://blog.csdn.net/qq_19484963/article/details/83110004</a></p>
<p>M1电脑预装软件列表<br>Office 软件<br><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1MZjAv01_fT2ZOV5Pi7yDkA?errmsg=Auth+Login+Sucess&amp;errno=0&amp;ssnerror=0&amp;">https://pan.baidu.com/s/1MZjAv01_fT2ZOV5Pi7yDkA?errmsg=Auth+Login+Sucess&amp;errno=0&amp;ssnerror=0&amp;</a></p>
<p>wps<br><a target="_blank" rel="noopener" href="https://www.wps.cn/">https://www.wps.cn</a></p>
<p>idea  webstorm pycharm  ps</p>
<p>node<br><a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012843349/article/details/112856593">https://blog.csdn.net/u012843349/article/details/112856593</a></p>
<p>IDEA<br><a target="_blank" rel="noopener" href="https://download.jetbrains.8686c.com/idea/ideaIU-2020.3.2-aarch64.dmg">https://download.jetbrains.8686c.com/idea/ideaIU-2020.3.2-aarch64.dmg</a></p>
<p>VS code<br><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">https://code.visualstudio.com</a></p>
<p>chrome<br><a target="_blank" rel="noopener" href="https://www.google.com/chrome/">https://www.google.com/chrome/</a></p>
<p>mysql<br><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/">https://dev.mysql.com/downloads/</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42006613/article/details/111773038">https://blog.csdn.net/qq_42006613/article/details/111773038</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/studio">https://developer.android.com/studio</a></p>
<p>github<br><a target="_blank" rel="noopener" href="https://desktop.github.com/">https://desktop.github.com</a></p>
<p>xCode<br><a target="_blank" rel="noopener" href="https://apps.apple.com/us/app/xcode/id497799835">https://apps.apple.com/us/app/xcode/id497799835</a></p>
<p><a target="_blank" rel="noopener" href="https://proxyman.io/">https://proxyman.io</a></p>
<p><a target="_blank" rel="noopener" href="https://www.charlesproxy.com/download/">https://www.charlesproxy.com/download/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.python.org/">https://www.python.org</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Macvcl/p/14019852.html">https://www.cnblogs.com/Macvcl/p/14019852.html</a></p>
<h1 id="设置homebrew-core镜像"><a href="#设置homebrew-core镜像" class="headerlink" title="设置homebrew-core镜像"></a>设置homebrew-core镜像</h1><p>HOMEBREW_CORE_GIT_REMOTE=<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/homebrew-core.git">https://mirrors.ustc.edu.cn/homebrew-core.git</a></p>
<p>/bin/bash -c “$(curl -fsSL <a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh)&quot;">https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh)&quot;</a></p>
<p>Arm版安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /opt # 切换到 /opt 目录</span><br><span class="line">mkdir homebrew # 创建 homebrew 目录</span><br><span class="line">sudo chown -R $(whoami) /opt/homebrew # 修改目录所属用户</span><br><span class="line">curl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C homebrew</span><br></pre></td></tr></table></figure>

<p>intel版的安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch -x86_64 /bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)&quot;</span><br></pre></td></tr></table></figure>

<p>vim ~/.zshrc 或者 vim ~/.bash_profile</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> x86</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="string">&quot;/usr/local/bin:<span class="variable">$PATH</span>&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">alias</span>  abrew=<span class="string">&#x27;arch -x86_64 /usr/local/bin/brew&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> arm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="string">&quot;/opt/homebrew/bin:<span class="variable">$PATH</span>&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">alias</span>  brew=<span class="string">&#x27;/opt/homebrew/bin/brew&#x27;</span></span></span><br></pre></td></tr></table></figure>

<p>source ~/.zshrc 或者 source ~/.bash_profile</p>
<p>hexo g -d</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">门乾强</p>
  <div class="site-description" itemprop="description">博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">365</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">门乾强</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
